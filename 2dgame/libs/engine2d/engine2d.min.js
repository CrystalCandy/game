function ImportType(t){}function CastType(t){return t}function _createTClass_(){var t=this.prototype,e=this,i=new e;return i.classname=t.__class__,i._initclass_(),i}function _createTObject_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=_createTClass_.call(this),r=[],n=i;null!=n;)n.hasOwnProperty("initObj")&&r.push(n),n=Object.getPrototypeOf(n);return r=r.reverse(),r.forEach(function(e){(r=e.initObj).call.apply(r,[i].concat(t));var r}),i}function OverrideEUIInit(){eui.override._init()}function OverrideEgretInit(){egret.override._init()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),core;!function(t){function e(t,e){for(var r in e)"prototype"!=r&&e.hasOwnProperty(r)&&(t[r]=e[r]);for(var n=t.prototype,o=e.prototype,a=Object.keys(o),s=a.length,h=0;s>h;h++){var l=a[h];if(!n.hasOwnProperty(l)||i(n,l)){var u=Object.getOwnPropertyDescriptor(o,l);Object.defineProperty(n,l,u)}}}function i(t,e){if("function"!=typeof t[e])return!1;var i=t[e].toString(),r=i.indexOf("{"),n=i.lastIndexOf("}");return i=i.substring(r+1,n),""==i.trim()}t.MixinClasses=e}(core||(core={}));var TClass=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._initclass_=function(){this.mReferenceCount=1},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.getInstance=function(){return void 0==this._instance&&(this._instance=_createTObject_.call(this)),this._instance},e.destoryInstance=function(){void 0!=this._instance&&(this._instance.deleteObj(),this._instance=void 0)},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=_createTObject_.call.apply(_createTObject_,[this].concat(t));return i.autorelease(),i},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return _createTObject_.call.apply(_createTObject_,[this].concat(t))},e.prototype.deleteObj=function(){this.mReferenceCount=0;for(var t=this;null!=t;)t.hasOwnProperty("destory")&&t.destory.call(this),t=Object.getPrototypeOf(t)},e.prototype.retain=function(){TLog.Assert(this.mReferenceCount>=0,"this.mReferenceCount >= 0"),this.mReferenceCount++},e.prototype.release=function(){TLog.Assert(this.mReferenceCount>=0,"this.mReferenceCount >= 0"),this.mReferenceCount--,0==this.mReferenceCount&&this.deleteObj()},e.prototype.releaseLater=function(){core.AutoreleasePool.getInstance().addObject(this)},e.prototype.getReferenceCount=function(){return this.mReferenceCount},e.prototype.autorelease=function(){core.AutoreleasePool.getInstance().addObject(this)},e.prototype.getProperty=function(t){return t in this?this[t]:null},e}(egret.HashObject);__reflect(TClass.prototype,"TClass");var core;!function(t){var e=function(t){function e(){var e=t.call(this,"",!1,!1)||this;return e._initclass_(),e.handle=0,e}return __extends(e,t),e.prototype._initclass_=function(){},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.deleteObj=function(){},e.prototype.retain=function(){},e.prototype.release=function(){},e.prototype.autorelease=function(){},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e}(egret.Event);t.EventArgs=e,__reflect(e.prototype,"core.EventArgs");var i=function(t){function e(){var e=t.call(this)||this;return e.mCurrentEventName="",e._initclass_(),e}return __extends(e,t),e.prototype._initclass_=function(){},e.getInstance=function(){},e.destoryInstance=function(){},e.createObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.newObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.deleteObj=function(){},e.prototype.retain=function(){},e.prototype.release=function(){},e.prototype.releaseLater=function(){},e.prototype.autorelease=function(){},e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.prototype.$addListener=function(e,i,r,n,o,a){var s=this.$getEventMap(n),h=s[e];(!h||TLog.Assert(this.isEventExsit(h,i,r),"EventSet registerEvent %s exsit...",e))&&t.prototype.$addListener.call(this,e,i,r,n,o,a)},e.prototype.fireEvent=function(e,i,r){var n=this.mCurrentEventName;this.mCurrentEventName=e,i.$type=e,i.$bubbles=!!r;var o=t.prototype.dispatchEvent.call(this,i);return this.mCurrentEventName=n,o},e.prototype.dispatchEvent=function(t){throw new Error("dispatch not support")},e.prototype.isEventExsit=function(t,e,i){for(var r=0;r<t.length;r++){var n=t[r];if(n.listener==e&&n.thisObject==i&&n.target==this)return!1}return!0},e.prototype.clearEvent=function(){this.$EventDispatcher={1:{},2:{},3:0},this.mCurrentEventName=""},e.prototype.getCurrentEventName=function(){return this.mCurrentEventName},e}(egret.EventDispatcher);t.EventSet=i,__reflect(i.prototype,"core.EventSet"),t.MixinClasses(e,TClass),t.MixinClasses(i,TClass)}(core||(core={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mbInView=!1,this.mParentLayer=null,this.mNodeIndex=0,this.mOriginalParent=null},i.prototype.destory=function(){var t=this.getDisplayNode();t.parent&&t.parent.removeChild(t)},i.prototype.setInCameraView=function(t,e){e!=this.mbInView&&(this.mbInView=e,e?this.onCameraFound():this.onCameraLost())},i.prototype.onUpdate=function(t){if(t){var e=this.isInCameraView(t);this.setInCameraView(t,e)}else this.setInCameraView(t,!0)},i.prototype.isInCameraView=function(t){var e=this.getBoundRect(),i=t.getViewRect(),r=i.intersects(e);return r},i.prototype.isClip=function(){return!this.mbInView},i.prototype.onCameraFound=function(){if(null!=this.mParentLayer){var t=this.getDisplayNode();null==t.parent&&this.mParentLayer.getDisplayNode().addChildAt(t,this.mNodeIndex)}},i.prototype.onCameraLost=function(){if(null!=this.mParentLayer){var t=this.getDisplayNode(),e=this.mParentLayer.getDisplayNode();t.parent==e&&(this.mNodeIndex=e.getChildIndex(t),e.removeChild(t))}},i.prototype.setVisible=function(t){var e=this.getDisplayNode();e.visible!=t&&(null==this.mOriginalParent&&(this.mOriginalParent=e.parent),t?this.mOriginalParent?this.mOriginalParent.addChild(e):this.mParentLayer&&this.mParentLayer.getDisplayNode().addChild(e):(this.mOriginalParent=e.parent,e.parent&&e.parent.removeChild(e))),e.visible=t},i.prototype.setVisibleRaw=function(t){var e=this.getDisplayNode();e.visible=t},i.prototype.isVisible=function(){return this.getDisplayNode().visible},i.prototype.onEnterMap=function(t){TLog.Assert(null==this.mParentLayer,"onEnterMap"),this.mParentLayer=t,this.mbInView=!1,this.mOriginalParent=null},i.prototype.onLeaveMap=function(t){TLog.Assert(null!=this.mParentLayer,"onLeaveMap"),this.mbInView&&(this.mbInView=!1,this.onCameraLost()),this.mParentLayer=null,this.mOriginalParent=null},i.prototype.isEnterMap=function(){return null!=this.mParentLayer},i.prototype.getLayer=function(){return this.mParentLayer},i.prototype.setPosition=function(t,e){TLog.Assert(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e));var i=this.getDisplayNode();i.x=t,i.y=e},i.prototype.getPositionX=function(){var t=this.getDisplayNode();return t.x},i.prototype.getPositionY=function(){var t=this.getDisplayNode();return t.y},i.prototype.setPositionCellXY=function(e,i){var r=t.LogicBlock.getXFromCell(e),n=t.LogicBlock.getXFromCell(i);this.setPosition(r,n)},i.prototype.getPositionCellX=function(){return t.LogicBlock.getCellX(this.getPositionX())},i.prototype.getPositionCellY=function(){return t.LogicBlock.getCellY(this.getPositionY())},i}(core.EventSet);t.SpriteBase=e,__reflect(e.prototype,"map.SpriteBase")}(map||(map={}));var map;!function(t){function e(t){return t>7&&(t=7),0>t&&(t=0),t=4>=t?4-t:12-t}var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.report=0,this.optimizeflag=0,this.mPathMgr=t.MapManager.getInstance().getPathMgr(),this.movementEvent=t.SpriteMovEvent.newObj(),this.mmoving=!1,this.mbTickMove=!1,this.m_nAngle=-1,this.m_bDirChange=!1},r.prototype.destory=function(){this.movementEvent.deleteObj(),this.movementEvent=null},r.prototype.addReportFlag=function(t){this.report=this.report|t},r.prototype.removeReportFlag=function(t){this.report=this.report&~t},r.prototype.clearReportFlag=function(){this.report=0},r.prototype.moveTo=function(e,i,r){TLog.Assert(!isNaN(e)&&!isNaN(i)),this._DelayInitLogicPath();var n=this.getPositionX(),o=this.getPositionY(),a={x:n,y:o},s={x:e,y:i},h=this.mPathMgr.createPath(this.logicPath,a,s,this.getAngle(),1e4,r);return h==t.FindPathType.eFindPathType_Succeed?0==this.mmoving&&(this.mmoving=!0,this.report&t.MoveReportFlag.MOVEMENT_BEGIN_RUN&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_BEGIN_RUN)):h==t.FindPathType.eFindPathType_Fail&&this.mmoving&&(this.mmoving=!1,t.MoveReportFlag.MOVEMENT_STOPING&this.report&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_STOPING)),this.mbTickMove=h!=t.FindPathType.eFindPathType_Fail,this.mbTickMove},r.prototype.moveStop=function(){TLog.Assert(this.isEnterMap()),this.mbTickMove&&this.logicPath&&(this.mbTickMove=!1,this.mPathMgr.clearPath(this.logicPath)),this.mmoving&&(this.mmoving=!1,t.MoveReportFlag.MOVEMENT_STOPING&this.report&&this._FireMovementEvent(t.MoveReportFlag.MOVEMENT_STOPING))},r.prototype.isMoving=function(){return this.mmoving},r.prototype.setMoveSpeed=function(t){this._DelayInitLogicPath(),this.logicPath.SetSpeed(t)},r.prototype.getMoveSpeed=function(){return this._DelayInitLogicPath(),this.logicPath.GetSpeed()},r.prototype._DelayInitLogicPath=function(){return TLog.Assert(this.isEnterMap()),null==this.logicPath&&(this.logicPath=this.mPathMgr.createLogicPath(),this.logicPath.SetSpeed(this.getMoveSpeed())),!0},r.prototype._FireMovementEvent=function(e){if(0!=e){var i={x:this.getPositionX(),y:this.getPositionY()},r={x:this.getPositionCellX(),y:this.getPositionCellY()};return this.movementEvent.actor=this,this.movementEvent.flag=e,this.movementEvent.dir=this.getDir(),this.movementEvent.pixel=i,this.movementEvent.cell=r,0!=(e&t.MoveReportFlag.MOVEMENT_BEGIN_RUN)&&0!=(this.report&t.MoveReportFlag.MOVEMENT_TRACE_PATH)&&this.logicPath,0==(e&t.MoveReportFlag.MOVEMENT_CELL_CHANGED)?void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent):this.mPathMgr.getLogicBlock().IsBlock(r)?(this.movementEvent.flag=this.movementEvent.flag&~t.MoveReportFlag.MOVEMENT_CELL_CHANGED,void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent)):void this.fireEvent(t.SpriteMovEvent.MovementEvent,this.movementEvent)}},r.prototype.setDir=function(t){this.setAngle(45*e(t))},r.prototype.getDir=function(){var t=this.getAngle(),i=22.5,r=1;return i>=t||t>=360-i?r=0:t>=i&&3*i>=t?r=1:t>=3*i&&5*i>=t?r=2:t>=5*i&&7*i>=t?r=3:t>=7*i&&9*i>=t?r=4:t>=9*i&&11*i>=t?r=5:t>=11*i&&13*i>=t?r=6:t>=13*i&&15*i>=t&&(r=7),e(r)},r.prototype.setAngle=function(t){TLog.Assert(!isNaN(t)),this.m_nAngle!=t&&(this.m_nAngle=t,this.m_bDirChange=!0)},r.prototype.getAngle=function(){return this.m_nAngle},r.prototype.setDirChange=function(){this.m_bDirChange=!0},r.prototype._UpdateMovement=function(e){if(this.isEnterMap()&&this.mbTickMove&&null!=this.logicPath){this.logicPath.UpdateTime(core.TimeStamp.DelayTime);var i=0,r={};r.bStop=!1,r.x=0,r.y=0,r.dir=0;var n=this.mPathMgr.updatePath(this.logicPath,r),o=r.bStop,a=r.dir,s={},h={};if(h.x=r.x,h.y=r.y,n==t.FindPathType.eFindPathType_Succeed)if(0==this.mmoving)this.mmoving=!0,i|=t.MoveReportFlag.MOVEMENT_BEGIN_RUN;else if(o)this.mbTickMove=!1,this.mmoving&&(this.mmoving=!1,i|=t.MoveReportFlag.MOVEMENT_STOPING);else{var l=this.getPositionX(),u=this.getPositionY(),p=this.getPositionCellX(),m=this.getPositionCellY(),c=this.getAngle();(h.x!=l||h.y!=u)&&(i|=t.MoveReportFlag.MOVEMENT_PIXEL_CHANGED,s.x=t.LogicBlock.getCellX(h.x),s.y=t.LogicBlock.getCellX(h.y),this.setPosition(h.x,h.y),(s.x!=p||s.y!=m)&&(i|=t.MoveReportFlag.MOVEMENT_CELL_CHANGED)),a!=c&&(i|=t.MoveReportFlag.MOVEMENT_DIR_CHANGED,this.setAngle(a))}else n==t.FindPathType.eFindPathType_Fail&&(this.mmoving&&(this.mmoving=!1,i|=t.MoveReportFlag.MOVEMENT_STOPING),this.mbTickMove=!1);if(i&=this.report,0!=i){if(this.isClip()&&0!=(this.optimizeflag&t.OptimizeFlag.OPTIMIZE_MOVEMENT_ONSEE)&&!(i&t.MoveReportFlag.MOVEMENT_BEGIN_RUN||i&t.MoveReportFlag.MOVEMENT_STOPING))return;this._FireMovementEvent(i)}}},r.prototype._UpdateAppearance=function(){if(!(this.isClip()&&this.optimizeflag&t.OptimizeFlag.OPTIMIZE_UPDATE_ONSEE)&&this.m_bDirChange){var e=this.getDir();this.onMoveDirChange(e)&&(this.m_bDirChange=!1)}},r.prototype.onUpdate=function(t){i.prototype.onUpdate.call(this,t),this._UpdateMovement(t),this._UpdateAppearance()},r.prototype.onMoveDirChange=function(t){return!0},r}(t.SpriteBase);t.MovableSprite=i,__reflect(i.prototype,"map.MovableSprite")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTileMap=t[0],this.mZOder=-1},e.prototype.destory=function(){},e.prototype.getTileMap=function(){return this.mTileMap},e.prototype.onUpdate=function(t){},e.prototype.setZOrder=function(t){this.mZOder=t},e.prototype.getZOrder=function(){return this.mZOder},e}(TClass);t.LayerBase=e,__reflect(e.prototype,"map.LayerBase")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mResRefCount=0,this.mLoadState=t.ModelLoadState.eUnLoaded,this.mModelName=e[0],this.mSpriteMgr=e[2],this.mUnLoadBeginTime=-1},i.prototype.destory=function(){this.unloadImp()},i.prototype.load=function(){return this.mResRefCount++,1==this.mResRefCount&&(this.isUnLoading()&&(this.mSpriteMgr.removeUnloadingResource(this),this.mUnLoadBeginTime=-1,this.mLoadState=t.ModelLoadState.eLoaded),this.isUnLoaded()&&(this.mLoadState=t.ModelLoadState.eLoading,this._loadImp())),this.mLoadState==t.ModelLoadState.eLoaded},i.prototype.unload=function(){return TLog.Assert(this.mResRefCount>0),this.mResRefCount--,0==this.mResRefCount&&(this.isLoading()?(this._cancelLoadImp(),this.mLoadState=t.ModelLoadState.eUnLoaded):(this.mLoadState=t.ModelLoadState.eUnLoading,this.mSpriteMgr.addUnloadingResource(this))),this.isUnLoaded()},i.prototype.unloadImp=function(){this._unloadImp(),this.mSpriteMgr.removeUnloadingResource(this),this.mUnLoadBeginTime=-1,this.mLoadState=t.ModelLoadState.eUnLoaded},i.prototype.isLoaded=function(){return this.mLoadState==t.ModelLoadState.eLoaded},i.prototype.isLoading=function(){return this.mLoadState==t.ModelLoadState.eLoading},i.prototype.isUnLoaded=function(){return this.mLoadState==t.ModelLoadState.eUnLoaded},i.prototype.isUnLoading=function(){return this.mLoadState==t.ModelLoadState.eUnLoading},i.prototype.notifyLoadComplete=function(){this.mLoadState=t.ModelLoadState.eLoaded},i.prototype._loadImp=function(){},i.prototype._unloadImp=function(){},i.prototype._cancelLoadImp=function(){},i}(TClass);t.SpriteResourceBase=e,__reflect(e.prototype,"map.SpriteResourceBase")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTag=-1,this.mObjectList=[],this.mAddObjectList=[],this.mRemoveObjectList=[],this.mRenderObjectList=[],this.mbUpdateLock=!1},i.prototype.destory=function(){this.clearSprite()},i.prototype.getDisplayNode=function(){return this.mDisplayNode||(this.mDisplayNode=new t.SpriteLayerDisplayerNode),this.mDisplayNode},i.prototype.setTag=function(t){this.mTag=t},i.prototype.getTag=function(){return this.mTag},i.prototype.addSprite=function(t){if(null==t)return!1;if(this.mbUpdateLock){var e=this.mRemoveObjectList.indexOf(t);return-1!=e&&(t.release(),this.mRemoveObjectList.splice(e,1)),-1!=this.mAddObjectList.indexOf(t)?!1:(t.retain(),t.onEnterMap(this),this.mAddObjectList.push(t),!0)}var e=this.mObjectList.indexOf(t);return-1==e&&(t.retain(),this.mObjectList.push(t),t.isEnterMap()||t.onEnterMap(this)),!0},i.prototype.removeSprite=function(t){if(null!=t){var e=this.mAddObjectList.indexOf(t);if(-1!=e&&(t.release(),this.mAddObjectList.splice(e,1)),-1==this.mRemoveObjectList.indexOf(t))return t.retain(),t.onLeaveMap(this),this.mRemoveObjectList.push(t),!0}},i.prototype.removeSpriteImp=function(t){var e=this.mObjectList.indexOf(t);return-1!=e&&(this.mObjectList.splice(e,1),t.isEnterMap()&&t.onLeaveMap(this),t.release()),e=this.mRenderObjectList.indexOf(t),-1!=e&&this.mRenderObjectList.splice(e,1),!0},i.prototype.clearSprite=function(){this.mAddObjectList.forEach(function(t){t.release()}),this.mAddObjectList.length=0,this.mRemoveObjectList.forEach(function(t){t.release()}),this.mRemoveObjectList.length=0,this.mObjectList.forEach(function(t){t.release()}),this.mObjectList.length=0,this.mRenderObjectList.length=0},i.prototype.onUpdate=function(t){0!=this.mObjectList.length&&(this.onUpdateSpriteList(t),this.onRenderSpriteList(t))},i.prototype.onUpdateSpriteList=function(t){this.mbUpdateLock=!0;for(var e=this.mObjectList.length,i=0;e>i;i++){var r=this.mObjectList[i];-1==this.mRemoveObjectList.indexOf(r)&&r.onUpdate(t)}if(this.mbUpdateLock=!1,this.mAddObjectList.length>0){for(var e=this.mAddObjectList.length,i=0;e>i;i++){var r=this.mAddObjectList[i];this.addSprite(r),r.release()}this.mAddObjectList.length=0}if(this.mRemoveObjectList.length>0){for(var e=this.mRemoveObjectList.length,i=0;e>i;i++){var r=this.mRemoveObjectList[i];this.removeSpriteImp(r),r.release()}this.mRemoveObjectList.length=0}},i.prototype.onRenderSpriteList=function(t){var e=this;this.mRenderObjectList.length=0,this.mObjectList.forEach(function(t){1==t.isVisible()&&0==t.isClip()&&e.mRenderObjectList.push(t)})},i}(t.LayerBase);t.SpriteLayer=e,__reflect(e.prototype,"map.SpriteLayer")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.mLayerEyeshot=new t.MapLayerEyeShot,i.mLayerType=0,i.mLayerID=0,i}return __extends(i,e),i.prototype.destory=function(){},i.prototype.getDisplayNode=function(){return this.mDisplayNode||(this.mDisplayNode=new t.MapLayerDisplayerNode),this.mDisplayNode},i.prototype.initEyeshot=function(t,e,i,r){this.mLayerEyeshot.create(this,t,e,i,r)},i.prototype.load=function(t){return this.mLayerType=t.readByte(),this.mLayerID=t.readShort(),this.mName=t.readString(),!0},i.prototype.onUpdate=function(t){t.isViewChanged()&&(this.mLayerEyeshot.changeViewportSize(t.getViewWidth(),t.getViewHeight(),!1),this.mLayerEyeshot.moveViewportCenterTo(t.getViewCenterX(),t.getViewCenterY()))},i.prototype.onEyeshotFound=function(t,e){},i.prototype.onEyeshotLost=function(t,e){},i}(t.LayerBase);t.MapLayerBase=e,__reflect(e.prototype,"map.MapLayerBase",["map.IEyeshotCallback"])}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mRootNode=new egret.DisplayObjectContainer,this.mLogicFlags=0,this.mLogicInfo={0:""},this.mSpriteMgr=t.LogicSpriteManager.getInstance(),this.mParentSprite=null,this.mChildSpriteList=[],this.mChildAddInfoList=[],this.m_bFlipX=!1,this.m_bFlipY=!1,this.mFlipXFlag=1,this.mFlipYFlag=1,this.m_bMirror=!1,this.mPersScale=1,this.mScale=1,this.mAlpha=255,this.mMaskAlpha=255,this.mRotate=0,this.mDisplayeNodeList=[],this.mBoundRect=new egret.Rectangle,this.mBoundRect.setTo(0,0,1,1),this.mBoundActionId="",this.mBoundModelChanged=!1,this.mbUpdateAnimAlways=!1,this.mPartSkinInfoList=[]},i.prototype.destory=function(){this.mSpriteMgr.removeSprite(this),this.clearAllChildSprite(),this.mRootNode.parent&&this.mRootNode.parent.removeChild(this.mRootNode),this.mDisplayeNodeList=null,this.mAnimEvent&&(this.mAnimEvent.release(),this.mAnimEvent=null)},i.prototype.getBoundRect=function(){var e=this.getDisplayNode();return this.mBoundRect.x=t.FLOOR(e.x-this.mBoundRect.width/2),this.mBoundRect.y=t.FLOOR(e.y-this.mBoundRect.height),this.mBoundRect},i.prototype.loadModel=function(t){return this.changeSkin(""),this.mPartSkinInfoList.length=0,this.setLogicInfo(0,t,1),!0},i.prototype.getModelName=function(){return this.mLogicInfo[0]},i.prototype.changeAction=function(t,e){return this.setLogicInfo(1,t,2),this.setLogicInfo(3,e,8),!1},i.prototype.getActionId=function(){return this.mLogicInfo[1]},i.prototype.getLoopCount=function(){return null!=this.mLogicInfo[3]?this.mLogicInfo[3]:-1},i.prototype.setAnimSpeed=function(t){this.setLogicInfo(2,t,4)},i.prototype.getAnimSpeed=function(){return this.mLogicInfo[2]||1},i.prototype.setPause=function(t){this.setLogicInfo(4,t,16)},i.prototype.isPause=function(){return this.mLogicInfo[4]||!1},i.prototype.setAlpha=function(t){this.mAlpha=t,this._updateAlpha()},i.prototype.setMaskAlpha=function(t){this.mMaskAlpha=t,this._updateAlpha()},i.prototype.setColor=function(t,e,i){},i.prototype.setRotate=function(t){this.mRotate=t,this._updateRotate()},i.prototype.getRotate=function(){return this.mRotate},i.prototype.setScale=function(t){this.mScale=t,this._updateScale()},i.prototype.getScale=function(){return this.mScale},i.prototype.setPersScale=function(t){this.mPersScale=t,this._updateScale()},i.prototype.getPersScale=function(){return this.mPersScale},i.prototype.setMirror=function(t){this.m_bMirror=t,this.setDirChange()},i.prototype.setFlipXY=function(t,e){this.m_bFlipX=t,this.m_bFlipY=e,this.setDirChange()},i.prototype.isFlipX=function(){return this.m_bFlipX},i.prototype.isFlipY=function(){return this.m_bFlipY},i.prototype.setParent=function(t){this.mParentSprite=t},i.prototype.getParent=function(){return this.mParentSprite},i.prototype.setBoundActionId=function(t){this.mBoundActionId=t},i.prototype.getBoundActionId=function(){return this.mBoundActionId},i.prototype.setUpdateAnimAlways=function(t){this.mbUpdateAnimAlways=t},i.prototype.isUpdateAnimAlways=function(){return this.mbUpdateAnimAlways},i.prototype.changePartSkin=function(t,e){for(var i=0;i<this.mPartSkinInfoList.length;i++){var r=this.mPartSkinInfoList[i];if(r.sloName==t)return void(r.replaceSkinPath=e)}var n={slotName:t,replaceSkinPath:e};this.mPartSkinInfoList.push(n)},i.prototype.changeSkin=function(t){this.setLogicInfo(5,t,64)},i.prototype.getSkinName=function(){return this.mLogicInfo[5]||""},i.prototype.setPositionOffset=function(t,e){},i.prototype.addChildSprite=function(t,e,i,r){if(null!=e&&e!=this){TLog.Assert(0==e.isEnterMap()&&null==e.getParent());var n={};n.slot=t,n.sprite=e,n.order=null==i?0/0:i,n.bTransform=!!r,this.mChildAddInfoList.push(n),e.setParent(this),e.retain()}},i.prototype.removeChildSprite=function(t){for(var e=!1,i=0;i<this.mChildAddInfoList.length;i++){var r=this.mChildAddInfoList[i];if(r.sprite==t){this._removeChildNode(t),this.mChildAddInfoList.splice(i,1),e=!0;break}}if(!e)for(var i=0;i<this.mChildSpriteList.length;i++){var n=this.mChildSpriteList[i];if(n==t){this._removeChildNode(t),this.mChildSpriteList.splice(i,1);break}}},i.prototype.clearAllChildSprite=function(){for(var t=0;t<this.mChildSpriteList.length;t++){var e=this.mChildSpriteList[t];this._removeChildNode(e)}this.mChildSpriteList.length=0},i.prototype.addDisplayeNode=function(e,i){if(!(null==i||0>e||e>t.SpriteDisplayNodeType.eDisplayNode_Unknown)&&JsUtil.arrayPush(this.mDisplayeNodeList,i)){var r=0;e==t.SpriteDisplayNodeType.eDisplayNode_Shadow||e==t.SpriteDisplayNodeType.eDisplayNode_UI&&(r=-1),this.mRootNode.addChildAt(i,r)}},i.prototype.removeDisplayeNode=function(t){JsUtil.arrayRemoveVal(this.mDisplayeNodeList,t)&&this.mRootNode.removeChild(t)},i.prototype.getDisplayNodeList=function(){return this.mDisplayeNodeList},i.prototype.setPosition=function(t,e){TLog.Assert(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e));var i=this.getDisplayNode();i.x=t,i.y=e,this.getParent()&&(i.y=-e)},i.prototype.getPositionX=function(){var t=this.getDisplayNode();return t.x},i.prototype.getPositionY=function(){var t=this.getDisplayNode(),e=t.y;return this.getParent()&&(e=-e),e},i.prototype._setFlags=function(t){this.mLogicFlags|=t},i.prototype._removeFlags=function(t){this.mLogicFlags&=~t},i.prototype._hasFlags=function(t){return(this.mLogicFlags&t)==t},i.prototype.setLogicInfo=function(t,e,i){this.mLogicInfo[t]=e,this._setFlags(i)},i.prototype._fireAnimEvent=function(e){if(this.report&t.AnimReportFlag.ANIM_NOTIFY){null==this.mAnimEvent&&(this.mAnimEvent=t.SpriteAnimEvent.newObj());var i=this.mAnimEvent;i.actor=this,i.actionId=this.getActionId(),i.notify=e,this.fireEvent(t.SpriteAnimEvent.AnimEvent,i)}},i.prototype._fireBoundEvent=function(){var e=t.SpriteEvent.createObj();e.actor=this,this.fireEvent(t.SpriteEvent.BoundSizeEvent,e)},i.prototype._updateMask=function(){var e=this.getBoundRect(),i=t.LogicBlock.getCellX(e.left),r=t.LogicBlock.getCellY(e.top),n=t.LogicBlock.getCellX(e.right),o=t.LogicBlock.getCellY(e.bottom),a=255,s=t.MapManager.getInstance().getLogicMask();s.IsMask(t.FLOOR((i+n)/2),o)&&s.IsMask(t.FLOOR((i+n)/2),(r+o)/2)&&(a=128),this.setMaskAlpha(a)},i.prototype._removeChildNode=function(t){var e=t.getDisplayNode();e.parent&&e.parent.removeChild(e),t.setParent(null),t.release()},i.prototype.getDisplayNode=function(){return this.mRootNode},i.prototype.onUpdate=function(t){if(e.prototype.onUpdate.call(this,t),!this.isClip()){this._updateModel();for(var i=0;i<this.mChildSpriteList.length;i++){var r=this.mChildSpriteList[i];r.onUpdate(t)}}},i.prototype.isInCameraView=function(t){return this.mParentSprite?!this.mParentSprite.isClip():e.prototype.isInCameraView.call(this,t)},i.prototype.onCameraFound=function(){e.prototype.onCameraFound.call(this)},i.prototype.onCameraLost=function(){e.prototype.onCameraLost.call(this)},i.prototype._updateAlpha=function(){},i.prototype._updateScale=function(){},i.prototype._updateRotate=function(){},i.prototype._updateModel=function(){},i.prototype.hasActionId=function(t){return!1},i}(t.MovableSprite);t.LogicSprite=e,__reflect(e.prototype,"map.LogicSprite")}(map||(map={}));var gui;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.bg=new eui.Image,this.addChild(this.bg),this.content=new eui.Label,this.addChild(this.content),this.addEventListener(t.TouchEvent.TOUCH_SHORT,this.onTouchEnd,this),this.content.textAlign="center",this.content.verticalAlign="middle",this.content.textColor=0},i.prototype.dataChanged=function(){"undefined"!=typeof this.data.content&&(this.content.text=this.data.content),"undefined"!=typeof this.data.width&&(this.width=this.data.width,this.content.width=this.data.width,this.bg.width=this.data.width),"undefined"!=typeof this.data.bg?this.bg.source=this.data.bg:this.bg.source="","undefined"!=typeof this.data.height&&(this.height=this.data.height,this.bg.height=this.data.height,this.content.height=this.data.height),"undefined"!=typeof this.data.fontSize&&(this.content.size=this.data.fontSize),"undefined"!=typeof this.data.textAlign&&(this.content.textAlign=this.data.textAlign)},i.prototype.onTouchEnd=function(e){var i={};i.itemIndex=this.itemIndex,i.content=this.data.content||"",this.dispatchEventWith(t.ComboBox.onClick,!0,i)},i}(eui.ItemRenderer);t.ComboBoxItem=e,__reflect(e.prototype,"gui.ComboBoxItem")}(gui||(gui={}));var core;!function(t){var e=function(){function t(){}return t.TYPE_XML=RES.ResourceItem.TYPE_XML,t.TYPE_IMAGE=RES.ResourceItem.TYPE_IMAGE,t.TYPE_BIN=RES.ResourceItem.TYPE_BIN,t.TYPE_TEXT=RES.ResourceItem.TYPE_TEXT,t.TYPE_JSON=RES.ResourceItem.TYPE_JSON,t.TYPE_SOUND=RES.ResourceItem.TYPE_SOUND,t}();t.ResourceType=e,__reflect(e.prototype,"core.ResourceType");var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mGroupCallbackMap={},t.mItemCallbackMap={},t}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.init()},i.prototype.init=function(){this.mRootPath="",RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.registerAnalyzer(RES.ResourceItem.TYPE_SHEET,null),RES.registerAnalyzer(RES.ResourceItem.TYPE_FONT,null),this.mZipList={},this.mbSearchZipFirst=!0,this.mResExplicitType={},RES.setMaxLoadingThread(5),this.mLangIncludePathList=[],this.mLangExcludePathList=[],this.mLanguagePath="",this.mPath2ResItem={},this.mbH5CrossOrign=!1,this.mErrorResPathMap={}},i.prototype.destory=function(){},i.prototype.setRootPath=function(t){this.mRootPath=t},i.prototype.getRootPath=function(t){return this.mRootPath},i.prototype.setSearchZipFirst=function(t){this.mbSearchZipFirst=t},i.prototype.setLanguagePath=function(t){this.mLanguagePath=t},i.prototype.getLanguagePath=function(){return this.mLanguagePath},i.prototype.addLanguageIncludePath=function(t){return-1==this.mLangIncludePathList.indexOf(t)?(this.mLangIncludePathList.push(t),!0):!1},i.prototype.addLanguageExcludePath=function(t){return-1==this.mLangExcludePathList.indexOf(t)?(this.mLangExcludePathList.push(t),!0):!1},i.prototype.getPathInterval=function(t){if(""==this.mLanguagePath)return t;for(var e=0,i=this.mLangExcludePathList;e<i.length;e++){var r=i[e];if(-1!=t.indexOf(r))return t}for(var n=0,o=this.mLangIncludePathList;n<o.length;n++){var r=o[n];if(-1!=t.indexOf(r))return this.mLanguagePath+t}return t},i.prototype.fetchVersion=function(t,e,i){var r={onSuccess:function(r){t.call(e,0,i)},onFail:function(r,n){t.call(e,-1,i)}};RES.getVersionController().fetchVersion(r)},i.prototype.transfromZipObjectData=function(e,i,r){if(null!=r)switch(r){case t.ResourceType.TYPE_TEXT:return e.asText();case t.ResourceType.TYPE_BIN:return e.asArrayBuffer();case t.ResourceType.TYPE_JSON:return JsUtil.JsonDecode(e.asText())}else{var n=i.substr(i.lastIndexOf(".")+1);if(n&&(n=n.toLowerCase()),"dat"==n)return e.asArrayBuffer();if("json"==n)return JsUtil.JsonDecode(e.asText())}return e.asText()},i.prototype.loadZipRes=function(t){if(this.checkResItemCache(t,""))return!0;var e=this.mResExplicitType[t],i=this.getPathInterval(t);for(var r in this.mZipList){var n=this.mZipList[r],o=n.file(i);if(o)return egret.$callAsync(this.onItemLoadSuccess,this,this.transfromZipObjectData(o,t,e),t,!0),!0}return!1},i.prototype.loadResAsyn=function(t,e,i){if(TLog.Assert(null!=t),t=t.replace(/\\/g,"/"),this.mErrorResPathMap[t])return void egret.callLater(e.onResItemError,e,t);var r=this.mItemCallbackMap[t];if(null==r&&(r=this.mItemCallbackMap[t]=[]),-1==r.indexOf(e)&&(r.push(e),null!=i&&(this.mResExplicitType[t]=i),!this.mbSearchZipFirst||!this.loadZipRes(t)))if(RES.hasRes(t))RES.getResAsync(t,this.onItemLoadSuccess,this);else{var n=this.mRootPath+this.getPathInterval(t);if(this.checkResItemCache(t,this.mRootPath))return;RES.getResByUrl(n,this.onItemLoadSuccess,this,i)}},i.prototype.destroyRes=function(t){RES.destroyRes(t,!0),this.clearResPath(t)},i.prototype.clearResPath=function(t){delete this.mPath2ResItem[t]},i.prototype.cancelResAsyn=function(t){for(var e in this.mItemCallbackMap){var i=this.mItemCallbackMap[e],r=i.indexOf(t);-1!=r&&i.splice(r,1)}},i.prototype.getRes=function(t){return RES.getRes(t)
},i.prototype.addZipPacket=function(e,i){e=e.replace(/\\/g,"/");var r=this.mZipList[e];if(r)return void(i&&i.onZipItemLoad(e,0));var n=this,o={onResItemLoad:function(t){var r=JSZip(t.getData());r?(n.mZipList[t.getKey()]=r,i&&i.onZipItemLoad(t.getKey(),-1)):i&&i.onZipItemLoad(e,0)},onResItemError:function(t){i&&i.onZipItemLoad(t,-1)}};this.loadResAsyn(e,o,t.ResourceType.TYPE_BIN)},i.prototype.getZipPacketCount=function(){var t=0;for(var e in this.mZipList)t++;return t},i.prototype.startH5CrossOrigin=function(e){if(null!=e){this.mbH5CrossOrign=!0;var i=new RES.web.Html5VersionController;i.getVirtualUrl=function(t){return e+t},RES.registerVersionController(i),RES.registerAnalyzer(RES.ResourceItem.TYPE_IMAGE,t.CrossJsonpImageAnalyzer)}},i.prototype.checkResItemCache=function(t,e){var i=e+this.getPathInterval(t),r=this.mPath2ResItem[i];return null!=r?(r.retain(),void egret.callLater(this.onResItemLoad,this,r)):void 0},i.prototype.onResItemLoad=function(t){var e=t.getKey(),i=this.mItemCallbackMap[e];i&&(i.forEach(function(e){e.onResItemLoad(t)}),delete this.mItemCallbackMap[e]),delete this.mResExplicitType[e],t.release()},i.prototype.onItemLoadSuccess=function(e,i,r){if(null==e)return void TLog.Warn("onItemLoadSuccess data null ->"+i);r=!!r;var n=i;""!=this.mRootPath&&0==i.indexOf(this.mRootPath)&&(i=i.substring(this.mRootPath.length)),""!=this.mLanguagePath&&0==i.indexOf(this.mLanguagePath)&&(i=i.substring(this.mLanguagePath.length));var o=this.mPath2ResItem[n];null==o&&(o=t.ResItem.createObj(i,n,e,r),this.mPath2ResItem[n]=o),o.retain(),this.onResItemLoad(o)},i.prototype.onItemLoadError=function(t){if(""!=t.groupName);else{var e=t.resItem.name;if(""!=this.mRootPath&&0==e.indexOf(this.mRootPath)&&(e=e.substring(this.mRootPath.length)),""!=this.mLanguagePath&&0==e.indexOf(this.mLanguagePath)&&(e=e.substring(this.mLanguagePath.length)),0==this.mbSearchZipFirst&&this.loadZipRes(e))return;this.mErrorResPathMap[e]=!0;var i=this.mItemCallbackMap[e];i&&(i.forEach(function(t){t.onResItemError(e)}),delete this.mItemCallbackMap[e]),delete this.mResExplicitType[e]}TLog.Error("onItemLoadError:"+t.resItem.name+" Url:"+t.resItem.url+" has failed to load")},i}(TClass);t.ResManager=i,__reflect(i.prototype,"core.ResManager")}(core||(core={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mEffectResList=[],this.mMusicResList=[],this.mMaxEffectCacheCount=20,this.mMaxMusicCacheCount=3,this.mMusicChannel=null,this.mCurrentMusicName="",this.mLastMusicName="",this.mMusicLoop=!0,this.mSoundChannelMap={}},i.prototype.destory=function(){},i.prototype.setMaxCache=function(t,e){this.mMaxEffectCacheCount=t,this.mMaxMusicCacheCount=e},i.prototype.playSoundImp=function(t,e){if(null!=t)if(e){var i=this.mSoundChannelMap[t.hashCode];i&&i.stop(),t.type=egret.Sound.EFFECT,this.mSoundChannelMap[t.hashCode]=t.play(0,1)}else{this.mMusicChannel&&(this.mMusicChannel.stop(),this.mMusicChannel=null),t.type=egret.Sound.MUSIC;var r=-1;0==this.mMusicLoop&&(r=1),this.mMusicChannel=t.play(0,r)}},i.prototype.playEffect=function(e){var i=this;this.mEffectResList.length>this.mMaxEffectCacheCount&&(this.mEffectResList.forEach(function(t){var e=t.getData(),r=i.mSoundChannelMap[e.hashCode];r&&(r.stop(),delete i.mSoundChannelMap[e.hashCode]),t.release()}),this.mEffectResList.length=0);for(var r=0;r<this.mEffectResList.length;r++){var n=this.mEffectResList[r];if(n.getKey()==e)return void this.playSoundImp(n.getData(),!0)}var o=this,a={onResItemLoad:function(t){var e=t.getData();t.retain(),o.mEffectResList.push(t),o.playSoundImp(e,!0)},onResItemError:function(t){}};t.ResManager.getInstance().loadResAsyn(e,a)},i.prototype.playMusic=function(e,i){if(this.mCurrentMusicName!=e){if(!e)return void TLog.Error("SoundManager.playMusic name == null");null==i&&(i=!0),this.mMusicLoop=i,this.mMusicResList.length>this.mMaxMusicCacheCount&&(this.mMusicResList.forEach(function(t){t.release()}),this.mMusicResList.length=0);for(var r=0;r<this.mMusicResList.length;r++){var n=this.mMusicResList[r];if(n.getKey()==e)return this.mCurrentMusicName=e,void this.playSoundImp(n.getData(),!1)}this.mLastMusicName=this.mCurrentMusicName,this.mCurrentMusicName=e,t.ResManager.getInstance().loadResAsyn(e,this)}},i.prototype.stop=function(){this.mMusicChannel&&(this.mMusicChannel.stop(),this.mMusicChannel=null),this.mCurrentMusicName=""},i.prototype.clear=function(){this.stop(),this.mEffectResList.length>this.mMaxEffectCacheCount&&(this.mEffectResList.forEach(function(t){var e=t.getData();e.close(),t.release()}),this.mEffectResList.length=0),this.mMusicResList.length>this.mMaxMusicCacheCount&&(this.mMusicResList.forEach(function(t){var e=t.getData();e.close(),t.release()}),this.mMusicResList.length=0)},i.prototype.onResItemLoad=function(t){t.retain(),this.mMusicResList.push(t),this.mCurrentMusicName==t.getKey()&&(this.stop(),this.playSoundImp(t.getData(),!1))},i.prototype.onResItemError=function(t){this.mCurrentMusicName=this.mLastMusicName},i}(TClass);t.SoundManager=e,__reflect(e.prototype,"core.SoundManager",["core.ResItemCallback"])}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.TextureDisposeEvent="TextureDisposeEvent",e}(t.EventArgs);t.TextureEvent=e,__reflect(e.prototype,"core.TextureEvent");var i=function(){function t(){}return t}();__reflect(i.prototype,"TextureRes");var r=function(r){function n(){return null!==r&&r.apply(this,arguments)||this}return __extends(n,r),n.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTextureResMap={},this.mCallbackMap={},this.mCheckTime=5e3,this.mDisposeTime=6e4,this.delayTime=0},n.prototype.destory=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.res.release()}this.mTextureResMap={}},n.prototype.setAutoDisposeTime=function(t,e){this.mCheckTime=t,this.mDisposeTime=e},n.prototype.loadTextureAsyn=function(e,i){e=e.replace(/\\/g,"/");var r=this.mTextureResMap[e];if(r){var n=r.res,o=n.getData();return void i.onAsynTextureSucceed(e,o,n)}var a=this.mCallbackMap[e];if(null==a&&(a=this.mCallbackMap[e]=[]),-1==a.indexOf(i)){a.push(i);var s=t.ResManager.getInstance();s.loadResAsyn(e,this,t.ResourceType.TYPE_IMAGE)}},n.prototype.cancelTextureAsyn=function(t,e){var i=this.mCallbackMap[t];if(i){var r=i.indexOf(e);-1!=r&&i.splice(r)}},n.prototype.cancelTextureAsynAll=function(t){for(var e in this.mCallbackMap)this.cancelTextureAsyn(e,t)},n.prototype.onResItemLoad=function(t){var e=t.getKey(),r=t.getData(),n=this.mCallbackMap[e];if(n.length>0&&null!=r.bitmapData){if(null==this.mTextureResMap[e]){t.retain();var o=new i;o.res=t,o.noUseBeginTime=-1,this.mTextureResMap[e]=o}n.forEach(function(i){i.onAsynTextureSucceed(e,r,t)}),delete this.mCallbackMap[e]}},n.prototype.onResItemError=function(t){},n.prototype.getTexture=function(t){var e=this.mTextureResMap[t];return e?e.res.getData():null},n.prototype.checkBitmapRefrence=function(t){var e=egret.BitmapData._displayList,i=e[t.hashCode];return i?i.length:0},n.prototype.onUpdate=function(){var i=this;if(this.delayTime+=t.TimeStamp.DelayTime,this.delayTime>this.mCheckTime){var r=t.TimeStamp.CurrentTime-this.mDisposeTime,n=[];for(var o in this.mTextureResMap){var a=this.mTextureResMap[o],s=a.res.getData(),h=s.bitmapData;TLog.Assert(null!=h),0==this.checkBitmapRefrence(h)&&1==a.res.getReferenceCount()?a.noUseBeginTime<0&&(a.noUseBeginTime=t.TimeStamp.CurrentTime):a.noUseBeginTime=-1,a.noUseBeginTime>=0&&a.noUseBeginTime<r&&n.push(a)}n.length>0&&n.forEach(function(r){var n=r.res,o=n.getKey();delete i.mTextureResMap[o],n.release();var a=e.createObj();a.path=o,i.fireEvent(t.TextureEvent.TextureDisposeEvent,a)}),this.delayTime=0}},n}(t.EventSet);t.TextureManager=r,__reflect(r.prototype,"core.TextureManager",["core.ResItemCallback"])}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._managedObjectArray=[]},e.prototype.addObject=function(t){TLog.Assert(null!=t.retain&&null!=t.release),this._managedObjectArray.push(t)},e.prototype.clear=function(){this._managedObjectArray.length>0&&(this._managedObjectArray.forEach(function(t){t.release()}),this._managedObjectArray.length=0)},e}(TClass);t.AutoreleasePool=e,__reflect(e.prototype,"core.AutoreleasePool")}(core||(core={}));var BinaryStream=function(t){function e(e){var i=t.call(this,e)||this;return i.setNetMode(!1),i}return __extends(e,t),e.prototype.setNetMode=function(t){t?this.endian=egret.Endian.BIG_ENDIAN:this.endian=egret.Endian.LITTLE_ENDIAN},e.prototype.readString=function(){return this.readUTF()},e.prototype.readUInt=function(){return this.readUnsignedInt()},e.prototype.readUShort=function(){return this.readUnsignedShort()},e.prototype.readUChar=function(){return this.readUnsignedByte()},e.prototype.readChar=function(){return this.readByte()},e.prototype.writeString=function(t){this.writeUTF(t)},e.prototype.writeUInt=function(t){this.writeUnsignedInt(t)},e.prototype.writeUShort=function(t){this.writeUnsignedShort(t)},e.prototype.writeUChar=function(t){this.writeByte(t)},e.prototype.writeChar=function(t){this.writeByte(t)},e}(egret.ByteArray);__reflect(BinaryStream.prototype,"BinaryStream");var core;!function(t){var e=function(){function t(){this.mData={}}return t.prototype.initWithJson=function(t){TLog.Assert(null!=t);for(var e in t)this.mData[e]=t[e]},t.prototype.getString=function(t,e){var i=this.mData[t];return"string"==typeof i?i:i?i.toString():e||""},t.prototype.getNumber=function(t,e){var i=this.mData[t];if("number"==typeof i)return i;var r=Number(i).valueOf();return isNaN(r)?e||0:r},t.prototype.getBoolean=function(t,e){var i=this.mData[t];return void 0===i?!!e:!!i},t.prototype.getData=function(t,e){var i=this.mData[t];return void 0===i?e:i},t}();t.ConfigFile=e,__reflect(e.prototype,"core.ConfigFile")}(core||(core={}));var core;!function(t){var e=function(){function t(){}return t.Rectangle_setLTRB=function(t,e,i,r,n){t.left=e,t.top=i,t.right=r,t.bottom=n},t.nodeToStageXY=function(t,e,i){var r=new egret.Point,n=t.$getConcatenatedMatrix();return n.transformPoint(e,i,r),r},t.stageToNodeXY=function(t,e,i){var r=new egret.Point,n=t.$getInvertedConcatenatedMatrix();return n.transformPoint(e,i,r),r},t.hitTestRect=function(t,e,i){var r=new egret.Point,n=t.$getInvertedConcatenatedMatrix();return n.transformPoint(e,i,r),r.x>=0&&r.y>=0&&r.x<=t.width&&r.y<=t.height},t}();t.EgretUtil=e,__reflect(e.prototype,"core.EgretUtil")}(core||(core={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mUrl="",this.mParamMsg="",this.mbEnable=!1,this.mParamList={},this.mbSend=!1},e.prototype.destory=function(){},e.prototype.setReportUrl=function(t){this.mUrl=t},e.prototype.setUserParamMsg=function(t){this.mParamMsg=t},e.prototype.addUserParam=function(t,e){if(null!=t&&""!=t){null==e?delete this.mParamList[t]:this.mParamList[t]=e;var i="";for(var r in this.mParamList){var n=this.mParamList[r],o=r+"="+n;""!=i&&(o="&"+o),i+=o}this.setUserParamMsg(i)}},e.prototype.setReportEnable=function(t){this.mbEnable=!0},e.prototype.isReportEnable=function(){return this.mbEnable},e.prototype.captureError=function(t){if(TLog.Error(t.stack),0!=this.mbEnable&&""!=this.mUrl&&!this.mbSend){this.mbSend=!0;var e=new egret.HttpRequest;e.open(this.mUrl,egret.HttpMethod.POST),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var i=t.stack,r="";r=""==this.mParamMsg?String.format("luaError=%s",i):String.format("%s&luaError=%s",this.mParamMsg,i),e.send(r)}},e}(TClass);t.ErrorReport=e,__reflect(e.prototype,"core.ErrorReport")}(core||(core={}));var JsUtil=function(){function t(){}return t.arrayPush=function(t,e){return-1==t.indexOf(e)?(t.push(e),!0):!1},t.arrayInstert=function(t,e,i){null==i&&(i=e,e=t.length),t.splice(e,0,i)},t.arrayRemove=function(t,e){if(t.length<=0)return null;null==e&&(e=t.length-1);var i=t[e];return t.splice(e,1),i},t.arrayRemoveVal=function(t,e){var i=t.indexOf(e);return-1==i?!1:(t.splice(i,1),!0)},t.arrayExsit=function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(r==e)return!0}return!1},t.objectForEach=function(t,e){if(Array.isArray(t))for(var i=t,r=0;r<i.length;r++){var n=t[r],o=!!e(n,r);if(o)return}else for(var a in t){var n=t[a],o=!!e(n,a);if(o)return}},t.objectCopy=function(t){if(null==t)return null;if("object"!=typeof t)return t;var e=null;if(Array.isArray(t)){e=[];for(var i=0;i<t.length;i++){var r=t[i];"object"==typeof r&&null!=r?e[i]=this.objectCopy(r):e[i]=r}}else{e={};for(var i in t)if("prototype"!=i&&t.hasOwnProperty(i)){var r=t[i];"object"==typeof r&&null!=r?e[i]=this.objectCopy(r):e[i]=r}}return e},t.objectCopyEx=function(t,e){if(null==t||null==e)return!1;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=this.objectCopy(e[i]);else for(var i in e)"prototype"!=i&&e.hasOwnProperty(i)&&(t[i]=this.objectCopy(e[i]));return!0},t.objectFindIndexWithValue=function(t,e){for(var i in t){var r=t[i];if(r==e)return i}return null},t.JsonEncode=function(t){return JSON.stringify(t,null,1)},t.JsonDecode=function(t){return JSON.parse(t)},t.JsonDecodeSafeFormat=function(t){return t=t.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"),JSON.parse(t)},t.UrlEncode=function(t){return encodeURI(t)},t.UrlDecode=function(t){return decodeURI(t)},t.toString=function(t){return String(t)},t.toNumber=function(t,e){if(""==t)return e;var i=Number(t);return isNaN(i)?e:i},t.isNaN=function(t){return isNaN(t)},t.isFinite=function(t){return isFinite(t)},t.parseFloat=function(t){return parseFloat(t)},t.parseInt=function(t,e){return parseInt(t,e)},t.loadScript=function(t,e){if(egret.Capabilities.runtimeType!=egret.RuntimeType.WEB)return void TLog.Error("loadJsScript",t);var i=document.createElement("script");i.src=t;var r=null;r=function(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),e&&e()},i.addEventListener("load",r,!1),document.body.appendChild(i)},t}();__reflect(JsUtil.prototype,"JsUtil");var core;!function(t){function e(){return egret.getTimer()}var i=function(){function t(){}return t.DelayTime=0,t.CurrentTime=0,t.CurrentFrame=0,t}();t.TimeStamp=i,__reflect(i.prototype,"core.TimeStamp"),t.getCpuTime=e}(core||(core={}));var TLog=function(){function t(){}return t.Debug=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.s_bEnable&&console.log.apply(console,["Debug:"+t].concat(e))},t.Warn=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.s_bEnable&&console.warn.apply(console,["Warn:"+t].concat(e))},t.Error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error.apply(console,["Error:"+t].concat(e))},t.Assert=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!this.s_bEnable)return!0;if(0!==t){if(!t)throw new Error(String.format(e,i));return!0}},t.Throw=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.s_bEnable)throw new Error(String.format(t,e))},t.SetEnable=function(t){this.s_bEnable=t},t.s_bEnable=!0,t}();__reflect(TLog.prototype,"TLog");var TXML=function(){function t(){}return t.parse=function(t){var e=null;try{e=egret.XML.parse(t)}catch(i){TLog.Error("xml error:"+t),e=null}return e},t.findChild=function(t,e){for(var i=t.children.length,r=0;i>r;r++){var n=t.children[r];if(1==n.nodeType){var o=n;if(o.name==e)return o}}return null},t.queryText=function(t){for(var e=t.children.length,i=0;e>i;i++){var r=t.children[i];if(3==r.nodeType){var n=r;return n.text}}return""},t.queryIntText=function(e,i){var r=t.queryText(e),n=parseInt(r);return 1==isNaN(n)?i:n},t.queryAttribute=function(t,e,i){return null==i&&(i=""),e in t.attributes?t.attributes[e]:i},t.queryIntAttribute=function(e,i,r){var n=t.queryAttribute(e,i),o=parseInt(n);return 1==isNaN(o)?r:o},t.forEach=function(t,e){for(var i=t.children.length,r=0;i>r;r++){var n=t.children[r];1==n.nodeType&&e(n)}},t}();__reflect(TXML.prototype,"TXML");var core;!function(t){function e(t,e,i){for(var r,n,o,a=e-1,s=t[a],h=t[0],l=2654435769,u=Math.floor(6+52/(a+1)),p=0;0<u--;){for(p=p+l&4294967295,n=p>>>2&3,o=0;a>o;o++)h=t[o+1],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(p^h)+(i[3&o^n]^s),s=t[o]=t[o]+r&4294967295;h=t[0],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(p^h)+(i[3&o^n]^s),s=t[a]=t[a]+r&4294967295}}function i(t,e,i){for(var r,n,o,a=e-1,s=t[a-1],h=t[0],l=2654435769,u=Math.floor(6+52/(a+1)),p=u*l&4294967295;0!=p;){for(n=p>>>2&3,o=a;o>0;o--)s=t[o-1],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(p^h)+(i[3&o^n]^s),h=t[o]=t[o]-r&4294967295;s=t[a],r=(s>>>5^h<<2)+(h>>>3^s<<4)^(p^h)+(i[3&o^n]^s),h=t[0]=t[0]-r&4294967295,p=p-l&4294967295}}function r(t,e,i,r){var n=null,o=0,a=i>>2;a=0==(3&i)?a:a+1,r?(n=t?new Uint32Array(t.buffer):new Uint32Array(a+1<<2),n[a]=i,o=a+1):(n=t?new Uint32Array(t.buffer):new Uint32Array(a<<2),o=a);for(var s=0;i>s;s++)n[s>>2]|=e[s]<<((3&s)<<3);return[n,o]}function n(t,e,i){var r=0,n=0,o=0;if(n=e<<2,i){if(o=t[e-1],n-7>o||o>n-4)return null;n=o}var a=new Uint8Array(n);for(r=0;n>r;r++)a[r]=t[r>>2]>>((3&r)<<3)&255;return a}function o(t,i,o){var a=new Uint8Array(32),s=r(null,t,i,1),h=s[0],l=s[1],u=r(a,o,16,0),p=u[0];u[1];e(h,l,p);var m=n(h,l,0);return m}function a(t,e,o){var a=new Uint8Array(32),s=r(null,t,e,0),h=s[0],l=s[1],u=r(a,o,16,0),p=u[0];u[1];i(h,l,p);var m=n(h,l,1);return m}new Uint32Array(1);t.xxteaEncrypt=o,t.xxteaDecrypt=a}(core||(core={}));var gui;!function(t){function e(t){if(null==n&&i(),t in o){var e=o[t];return n[e]}return TLog.Error("GetColorFromName can not get color %s error",t),0}function i(){n=[],o={},n[0]=r.aliceblue,n[1]=r.antiquewhite,n[2]=r.aqua,n[3]=r.aquamarine,n[4]=r.azure,n[5]=r.beige,n[6]=r.bisque,n[7]=r.black,n[8]=r.blanchedalmond,n[9]=r.blue,n[10]=r.blueviolet,n[11]=r.brown,n[12]=r.burlywood,n[13]=r.cadetblue,n[14]=r.chartreuse,n[15]=r.chocolate,n[16]=r.coral,n[17]=r.cornflowerblue,n[18]=r.cornsilk,n[19]=r.crimson,n[20]=r.cyan,n[21]=r.darkblue,n[22]=r.darkcyan,n[23]=r.darkgoldenrod,n[24]=r.darkgray,n[25]=r.darkgreen,n[26]=r.darkkhaki,n[27]=r.darkmagenta,n[28]=r.darkolivegreen,n[29]=r.darkorange,n[30]=r.darkorchid,n[31]=r.darkred,n[32]=r.darksalmon,n[33]=r.darkseagreen,n[34]=r.darkslateblue,n[35]=r.darkslategray,n[36]=r.darkturquoise,n[37]=r.darkviolet,n[38]=r.deeppink,n[39]=r.deepskyblue,n[40]=r.dimgray,n[41]=r.dodgerblue,n[42]=r.firebrick,n[43]=r.floralwhite,n[44]=r.forestgreen,n[45]=r.fuchsia,n[46]=r.gainsboro,n[47]=r.ghostwhite,n[48]=r.gold,n[49]=r.goldenrod,n[50]=r.gray,n[51]=r.green,n[52]=r.greenyellow,n[53]=r.honeydew,n[54]=r.hotpink,n[55]=r.indianred,n[56]=r.indigo,n[57]=r.ivory,n[58]=r.khaki,n[59]=r.lavender,n[60]=r.lavenderblush,n[61]=r.lawngreen,n[62]=r.lemonchiffon,n[63]=r.lightblue,n[64]=r.lightcoral,n[65]=r.lightcyan,n[66]=r.lightgoldenrodyellow,n[67]=r.lightgreen,n[68]=r.lightgrey,n[69]=r.lightpink,n[70]=r.lightsalmon,n[71]=r.lightseagreen,n[72]=r.lightskyblue,n[73]=r.lightslategray,n[74]=r.lightsteelblue,n[75]=r.lightyellow,n[76]=r.lime,n[77]=r.limegreen,n[78]=r.linen,n[79]=r.magenta,n[80]=r.maroon,n[81]=r.mediumaquamarine,n[82]=r.mediumblue,n[83]=r.mediumorchid,n[84]=r.mediumpurple,n[85]=r.mediumseagreen,n[86]=r.mediumslateblue,n[87]=r.mediumspringgreen,n[88]=r.mediumturquoise,n[89]=r.mediumvioletred,n[90]=r.midnightblue,n[91]=r.mintcream,n[92]=r.mistyrose,n[93]=r.moccasin,n[94]=r.navajowhite,n[95]=r.navy,n[96]=r.oldlace,n[97]=r.olive,n[98]=r.olivedrab,n[99]=r.orange,n[100]=r.orangered,n[101]=r.orchid,n[102]=r.palegoldenrod,n[103]=r.palegreen,n[104]=r.paleturquoise,n[105]=r.palevioletred,n[106]=r.papayawhip,n[107]=r.peachpuff,n[108]=r.peru,n[109]=r.pink,n[110]=r.plum,n[111]=r.powderblue,n[112]=r.purple,n[113]=r.red,n[114]=r.rosybrown,n[115]=r.royalblue,n[116]=r.saddlebrown,n[117]=r.salmon,n[118]=r.sandybrown,n[119]=r.seagreen,n[120]=r.seashell,n[121]=r.sienna,n[122]=r.silver,n[123]=r.skyblue,n[124]=r.slateblue,n[125]=r.slategray,n[126]=r.snow,n[127]=r.springgreen,n[128]=r.steelblue,n[129]=r.tan,n[130]=r.teal,n[131]=r.thistle,n[132]=r.tomato,n[133]=r.turquoise,n[134]=r.violet,n[135]=r.wheat,n[136]=r.white,n[137]=r.whitesmoke,n[138]=r.yellow,n[139]=r.yellowgreen,n[140]=r.zongse,n[141]=r.zongse02,n[142]=r.rouse,n[143]=r.rouse02,n[144]=r.lvse,n[145]=r.hongse,n[146]=r.lvse02,n[147]=r.ublack,o.aliceblue=0,o.antiquewhite=1,o.aqua=2,o.aquamarine=3,o.azure=4,o.beige=5,o.bisque=6,o.black=7,o.blanchedalmond=8,o.blue=9,o.blueviolet=10,o.brown=11,o.burlywood=12,o.cadetblue=13,o.chartreuse=14,o.chocolate=15,o.coral=16,o.cornflowerblue=17,o.cornsilk=18,o.crimson=19,o.cyan=20,o.darkblue=21,o.darkcyan=22,o.darkgoldenrod=23,o.darkgray=24,o.darkgreen=25,o.darkkhaki=26,o.darkmagenta=27,o.darkolivegreen=28,o.darkorange=29,o.darkorchid=30,o.darkred=31,o.darksalmon=32,o.darkseagreen=33,o.darkslateblue=34,o.darkslategray=35,o.darkturquoise=36,o.darkviolet=37,o.deeppink=38,o.deepskyblue=39,o.dimgray=40,o.dodgerblue=41,o.firebrick=42,o.floralwhite=43,o.forestgreen=44,o.fuchsia=45,o.gainsboro=46,o.ghostwhite=47,o.gold=48,o.goldenrod=49,o.gray=50,o.green=51,o.greenyellow=52,o.honeydew=53,o.hotpink=54,o.indianred=55,o.indigo=56,o.ivory=57,o.khaki=58,o.lavender=59,o.lavenderblush=60,o.lawngreen=61,o.lemonchiffon=62,o.lightblue=63,o.lightcoral=64,o.lightcyan=65,o.lightgoldenrodyellow=66,o.lightgreen=67,o.lightgrey=68,o.lightpink=69,o.lightsalmon=70,o.lightseagreen=71,o.lightskyblue=72,o.lightslategray=73,o.lightsteelblue=74,o.lightyellow=75,o.lime=76,o.limegreen=77,o.linen=78,o.magenta=79,o.maroon=80,o.mediumaquamarine=81,o.mediumblue=82,o.mediumorchid=83,o.mediumpurple=84,o.mediumseagreen=85,o.mediumslateblue=86,o.mediumspringgreen=87,o.mediumturquoise=88,o.mediumvioletred=89,o.midnightblue=90,o.mintcream=91,o.mistyrose=92,o.moccasin=93,o.navajowhite=94,o.navy=95,o.oldlace=96,o.olive=97,o.olivedrab=98,o.orange=99,o.orangered=100,o.orchid=101,o.palegoldenrod=102,o.palegreen=103,o.paleturquoise=104,o.palevioletred=105,o.papayawhip=106,o.peachpuff=107,o.peru=108,o.pink=109,o.plum=110,o.powderblue=111,o.purple=112,o.red=113,o.rosybrown=114,o.royalblue=115,o.saddlebrown=116,o.salmon=117,o.sandybrown=118,o.seagreen=119,o.seashell=120,o.sienna=121,o.silver=122,o.skyblue=123,o.slateblue=124,o.slategray=125,o.snow=126,o.springgreen=127,o.steelblue=128,o.tan=129,o.teal=130,o.thistle=131,o.tomato=132,o.turquoise=133,o.violet=134,o.wheat=135,o.white=136,o.whitesmoke=137,o.yellow=138,o.yellowgreen=139,o.zongse=140,o.zongse02=141,o.rouse=142,o.rouse02=143,o.lvse=144,o.hongse=145,o.lvse02=146,o.ublack=147}var r;!function(t){t[t.aliceblue=15792383]="aliceblue",t[t.antiquewhite=16444375]="antiquewhite",t[t.aqua=65535]="aqua",t[t.aquamarine=8388564]="aquamarine",t[t.azure=15794175]="azure",t[t.beige=16119260]="beige",t[t.bisque=16770244]="bisque",t[t.black=0]="black",t[t.blanchedalmond=16772045]="blanchedalmond",t[t.blue=255]="blue",t[t.blueviolet=9055202]="blueviolet",t[t.brown=10824234]="brown",t[t.burlywood=14596231]="burlywood",t[t.cadetblue=6266528]="cadetblue",t[t.chartreuse=8388352]="chartreuse",t[t.chocolate=13789470]="chocolate",t[t.coral=16744272]="coral",t[t.cornflowerblue=6591981]="cornflowerblue",t[t.cornsilk=16775388]="cornsilk",t[t.crimson=14423100]="crimson",t[t.cyan=65535]="cyan",t[t.darkblue=139]="darkblue",t[t.darkcyan=35723]="darkcyan",t[t.darkgoldenrod=12092939]="darkgoldenrod",t[t.darkgray=11119017]="darkgray",t[t.darkgreen=25600]="darkgreen",t[t.darkkhaki=12433259]="darkkhaki",t[t.darkmagenta=9109643]="darkmagenta",t[t.darkolivegreen=5597999]="darkolivegreen",t[t.darkorange=16747520]="darkorange",t[t.darkorchid=10040012]="darkorchid",t[t.darkred=9109504]="darkred",t[t.darksalmon=15308410]="darksalmon",t[t.darkseagreen=9419915]="darkseagreen",t[t.darkslateblue=4734347]="darkslateblue",t[t.darkslategray=3100495]="darkslategray",t[t.darkturquoise=52945]="darkturquoise",t[t.darkviolet=9699539]="darkviolet",t[t.deeppink=16716947]="deeppink",t[t.deepskyblue=49151]="deepskyblue",t[t.dimgray=6908265]="dimgray",t[t.dodgerblue=2003199]="dodgerblue",t[t.firebrick=11674146]="firebrick",t[t.floralwhite=16775920]="floralwhite",t[t.forestgreen=2263842]="forestgreen",t[t.fuchsia=16711935]="fuchsia",t[t.gainsboro=14474460]="gainsboro",t[t.ghostwhite=16316671]="ghostwhite",t[t.gold=16766720]="gold",t[t.goldenrod=14329120]="goldenrod",t[t.gray=8421504]="gray",t[t.green=32768]="green",t[t.greenyellow=11403055]="greenyellow",t[t.honeydew=15794160]="honeydew",t[t.hotpink=16738740]="hotpink",t[t.indianred=13458524]="indianred",t[t.indigo=4915330]="indigo",t[t.ivory=16777200]="ivory",t[t.khaki=15787660]="khaki",t[t.lavender=15132410]="lavender",t[t.lavenderblush=16773365]="lavenderblush",t[t.lawngreen=8190976]="lawngreen",t[t.lemonchiffon=16775885]="lemonchiffon",t[t.lightblue=11393254]="lightblue",t[t.lightcoral=15761536]="lightcoral",t[t.lightcyan=14745599]="lightcyan",t[t.lightgoldenrodyellow=16448210]="lightgoldenrodyellow",t[t.lightgreen=9498256]="lightgreen",t[t.lightgrey=13882323]="lightgrey",t[t.lightpink=16758465]="lightpink",t[t.lightsalmon=16752762]="lightsalmon",t[t.lightseagreen=2142890]="lightseagreen",t[t.lightskyblue=8900346]="lightskyblue",t[t.lightslategray=7833753]="lightslategray",t[t.lightsteelblue=11584734]="lightsteelblue",t[t.lightyellow=16777184]="lightyellow",t[t.lime=65280]="lime",t[t.limegreen=3329330]="limegreen",t[t.linen=16445670]="linen",t[t.magenta=16711935]="magenta",t[t.maroon=8388608]="maroon",t[t.mediumaquamarine=6737322]="mediumaquamarine",t[t.mediumblue=205]="mediumblue",t[t.mediumorchid=12211667]="mediumorchid",t[t.mediumpurple=9662683]="mediumpurple",t[t.mediumseagreen=3978097]="mediumseagreen",t[t.mediumslateblue=8087790]="mediumslateblue",t[t.mediumspringgreen=64154]="mediumspringgreen",t[t.mediumturquoise=4772300]="mediumturquoise",t[t.mediumvioletred=13047173]="mediumvioletred",t[t.midnightblue=1644912]="midnightblue",t[t.mintcream=16121850]="mintcream",t[t.mistyrose=16770273]="mistyrose",t[t.moccasin=16770229]="moccasin",t[t.navajowhite=16768685]="navajowhite",t[t.navy=128]="navy",t[t.oldlace=16643558]="oldlace",t[t.olive=8421376]="olive",t[t.olivedrab=7048739]="olivedrab",t[t.orange=16753920]="orange",t[t.orangered=16729344]="orangered",t[t.orchid=14315734]="orchid",t[t.palegoldenrod=15657130]="palegoldenrod",t[t.palegreen=10025880]="palegreen",t[t.paleturquoise=11529966]="paleturquoise",t[t.palevioletred=14381203]="palevioletred",t[t.papayawhip=16773077]="papayawhip",t[t.peachpuff=16767673]="peachpuff",t[t.peru=13468991]="peru",t[t.pink=16761035]="pink",t[t.plum=14524637]="plum",t[t.powderblue=11591910]="powderblue",t[t.purple=8388736]="purple",t[t.red=16711680]="red",t[t.rosybrown=12357519]="rosybrown",t[t.royalblue=4286945]="royalblue",t[t.saddlebrown=9127187]="saddlebrown",t[t.salmon=16416882]="salmon",t[t.sandybrown=16032864]="sandybrown",t[t.seagreen=3050327]="seagreen",t[t.seashell=16774638]="seashell",t[t.sienna=10506797]="sienna",t[t.silver=12632256]="silver",t[t.skyblue=8900331]="skyblue",t[t.slateblue=6970061]="slateblue",t[t.slategray=7372944]="slategray",t[t.snow=16775930]="snow",t[t.springgreen=65407]="springgreen",t[t.steelblue=4620980]="steelblue",t[t.tan=13808780]="tan",t[t.teal=32896]="teal",t[t.thistle=14204888]="thistle",t[t.tomato=16737095]="tomato",t[t.turquoise=4251856]="turquoise",t[t.violet=15631086]="violet",t[t.wheat=16113331]="wheat",t[t.white=16777215]="white",t[t.whitesmoke=16119285]="whitesmoke",t[t.yellow=16776960]="yellow",t[t.yellowgreen=10145074]="yellowgreen",t[t.ublack=4535083]="ublack",t[t.zongse=4530441]="zongse",t[t.zongse02=4535083]="zongse02",t[t.rouse=15190421]="rouse",t[t.rouse02=16703170]="rouse02",t[t.lvse=14151544]="lvse",t[t.hongse=16658223]="hongse",t[t.lvse02=107265]="lvse02"}(r=t.Color||(t.Color={}));var n,o;t.GetColorFromName=e}(gui||(gui={}));var gui;!function(t){function e(t){var e=0;return"LEFT"==t?e|=n.LEFT:"LEFT"==t?e|=n.LEFT:"RIGHT"==t?e|=n.RIGHT:"TOP"==t?e|=n.TOP:"BOTTOM"==t?e|=n.BOTTOM:"V_CENTER"==t?e|=n.V_CENTER:"H_CENTER"==t?e|=n.H_CENTER:"V_REVERSE"==t?e|=n.V_REVERSE:"H_REVERSE"==t&&(e|=n.H_REVERSE),e}function i(t,e){if(e){var i=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(i);t.filters=[r]}else t.filters=null}var r=function(){function t(){}return t.TOUCH_LONG="LongTouchEvent",t.TOUCH_SHORT="ShortTouchEvent",t}();t.TouchEvent=r,__reflect(r.prototype,"gui.TouchEvent");var n;!function(t){t[t.LEFT=0]="LEFT",t[t.H_CENTER=1]="H_CENTER",t[t.RIGHT=2]="RIGHT",t[t.TOP=0]="TOP",t[t.V_CENTER=4]="V_CENTER",t[t.BOTTOM=8]="BOTTOM",t[t.LEFT_TOP=0]="LEFT_TOP",t[t.LEFT_CENTER=4]="LEFT_CENTER",t[t.LEFT_BOTTOM=8]="LEFT_BOTTOM",t[t.CENTER_TOP=1]="CENTER_TOP",t[t.CENTER_CENTER=5]="CENTER_CENTER",t[t.CENTER_BOTTOM=9]="CENTER_BOTTOM",t[t.RIGHT_TOP=2]="RIGHT_TOP",t[t.RIGHT_CENTER=6]="RIGHT_CENTER",t[t.RIGHT_BOTTOM=10]="RIGHT_BOTTOM",t[t.V_REVERSE=16]="V_REVERSE",t[t.H_REVERSE=32]="H_REVERSE"}(n=t.Flag||(t.Flag={}));var o;!function(t){t[t.BOLD=65536]="BOLD",t[t.ITALIC=131072]="ITALIC",t[t.UNDER_LINE=262144]="UNDER_LINE",t[t.FREE_TYPE_ALL=983040]="FREE_TYPE_ALL",t[t.SHADOW=1048576]="SHADOW",t[t.STROKE=2097152]="STROKE"}(o=t.FontFlag||(t.FontFlag={})),t.GetFlagFromName=e,t.GrayComponent=i}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(e,i){var r=t.call(this,e)||this;return r.window=i,r}return __extends(e,t),e}(egret.Event);t.GUIEvent=e,__reflect(e.prototype,"gui.GUIEvent");var i=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.link="",r}return __extends(e,t),e.prototype.getHyperlink=function(){return this.link},e.prototype.setHyperlink=function(t){this.link=t},e}(e);t.GUIHyperlinkEvent=i,__reflect(i.prototype,"gui.GUIHyperlinkEvent");var r=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.word="",r}return __extends(e,t),e.prototype.getTranslateWord=function(){return this.word},e.prototype.setTranslateWord=function(t){this.word=t},e}(e);t.GUITranslateWordEvent=r,__reflect(r.prototype,"gui.GUITranslateWordEvent");var n=function(t){function e(e,i){var r=t.call(this,e)||this;return r.handler=0,r.hoverTarget=i,r.showDriveTarget=null,r.userData=null,r}return __extends(e,t),e.prototype.setDriveBegin=function(t){t&&this.handler++},e.prototype.isDriveBegin=function(){return this.handler>0},e.prototype.setDriveOffXY=function(t,e){this.driveOffStageX=t,this.driveOffStageY=e},e.prototype.setShowDriveTarget=function(t){this.showDriveTarget=t},e.prototype.setUserData=function(t){this.userData=t},e.BeginDriveEvent="BeginDriveEvent",e.EndDriveEvent="EndDriveEvent",e}(egret.TouchEvent);t.GUIDriveEvent=n,__reflect(n.prototype,"gui.GUIDriveEvent")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTickList=[],this.mTouchTarget=null,this.mTouchBeginTime=-1,this.mbFireLongTouch=!1,this.mbTouchMove=!1,this.mDriveTargetSaveData=null,this.mbTouchDown=!1,this.mbInputEnableDelay=!0,this.mbInputEnable=this.mbInputEnableDelay},i.prototype.init=function(e,i){this.mStage=i,this.mUIRootNode=new egret.DisplayObjectContainer,this.mUIRootNode.name="UIRootNode",e.addChild(this.mUIRootNode),this.mBottomLayer=new eui.UILayer,this.mNormalLayer=new eui.UILayer,this.mModalLayer=new t.ModalLayer,this.mTopLayer=new eui.UILayer,this.mBottomLayer.name="BottomLayer",this.mBottomLayer.touchEnabled=!1,this.mNormalLayer.touchEnabled=!1,this.mNormalLayer.name="NormalLayer",this.mTopLayer.touchEnabled=!1,this.mTopLayer.name="TopLayer",this.mModalLayer.name="ModalLayer",this.mUIRootNode.addChild(this.mBottomLayer),this.mUIRootNode.addChild(this.mNormalLayer),this.mUIRootNode.addChild(this.mModalLayer),this.mUIRootNode.addChild(this.mTopLayer),egret.registerImplementation("eui.IAssetAdapter",new t.AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new t.ThemeAdapter),this.initGuiTouchEvent(),this.mDriveDisplayerObject=new egret.DisplayObjectContainer
},i.prototype.loadTheme=function(t,e,i){var r=new eui.Theme(t,this.mStage);r.addEventListener(eui.UIEvent.COMPLETE,function(r){e.call(i,t)},this)},i.prototype.parseLayoutString=function(t){var e=t.trim();if("<"==e.charAt(0)){var i=EXML.parse(e),r=new i;return r}return null},i.prototype.loadLayoutAsyn=function(t,e,i){function r(t,r){o++,o==n&&egret.callLater(e,i)}for(var n=t.length,o=0,a=0;n>a;a++)EXML.load(t[a],r,this,!0)},i.prototype.setDefaultFont=function(t){},i.prototype.isRootNode=function(t){return-1==this.mUIRootNode.getChildIndex(t)?!1:!0},i.prototype.setNodeLayer=function(t,e){if(null!=t){var i=this.getLayerNode(e);i.addChild(t)}},i.prototype.getLayerNode=function(t){if(null==t)return this.mNormalLayer;var e=this.mNormalLayer;switch(t){case 0:e=this.mBottomLayer;break;case 1:e=this.mNormalLayer;break;case 3:e=this.mTopLayer;break;case 2:e=this.mModalLayer}return e},i.prototype.addTickCallback=function(t){var e=this.mTickList.indexOf(t);0>e&&this.mTickList.push(t)},i.prototype.removeTickCallback=function(t){var e=this.mTickList.indexOf(t);e>=0&&this.mTickList.splice(e,1)},i.prototype.onUpdate=function(){for(var t=0;t<this.mTickList.length;t++){var e=this.mTickList[t];e.onTick()}if(this.mTouchBeginTime>0&&0==this.mbFireLongTouch){var i=core.getCpuTime();i-this.mTouchBeginTime>=200&&this.onLongTouchEvent()}},i.prototype.setUIVisible=function(t){this.mUIRootNode.visible=t},i.prototype.isUIVisible=function(){return this.mUIRootNode.visible},i.prototype.getPathFromChild=function(t){if(0==this.mUIRootNode.contains(t))return"";if(this.mUIRootNode.getChildIndex(t)>0)return"";for(var e=t,i=[];e&&(i.push(e),e=e.parent,!(this.mUIRootNode.getChildIndex(e)>=0)););var r="";if(i.length>0){for(var n=[],o=i.length-1;o>=0;o--){var a=i[o];n.push(a.name)}r=n.join("/")}return r},i.prototype.getChildFromPathImp=function(t,e){for(var i=t,r=0,n=0,o=e;n<o.length;n++){var a=o[n],s=i.getChildByName(a);if(null==s)return null;if(r++,i=s,!(i instanceof egret.DisplayObjectContainer))break}return r!=e.length?null:i},i.prototype.getChildFromPath=function(t){if(!t)return null;var e=t.split("/");if(0==e.length)return null;var i=this.getChildFromPathImp(this.mTopLayer,e);return null!=i?i:(i=this.getChildFromPathImp(this.mModalLayer,e),null!=i?i:(i=this.getChildFromPathImp(this.mNormalLayer,e),null!=i?i:(i=this.getChildFromPathImp(this.mBottomLayer,e),null!=i?i:null)))},i.prototype.setInputEnable=function(t){this.mbTouchDown&&0==t?(this.mbInputEnableDelay=!1,this.mbInputEnable=!0):(this.mbInputEnable=t,this.mbInputEnableDelay=t)},i.prototype.isInputEnable=function(){return this.mbInputEnable},i.prototype.startDriveTouch=function(){var e=new t.GUIDriveEvent(t.GUIDriveEvent.BeginDriveEvent,this.mTouchTarget);if(e.$initTo(this.mTouchX,this.mTouchY,this.mTouchId),this.mTouchTarget.dispatchEvent(e),e.isDriveBegin()){var i=this.mTouchTarget;null!=e.showDriveTarget&&(i=e.showDriveTarget);var r=i.parent.getChildIndex(i);this.mDriveTargetSaveData={target:this.mTouchTarget,parent:i.parent,x:i.x,y:i.y,showTarget:i,userData:e.userData,childIndex:r},TLog.Assert(null!=this.mDriveTargetSaveData.parent&&null==this.mDriveDisplayerObject.parent);var n=core.EgretUtil.nodeToStageXY(i,0,0),o=10;this.mDriveOffsetX=this.mTouchX-n.x+o,this.mDriveOffsetY=this.mTouchY-n.y+o,this.mDriveDisplayerObject.x=this.mTouchX-this.mDriveOffsetX,this.mDriveDisplayerObject.y=this.mTouchY-this.mDriveOffsetY,i.x=0,i.y=0,this.mDriveDisplayerObject.addChild(i),this.mTopLayer.addChild(this.mDriveDisplayerObject)}},i.prototype.stopDriveTouch=function(e,i,r){if(null!=this.mDriveTargetSaveData){var n=this.mDriveTargetSaveData.showTarget;n.x=this.mDriveTargetSaveData.x,n.y=this.mDriveTargetSaveData.y;var o=this.mDriveTargetSaveData.target;if(null==o.stage)return void(this.mDriveTargetSaveData=null);var a=this.mDriveTargetSaveData.userData;this.mDriveTargetSaveData.parent.addChildAt(n,this.mDriveTargetSaveData.childIndex),this.mTopLayer.removeChild(this.mDriveDisplayerObject);var s=this.mStage.$hitTest(e,i),h=new t.GUIDriveEvent(t.GUIDriveEvent.EndDriveEvent,s);h.$initTo(e,i,r),h.setDriveOffXY(this.mDriveOffsetX,this.mDriveOffsetY),h.userData=a,o.dispatchEvent(h),this.mDriveTargetSaveData=null}},i.prototype.moveDriveTouch=function(t,e,i){null!=this.mDriveTargetSaveData&&(this.mDriveDisplayerObject.x=t-this.mDriveOffsetX,this.mDriveDisplayerObject.y=e-this.mDriveOffsetY)},i.prototype.startTouch=function(t,e,i){this.mTouchTarget=this.mStage.$hitTest(t,e),this.mTouchTarget&&(this.mTouchBeginTime=core.getCpuTime()),this.mTouchX=t,this.mTouchY=e,this.mTouchId=i,this.mbTouchMove=!1,this.mbFireLongTouch=!1},i.prototype.stopTouch=function(){this.mTouchTarget&&(this.mTouchTarget=null,this.mTouchBeginTime=-1),this.mbFireLongTouch=!1,this.mbTouchMove=!1},i.prototype.onLongTouchEvent=function(){this.mbFireLongTouch||(this.mbFireLongTouch=!0,egret.TouchEvent.dispatchTouchEvent(this.mTouchTarget,t.TouchEvent.TOUCH_LONG,!0,!0,this.mTouchX,this.mTouchY,this.mTouchId,!0),this.startDriveTouch())},i.prototype.initGuiTouchEvent=function(){var e=this.mStage,i=this,r=3,n=egret.sys.TouchHandler.prototype.onTouchBegin;egret.sys.TouchHandler.prototype.onTouchBegin=function(t,e,r){i.mbInputEnable&&(i.mbTouchDown=!0,n.call(this,t,e,r),i.startTouch(t,e,r))};var o=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(t,e,n){i.mbInputEnable&&(o.call(this,t,e,n),(Math.abs(i.mTouchX-t)>r||Math.abs(i.mTouchY-e)>r)&&(i.moveDriveTouch(t,e,n),i.mbTouchMove=!0))};var a=egret.sys.TouchHandler.prototype.onTouchEnd;egret.sys.TouchHandler.prototype.onTouchEnd=function(r,n,o){if(i.mbInputEnable){var s=e.$hitTest(r,n);a.call(this,r,n,o),0==i.mbFireLongTouch&&0==i.mbTouchMove&&null==i.mDriveTargetSaveData&&i.mTouchTarget==s&&egret.TouchEvent.dispatchTouchEvent(s,t.TouchEvent.TOUCH_SHORT,!0,!0,r,n,o,!1),null!=i.mDriveTargetSaveData&&i.stopDriveTouch(r,n,o),i.stopTouch(),i.mbTouchDown=!1,0==i.mbInputEnableDelay&&(i.mbInputEnable=i.mbInputEnableDelay)}}},i}(TClass);t.GuiManager=e,__reflect(e.prototype,"gui.GuiManager")}(gui||(gui={}));var eui;!function(t){var e;!function(e){function i(){var e=t.Image.prototype.$onAddToStage;t.Image.prototype.$onAddToStage=function(t,i){e.call(this,t,i),this.sourceChanged=!0,this.invalidateProperties()};var i=t.Image.prototype.$measureContentBounds;t.Image.prototype.$measureContentBounds=function(t){i.call(this,t);var e=this.$Bitmap[0];if(!e){var r=this.$UIComponent,n=r[8],o=r[9];isNaN(n)||isNaN(o)||t.setTo(0,0,n,o)}},Object.defineProperty(t.Image.prototype,"enabled",{get:function(){return!!this._enabled},set:function(t){null==this._enabled&&(this._enabled=!0),null==this.lastTouchEnabled&&(this.lastTouchEnabled=!0),t!=this._enabled&&(this._enabled=t,gui.GrayComponent(this,!t),t?this.touchEnabled=this.lastTouchEnabled:(this.lastTouchEnabled=this.touchEnabled,this.touchEnabled=!1))},enumerable:!0,configurable:!0}),t.Button.prototype.invalidateState=function(){var e=t.Component;e.prototype.invalidateState.call(this);var i=this.getCurrentState();gui.GrayComponent(this,"disabled"==i)},Object.defineProperty(t.ItemRenderer.prototype,"name",{get:function(){if(null==this.parent)return"";var t=this.parent.getChildIndex(this);return"item"+t},set:function(t){this.$DisplayObject[5]=t},enumerable:!0,configurable:!0}),t.Scroller.prototype.onTouchEndCapture=function(t){if(this.$Scroller[12]){t.stopPropagation(),this.onTouchEnd(t),t.$isPropagationStopped=!1,t.$bubbles=!1;var e=t.$target;this.dispatchEvent(t),t.$setTarget(e)}},t.Scroller.prototype.onTouchTapCapture=function(t){if(this.$Scroller[12]){t.stopPropagation(),t.$isPropagationStopped=!1,t.$bubbles=!1;var e=t.$target;this.dispatchEvent(t),t.$setTarget(e)}};var r=t.DataGroup.prototype.onCollectionChange;t.DataGroup.prototype.onCollectionChange=function(t){r.call(this,t),this._collectionChange=!0};var n=t.DataGroup.prototype.updateDisplayList;t.DataGroup.prototype.updateDisplayList=function(e,i){if(n.call(this,e,i),1==this._collectionChange){this._collectionChange=!1;var r=this,o=r.parent;if(o instanceof t.Scroller){var a=r.contentHeight-o.height;r.scrollV>a&&(r.scrollV=a>0?a:0);var s=r.contentWidth-o.width;r.scrollH>s&&(r.scrollH=s>0?s:0)}}}}e._init=i}(e=t.override||(t.override={}))}(eui||(eui={}));var gui;!function(t){var e=function(){function e(){}return e.prototype.getAsset=function(e,i,r){var n={onAsynTextureSucceed:function(t,n){i.call(r,n,e)}};t.ImageSet.getInstance().loadTextureAsyn(e,n)},e}();t.AssetAdapter=e,__reflect(e.prototype,"gui.AssetAdapter",["eui.IAssetAdapter"])}(gui||(gui={}));var gui;!function(t){var e=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){var n={onResItemLoad:function(t){e.call(r,t.getData())},onResItemError:function(t){e.call(r)}},o=core.ResManager.getInstance();o.loadResAsyn(t,n,core.ResourceType.TYPE_TEXT)},t}();t.ThemeAdapter=e,__reflect(e.prototype,"gui.ThemeAdapter",["eui.IThemeAdapter"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.mContainer=new egret.DisplayObjectContainer,t.addChild(t.mContainer),t.mActorList=[],t}return __extends(i,e),i.prototype.updateDisplayList=function(t,e){this.mContainer.x=t/2,this.mContainer.y=e/2},i.prototype.addActor=function(t){if(null!=t){var e=this.mActorList.indexOf(t);if(-1==e){0==this.mActorList.length&&this._regsterTimer();var i=t.getDisplayNode();TLog.Assert(null==i.parent),this.mContainer.addChild(i),t.setInCameraView(null,!0),t.retain(),this.mActorList.push(t)}}},i.prototype.removeActor=function(t){if(null==t)return!1;var e=this.mActorList.indexOf(t);return-1==e?!1:(-1!=this.mContainer.getChildIndex(t.getDisplayNode())&&this.mContainer.removeChild(t.getDisplayNode()),t.setInCameraView(null,!1),t.release(),this.mActorList.splice(e,1),0==this.mActorList.length&&this.clearTimer(),!0)},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),0!=this.mActorList.length&&this._regsterTimer()},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.clearTimer();for(var t=0,i=this.mActorList;t<i.length;t++){var r=i[t];r.setInCameraView(null,!1)}},i.prototype._regsterTimer=function(){t.GuiManager.getInstance().addTickCallback(this)},i.prototype.clearTimer=function(){t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.onTick=function(){if(0!=this.mActorList.length)for(var t=0,e=this.mActorList;t<e.length;t++){var i=e[t];i.onUpdate(null)}},i}(eui.Component);t.ActorView=e,__reflect(e.prototype,"gui.ActorView",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;t.m_intervalTime=200,t.m_frameIndex=-1,t.m_intervalCurrentTime=0,t.m_bLoop=!0,t.m_bPlaying=!0,t.m_bReverse=!1,t.m_AnimName="",t.m_AnimInfo=null,t.m_AnimChanged=!1;var i=new eui.Image;return i.percentWidth=100,i.percentHeight=100,t.addChild(i),t.m_image=i,t.touchChildren=!1,t}return __extends(i,e),i.prototype.$onAddToStage=function(i,r){e.prototype.$onAddToStage.call(this,i,r),t.GuiManager.getInstance().addTickCallback(this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.setAnimName=function(e){if(null!=e&&""!=e){var i=t.AnimSet.getInstance().getAnimInfo(e);if(null==i||i.count<=0)return void TLog.Error("AnimBox::SetName %s Error",e);this.m_AnimInfo=i,this.m_AnimName=e,this.setAnimInterval(i.interval)}},i.prototype.play=function(){this.m_bPlaying=!0,this.reset()},i.prototype.pause=function(){this.m_bPlaying=!1},i.prototype.reset=function(){this.m_frameIndex=-1},i.prototype.setLoop=function(t){this.m_bLoop=t},i.prototype.setAnimInterval=function(t){0>t&&(t=100),this.m_intervalTime=t},i.prototype.setReverse=function(t){this.m_bReverse=t},i.prototype.updateAnimImage=function(){var t=String.format("%s_%02d",this.m_AnimName,this.m_frameIndex+1);this.m_image.source=t},i.prototype.onTick=function(){if(0==this.m_bPlaying||null==this.m_AnimInfo)return 0;for(this.m_intervalCurrentTime+=core.TimeStamp.DelayTime,-1==this.m_frameIndex&&(this.m_frameIndex=this.m_bReverse?this.m_AnimInfo.count:-1,this.m_intervalCurrentTime=this.m_intervalTime,this.m_AnimChanged=!0);this.m_intervalCurrentTime>=this.m_intervalTime;){var e=!1;if(this.m_bReverse?(this.m_frameIndex--,this.m_frameIndex<0&&(e=!0,this.m_frameIndex=this.m_AnimInfo.count-1)):(this.m_frameIndex++,this.m_frameIndex>this.m_AnimInfo.count-1&&(e=!0,this.m_frameIndex=0)),this.m_AnimChanged=!0,e){0==this.m_bLoop&&(this.m_bPlaying=!1);var r=new t.GUIEvent(i.AnimEndEvent,this);this.dispatchEvent(r)}this.m_intervalCurrentTime-=this.m_intervalTime}return this.m_AnimChanged&&this.updateAnimImage(),0},Object.defineProperty(i.prototype,"animName",{get:function(){return this.m_AnimName},set:function(t){this.setAnimName(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animInterval",{get:function(){return this.m_intervalTime},set:function(t){this.setAnimInterval(t)},enumerable:!0,configurable:!0}),i.AnimEndEvent="AnimEndEvent",i}(eui.Component);t.AnimBox=e,__reflect(e.prototype,"gui.AnimBox",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.$beginDraw=!1,t.touchChildren=!1,t}return __extends(i,e),i.prototype.beginDraw=function(){TLog.Assert(0==this.$beginDraw),this.removeChildren(),this.$beginDraw=!0},i.prototype.endDraw=function(){TLog.Assert(this.$beginDraw),this.$beginDraw=!1,this.$invalidateContentBounds()},i.prototype._renderImage=function(e,i,r){var n=t.ImageSet.getInstance().getImageInfo(e);if(n){var o=new t.Grid9Image;o.source=e,o.x=i,o.y=r,this.addChild(o)}return n},i.prototype._renderProgress=function(e,i,r,n,o){var a=t.ImageSet.getInstance().getImageInfo(e);if(a){var s=new t.Grid9Image;s.source=e,s.x=i,s.y=r,s.fillMode=egret.BitmapFillMode.CLIP,this.addChild(s),o?s.height=a.h*n:s.width=a.w*n}return a},i.prototype.drawNumberString=function(t,e,i,r,n){if(void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),TLog.Assert(this.$beginDraw),null==t)return 0;"number"==typeof e&&(e=String(e));for(var o=0,a=0;a<e.length;a++){var s=e.charAt(a),h=t+s,l=this._renderImage(h,i,r);l&&(i+=l.w+n,o+=l.w)}return o},i.prototype.drawImage=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),TLog.Assert(this.$beginDraw),null==t)return 0;var r=this._renderImage(t,e,i);return r.w},i.prototype.drawImageProgress=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),TLog.Assert(e>=0&&1>=e),null!=t&&this._renderProgress(t,i,r,e,!1)},i.prototype.drawImageVProgress=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),TLog.Assert(e>=0&&1>=e),null!=t&&this._renderProgress(t,i,r,e,!0)},i.prototype.$invalidateContentBounds=function(){e.prototype.$invalidateContentBounds.call(this),this.invalidateSize()},i}(eui.Component);t.BatchImage=e,__reflect(e.prototype,"gui.BatchImage")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.COMPLETE,e.onCompleteHandler,e),e}return __extends(e,t),e.prototype.onCompleteHandler=function(t){if(null==this.backgroupImage){var e=this.getChildAt(0);e&&e instanceof eui.Image&&(this.backgroupImage=e)}},e.prototype.invalidateState=function(){t.prototype.invalidateState.call(this);var e=this.getCurrentState();if("disabled"==e){var i=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(i);this.filters=[r]}else"down"==e?this.smallButton():"up"==e&&this.normalButton()},e.prototype.smallButton=function(){null!=this.backgroupImage&&(this.backgroupImage.percentWidth=90,this.backgroupImage.percentHeight=90)},e.prototype.normalButton=function(){null!=this.backgroupImage&&(this.backgroupImage.percentWidth=100,this.backgroupImage.percentHeight=100)},Object.defineProperty(e.prototype,"labelColor",{set:function(t){null!=this.labelDisplay&&(this.labelDisplay.textColor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{set:function(t){this.backgroupImage&&(this.backgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroupImage",{get:function(){return this.mBackgroupImage},set:function(t){this.mBackgroupImage=t,this.mBackgroupImage&&(this.mBackgroupImage.verticalCenter=0,this.mBackgroupImage.horizontalCenter=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this.backgroupImage?this.backgroupImage.source:""},set:function(t){this.backgroupImage&&(this.backgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.label},set:function(t){this.label=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{set:function(t){this.labelColor=t},enumerable:!0,configurable:!0}),e.prototype.$setWidth=function(e){return t.prototype.$setWidth.call(this,e)},e}(eui.Button);t.Button=e,__reflect(e.prototype,"gui.Button")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.bAutoScale9Grid=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"autoScale9Grid",{get:function(){return this.bAutoScale9Grid},set:function(t){this.bAutoScale9Grid=t},enumerable:!0,configurable:!0}),e.prototype.$setBitmapData=function(e){var i=t.prototype.$setBitmapData.call(this,e);if(this.$UIComponent&&1==this.bAutoScale9Grid&&(this.scale9Grid=null,e)){var r=Math.ceil(e._bitmapWidth/2),n=Math.ceil(e._bitmapHeight/2);this.scale9Grid=new egret.Rectangle(r,n,1,1)}return i},e}(eui.Image);t.Grid9Image=e,__reflect(e.prototype,"gui.Grid9Image")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.mbModal=!1,t.mLayerId=1,t.visible=!1,t.mbCanDrag=!1,t.mbModalMask=!1,t.mModalGroupId=0,t}return __extends(i,e),i.prototype.removeFromtParent=function(){this.parent&&this.parent.removeChild(this)},i.prototype.$setX=function(t){return this.dispatchEventWith(egret.Event.CHANGE),e.prototype.$setX.call(this,t)},i.prototype.$setY=function(t){return this.dispatchEventWith(egret.Event.CHANGE),e.prototype.$setY.call(this,t)},i.prototype.$setVisible=function(i){return this.visible!=i&&(null==this.mOriginalParent&&(this.mOriginalParent=this.parent),i?this.mOriginalParent?this.mOriginalParent.addChild(this):t.GuiManager.getInstance().setNodeLayer(this,this.mLayerId):(this.mOriginalParent=this.parent,this.removeFromtParent())),1!=this.mbModalMask?e.prototype.$setVisible.call(this,i):void 0},i.prototype.getComponent=function(t){return this[t]},i.prototype.setDoModal=function(t,e){this.mbModal!=t&&(this.mbModal=t,this.mModalGroupId=e||0,this.mbModal?this.setLayer(2):this.setLayer(1))},i.prototype.isDoModal=function(){return this.mbModal},i.prototype.getModalGroupId=function(){return this.mModalGroupId},i.prototype.setDoModalMask=function(t){t!=this.mbModalMask&&(this.mbModalMask=t,this.mbModalMask&&e.prototype.$setVisible.call(this,!1),this.dispatchEventWith(egret.Event.CHANGE))},i.prototype.isDoModalMask=function(){return this.mbModalMask},i.prototype.moveToFront=function(){if(null!=this.parent){var t=this.parent.numChildren,e=this.parent.getChildIndex(this);if(e!=t-1){var i=this.parent;this.parent.removeChild(this),i.addChildAt(this,-1)}}},i.prototype.moveToBack=function(){if(null!=this.parent){var t=this.parent.getChildIndex(this);if(0!=t){var e=this.parent;this.parent.removeChild(this),e.addChildAt(this,0)}}},i.prototype.setLayer=function(e){this.mLayerId=e,this.visible&&t.GuiManager.getInstance().setNodeLayer(this,this.mLayerId)},i.prototype.getLayer=function(){return this.mLayerId},i.prototype.setCanDrag=function(e){this.mbCanDrag!=e&&(this.mbCanDrag=e,e?(this.addEventListener(t.GUIDriveEvent.BeginDriveEvent,this.onBeginDrive,this),this.addEventListener(t.GUIDriveEvent.EndDriveEvent,this.onEndDrive,this)):(this.removeEventListener(t.GUIDriveEvent.BeginDriveEvent,this.onBeginDrive,this),this.removeEventListener(t.GUIDriveEvent.EndDriveEvent,this.onEndDrive,this)))},i.prototype.onBeginDrive=function(t){t.setDriveBegin(!0),TLog.Debug("LayoutNode::onBeginDrive",this.name)},i.prototype.onEndDrive=function(t){TLog.Debug("LayoutNode::onEndDrive",this.name);var e=this.parent,i=core.EgretUtil.stageToNodeXY(e,t.stageX-t.driveOffStageX,t.stageY-t.driveOffStageY);this.x=i.x,this.y=i.y,this.left=0/0,this.top=0/0,this.right=0/0,this.bottom=0/0,this.verticalCenter=0/0,this.horizontalCenter=0/0},i}(eui.Component);t.LayoutNode=e,__reflect(e.prototype,"gui.LayoutNode")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.mColorNode=new eui.Rect,i.mColorNode.fillColor=t.Color.black,i.mColorNode.alpha=.5,i.addChild(i.mColorNode),i.touchChildren=!1,i.touchEnabled=!1,i.mRenderNode=new egret.Bitmap,i.mLayoutNodeList=[],i.mbMaskNodeChanged=!1,i.mMaskNodeSaveDataList=null,i.mbUpdateLock=!1,i}return __extends(i,e),i.prototype.$onAddToStage=function(i,r){e.prototype.$onAddToStage.call(this,i,r),t.GuiManager.getInstance().addTickCallback(this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),t.GuiManager.getInstance().removeTickCallback(this)},i.prototype.$propagateFlagsUp=function(t){e.prototype.$propagateFlagsUp.call(this,t),4==t&&this.setNodeChange()},i.prototype.addLayoutNode=function(t){return TLog.Assert(null!=t),-1!=this.mLayoutNodeList.indexOf(t)?!1:(t.addEventListener(egret.Event.CHANGE,this.onModalMaskChange,this),this.mLayoutNodeList.push(t),void this.setNodeChange())},i.prototype.removeLayoutNode=function(t){return 0==JsUtil.arrayRemoveVal(this.mLayoutNodeList,t)?!1:(t.removeEventListener(egret.Event.CHANGE,this.onModalMaskChange,this),this.setNodeChange(),!0)},i.prototype.getMaskNodeList=function(){for(var t=[],e=0;e<this.mLayoutNodeList.length;e++){var i=this.mLayoutNodeList[e];i.isDoModalMask()&&t.push(i)}return t},i.prototype.isUpdateLock=function(){return this.mbUpdateLock},i.prototype.setNodeChange=function(){this.mbUpdateLock||(this.mbMaskNodeChanged=!0)},i.prototype.removeChildSafe=function(t){null!=t.parent&&t.parent.removeChild(t)},i.prototype.addChildSafe=function(t){t.parent!=this&&this.addChild(t)},i.prototype.onBeginMask=function(t){this.mMaskNodeSaveDataList=[];for(var e=0;e<t.length;e++){var i=t[e],r={node:i,parent:i.parent,childIndex:i.parent.getChildIndex(i)};this.mMaskNodeSaveDataList.push(r)}},i.prototype.onUpdateMask=function(t){null==this.mMaskNodeContainer&&(this.mMaskNodeContainer=new egret.DisplayObjectContainer),this.mColorNode.width=this.width,this.mColorNode.height=this.height,this.mMaskNodeContainer.removeChildren(),this.mMaskNodeContainer.addChild(this.mColorNode);for(var e=0;e<t.length;e++){var i=t[e];i.$visible=!0,i.blendMode=egret.BlendMode.ERASE,this.mMaskNodeContainer.addChild(i)}null==this.mRenderTexture&&(this.mRenderTexture=new egret.RenderTexture),this.mRenderTexture.drawToTexture(this.mMaskNodeContainer),this.mRenderNode.texture=this.mRenderTexture},i.prototype.onFinshMask=function(){for(var t=0;t<this.mMaskNodeSaveDataList.length;t++){var e=this.mMaskNodeSaveDataList[t];e.node.$visible=!1,e.parent.addChildAt(e.node,e.childIndex)}this.mMaskNodeSaveDataList=null},i.prototype.onTick=function(){if(0!=this.mbMaskNodeChanged){this.mbMaskNodeChanged=!1,this.mbUpdateLock=!0;for(var t=[],e=0;e<this.mLayoutNodeList.length;e++){var i=this.mLayoutNodeList[e];i.isDoModalMask()&&t.push(i)}t.length>0?(this.removeChildSafe(this.mColorNode),this.onBeginMask(t),this.onUpdateMask(t),this.onFinshMask(),this.addChildSafe(this.mRenderNode)):(this.mColorNode.width=this.width,this.mColorNode.height=this.height,this.removeChildSafe(this.mRenderNode),this.addChildSafe(this.mColorNode)),this.mbUpdateLock=!1}},i.prototype.onModalMaskChange=function(t){this.setNodeChange()},i}(eui.UILayer);t.ModalColorLayer=e,__reflect(e.prototype,"gui.ModalColorLayer",["gui.GuiTickCallback"])}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.colorLayer=new t.ModalColorLayer,i.touchEnabled=!0,i.addChild(i.colorLayer),i.visible=!1,i}return __extends(i,e),i.prototype.$doAddChild=function(i,r,n){return void 0===n&&(n=!0),e.prototype.$doAddChild.call(this,i,r,n),this.colorLayer==i?i:(TLog.Assert(i instanceof t.LayoutNode),this.colorLayer.isUpdateLock()?void 0:(this.colorLayer.addLayoutNode(i),this.updateLayer(),i))},i.prototype.$doRemoveChild=function(i,r){void 0===r&&(r=!0);var n=e.prototype.$doRemoveChild.call(this,i,r);if(this.colorLayer==n)return n;if(!this.colorLayer.isUpdateLock())return n instanceof t.LayoutNode&&this.colorLayer.removeLayoutNode(n),this.updateLayer(),n},i.prototype.$hitTest=function(t,i){if(this.numChildren<=1)return null;var r=this.colorLayer.getMaskNodeList();if(0==r.length){var n=this.getChildAt(this.numChildren-1);TLog.Assert(n!=this.colorLayer);var o=n.$hitTest(t,i);return o?o:this}for(var a=e.prototype.$hitTest.call(this,t,i),s=this.getChildIndex(this.colorLayer),h=!1,l=0;l<r.length;l++){var u=r[l],p=this.getChildIndex(u);if(s>p)break;u.$visible=!0;var m=u.$hitTest(t,i);if(u.$visible=!1,null!=m){h=!0;break}}return 1==h?a==this?null:a:this},i.prototype.updateLayer=function(){var t=this.numChildren;if(1==t){var e=this.getChildAt(0);return TLog.Assert(e==this.colorLayer),void(this.visible=!1)}this.visible=!0;for(var i=0,r=-1,n=!1,o=t-1;o>=0;o--){var e=this.getChildAt(o);if(e!=this.colorLayer){var a=e;if(-1==r&&0==a.getModalGroupId()){i=o,n&&i++;break}var s=a.getModalGroupId();if(-1!=r&&s!=r){var h=n?2:1;i=o+h;break}r=s,n=!1}else n=!0}i>0?this.setChildIndex(this.colorLayer,i-1):this.setChildIndex(this.colorLayer,0)},i}(eui.UILayer);t.ModalLayer=e,__reflect(e.prototype,"gui.ModalLayer")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onCompleteHandler=function(t){if(null==this.mBackgroupImage){var e=this.getChildAt(0);e&&e instanceof eui.Image&&(this.mBackgroupImage=e)}},Object.defineProperty(e.prototype,"image",{set:function(t){this.mBackgroupImage&&(this.mBackgroupImage.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroupImage",{get:function(){return this.mBackgroupImage},set:function(t){this.mBackgroupImage=t,this.mBackgroupImage&&(this.mBackgroupImage.verticalCenter=0,this.mBackgroupImage.horizontalCenter=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{set:function(t){if(this.thumb){var e=this.thumb;e.source=t}},enumerable:!0,configurable:!0}),e}(eui.ProgressBar);t.ProgressBar=e,__reflect(e.prototype,"gui.ProgressBar")}(gui||(gui={}));var gui;!function(t){var e=function(){function t(){this.type=0,this.id=0,this.text="",this.name="",this.link="",this.color=0,this.border=0,this.value=0,this.flag=0}return t}();__reflect(e.prototype,"LogicInfo");var i=function(){function t(){this.width=0,this.height=0,this.logicInfo=null,this.param1=null,this.param2=null,this.window=null}return t}();__reflect(i.prototype,"PosInfo");var r=function(){function t(){this.contentH=0,this.contentW=0,this.mPosInfoList=[],this.full=!1}return t}();__reflect(r.prototype,"RowInfo");var n=function(n){function o(){var e=n.call(this)||this;return e.mRowInfoList=[],e.mLogicInfoList=[],e.mDefaultValue=16,e.mDefaultFontFlag=t.Flag.LEFT_CENTER,e.mReplaceArr=[],e.mReplaceArr.push([/&lt;/g,"<"]),e.mReplaceArr.push([/&gt;/g,">"]),e.mReplaceArr.push([/&amp;/g,"&"]),e.mReplaceArr.push([/&quot;/g,'"']),e.mReplaceArr.push([/&apos;/g,"'"]),e.mContainer=e,e.mAlignFlag=0,e.mContentChanged=!1,e.mRowDistance=0,e}return __extends(o,n),o.prototype.translateWord=function(e){var i=e.split("##");if(i.length<=2)return e;var r=i.length;if(r%2==0){var n=i[r-1];i[r-1]="##"+n}for(var a=0;r>a;a++){var n=i[a];if(a%2==1&&a!=r-1&&""!=n){var s=new t.GUITranslateWordEvent(o.RichDisplayerTranslateEvent,this);s.setTranslateWord(n),this.dispatchEvent(s);var h=s.getTranslateWord();if(""==h)return e;i[a]=h}}return i.join("")},o.prototype.replaceSpecial=function(t){for(var e=0;e<this.mReplaceArr.length;e++){var i=this.mReplaceArr[e][0],r=this.mReplaceArr[e][1];t=t.replace(i,r)}return t},o.prototype.fillLogicInfo=function(e,i){switch(e.type){case 4:case 6:case 5:e.value=TXML.queryIntAttribute(i,o.AttValue,this.mDefaultValue);break;case 1:case 3:case 2:var r=TXML.queryText(i);if(r=this.replaceSpecial(r),1==e.type){if(""==r)return void TLog.Error("RichDisplayer::FillLogicElemInfo TextType can not get text");e.text=this.translateWord(r)}else e.text=r;if(e.link=TXML.queryAttribute(i,o.AttLink),e.name=TXML.queryAttribute(i,o.AttName),""==e.name&&(3==e.type||2==e.type))return void TLog.Error("RichDisplayer::FillLogicElemInfo AnimType or ImageType can not get name");var n=TXML.queryAttribute(i,o.AttColor);""!=n&&(e.color=t.GetColorFromName(n));var a=TXML.queryAttribute(i,o.AttFlag);""!=a?e.flag=t.GetFlagFromName(a):e.flag=this.mDefaultFontFlag}},o.prototype.setRowDistance=function(t){this.mRowDistance=t},o.prototype.addXmlString=function(t){var i=this;if(""!=t){t="<root>"+t+"</root>";var r=TXML.parse(t);if(null==r)return void TLog.Error("addXmlString %s",t);TXML.forEach(r,function(t){var r=t.name,n=-1;if(r==o.TagText?n=1:r==o.TagBR?n=4:r==o.TagHorBlank?n=6:r==o.TagVerBlank?n=5:r==o.TagImage?n=2:r==o.TagAnim&&(n=3),-1!=n){var a=new e;a.type=n,i.fillLogicInfo(a,t),i.mLogicInfoList.push(a)}}),this.mContentChanged=!0,this.invalidateDisplayList()}},o.prototype.finishCurrentRow=function(){var t=this.getCurrentRow();t.full=!0},o.prototype.getCurrentRow=function(){var t=null;return this.mRowInfoList.length>0&&(t=this.mRowInfoList[this.mRowInfoList.length-1],t.full&&(t=null)),null==t&&(t=new r,this.mRowInfoList.push(t)),t},o.prototype.addPosInfo=function(t,e,r){var n=new i;n.logicInfo=t,n.width=e,n.height=r;var o=this.getCurrentRow();return o.contentW=o.contentW+e,o.contentH=Math.max(o.contentH,r),o.mPosInfoList.push(n),n},o.prototype.insertImage=function(e){var i=t.ImageSet.getInstance().getImageInfo(e.name);if(!(null==i||i.w>this.width)){var r=this.getCurrentRow();r.contentW+i.w>this.width&&(this.finishCurrentRow(),r=this.getCurrentRow()),this.addPosInfo(e,i.w,i.h)}},o.prototype.insertAnim=function(e){var i=t.AnimSet.getInstance().getAnimInfo(e.name);if(!(null==i||i.w>this.width)){var r=this.getCurrentRow();r.contentW+i.w>this.width&&(this.finishCurrentRow(),r=this.getCurrentRow()),this.addPosInfo(e,i.w,i.h)}},o.prototype.insertText=function(e){if(""!=e.text){var i=e.name,r=t.FontSet.getInstance().getFont(i);if(null==r)return void TLog.Error("RichDisplayer::insertText font:%s == null",i);for(var n=this.width,o=0,a=0,s=0,h=0;h<e.text.length;h++){var l=e.text[h],u=egret.sys.measureText(l,r.fontName,r.fontSize,r.isBold(),r.isItalic()),p=this.getCurrentRow();if(p.contentW+s+u<=n)a=h,s+=u;else{if(s>0){var m=this.addPosInfo(e,s,r.fontSize);m.param1=o,m.param2=a,o=h,a=h,s=u}this.finishCurrentRow()}}if(s>0){var m=this.addPosInfo(e,s,r.fontSize);m.param1=o,m.param2=a}}},o.prototype.clear=function(){this.mContentChanged=!0,this.mLogicInfoList=[],this.invalidateDisplayList()},o.prototype.setAlignFlag=function(t){this.mAlignFlag=t},o.prototype.getLogicWidth=function(){this.refreshLogicShow();for(var t=0,e=0;e<this.mRowInfoList.length;e++){var i=this.mRowInfoList[e];t=Math.max(t,i.contentW)}return t},o.prototype.getLogicHeight=function(){this.refreshLogicShow();for(var t=0,e=0;e<this.mRowInfoList.length;e++){var i=this.mRowInfoList[e];t+=i.contentH+this.mRowDistance}return t},o.prototype.getLogicRowCount=function(){return this.refreshLogicShow(),this.mRowInfoList.length},o.prototype.refreshLogicShow=function(){var t=this;if(0!=this.mContentChanged&&(this.mContentChanged=!1,this.mRowInfoList.length>0&&(this.mRowInfoList.forEach(function(e){e.mPosInfoList.forEach(function(e){null!=e.window&&(t.mContainer.removeChild(e.window),e.window=null)})}),this.mRowInfoList.length=0),this.mLogicInfoList.length>0))for(var e=this.width,i=(this.height,0);i<this.mLogicInfoList.length;i++){var r=this.mLogicInfoList[i];if(4==r.type){var n=this.getCurrentRow();
n.full=!0,0==n.contentH&&(n.contentH=r.value)}else if(5==r.type){this.finishCurrentRow();var n=this.getCurrentRow();n.contentH=r.value,this.finishCurrentRow()}else if(6==r.type){var n=this.getCurrentRow();this.addPosInfo(r,r.value,0),n.contentW>e&&(n.contentW=e,this.finishCurrentRow())}else 2==r.type?this.insertImage(r):3==r.type?this.insertAnim(r):1==r.type&&this.insertText(r)}},o.prototype.updateDisplayList=function(e,i){do{if(0==this.width||0==this.height){TLog.Error("RichDisplayer::refreshShow this.width == 0 || this.height == 0");break}this.width=e,this.height=i,this.refreshLogicShow();var r=0,o=0,a=this.getLogicWidth(),s=this.getLogicHeight();(this.mAlignFlag&t.Flag.H_CENTER)==t.Flag.H_CENTER?r=(this.width-a)/2:(this.mAlignFlag&t.Flag.RIGHT)==t.Flag.RIGHT&&(r=this.width-a),(this.mAlignFlag&t.Flag.V_CENTER)==t.Flag.V_CENTER&&(o=(this.height-s)/2);for(var h=o,l=0;l<this.mRowInfoList.length;l++){for(var u=this.mRowInfoList[l],p=u.contentH,m=r,c=0;c<u.mPosInfoList.length;c++){var d=u.mPosInfoList[c],f=d.logicInfo,g=p-d.height;if(1==f.type){var y=d.window;null==y&&(y=new eui.Label,d.window=y,y.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRdTouchTapCapture,this,!0),this.mContainer.addChild(y)),t.FontSet.getInstance().updateTextField(f.name,y),y.textColor=f.color,y.text=f.text.substring(d.param1,d.param2+1)}else if(2==f.type){var v=d.window;null==v&&(v=new eui.Image,d.window=v,this.mContainer.addChild(v)),v.source=f.name,v.touchEnabled=!1}else if(3==f.type){var L=d.window;null==L&&(L=new t.AnimBox,d.window=L,this.mContainer.addChild(L)),L.setAnimName(f.name),L.play(),L.touchEnabled=!1}var _=d.window;_&&(_.x=m,_.y=h+g,_.width=d.width,_.height=d.height),m+=d.width}m=0,h=h+u.contentH+this.mRowDistance}}while(!1);n.prototype.updateDisplayList.call(this,e,i)},o.prototype.getLogicInfoFromWindow=function(t){for(var e=0;e<this.mRowInfoList.length;e++)for(var i=this.mRowInfoList[e],r=0;r<i.mPosInfoList.length;r++){var n=i.mPosInfoList[r];if(n.window==t)return n.logicInfo}return null},o.prototype.onRdTouchTapCapture=function(e){var i=this.getLogicInfoFromWindow(e.target);if(i&&""!=i.link){var r=new t.GUIHyperlinkEvent(o.RichDisplayerLinkCmdEvent,this);r.setHyperlink(i.link),this.dispatchEvent(r)}},o.TagBR="br",o.TagVerBlank="ver_blank",o.TagHorBlank="hor_blank",o.TagText="text",o.TagImage="image",o.TagAnim="anim",o.AttName="name",o.AttColor="color",o.AttLink="link",o.AttValue="value",o.AttFlag="flag",o.RichDisplayerLinkCmdEvent="RichDisplayerLinkCmdEvent",o.RichDisplayerTranslateEvent="RichDisplayerTranslateEvent",o}(eui.Group);t.RichDisplayer=n,__reflect(n.prototype,"gui.RichDisplayer")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.touchScrollH=e.$Scroller[8],e.touchScrollV=e.$Scroller[9],e}return __extends(e,t),e.prototype.scrollToXY=function(t,e,i){var r=this.viewport;if(null!=r){r.validateNow(),this.stopAnimation();var n=r.contentWidth-this.width;0>n&&(n=0),t>n&&(t=n),0>t&&(t=0);var o=r.contentHeight-this.height;0>o&&(o=0),e>o&&(e=o),0>e&&(e=0),0==i?(r.scrollH=t,r.scrollV=e):(this.touchScrollH.maxScrollPos=n,this.touchScrollV.maxScrollPos=o,this.touchScrollH.throwTo(t,300),this.touchScrollV.throwTo(e,300))}},e}(eui.Scroller);t.Scroller=e,__reflect(e.prototype,"gui.Scroller")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.isPullDown=!0,t.maxItemCount=10,t._itemData={},t.initPullView(),t}return __extends(i,e),i.prototype.updateData=function(t,e){if(null!=this._data)for(var i=0;i<this._data.length;i++)this._data[i][t]=e},i.prototype.initPullView=function(){var e=30;this.bg=new eui.Image,this.addChild(this.bg),this.bg.width=this.width,this.bg.height=e,this.titleLabel=new eui.Label,this.addChild(this.titleLabel),this.titleLabel.width=this.width,this.titleLabel.height=e,this.titleLabel.textColor=0,this.titleLabel.verticalAlign="middle",this.titleLabel.textAlign="center",this.titleLabel.text="ComboBox",this.titleLabel.size=20,this.titleLabel.addEventListener(egret.TouchEvent.TOUCH_END,this.onRightIconBg,this);var r=new eui.ArrayCollection(this._data);this.Scroller=new eui.Scroller,this.scrollY=e,this.Scroller.width=this.width,this.setMaxItem(this.maxItemCount),this.DataGroup=new eui.DataGroup,this.Scroller.addChild(this.DataGroup),this.DataGroup.dataProvider=r,this.DataGroup.itemRenderer=t.ComboBoxItem,this.Scroller.viewport=this.DataGroup,this.DataGroup.useVirtualLayout=!0,this.Scroller.addEventListener(i.onClick,this.onItemClick,this),this.hide()},i.prototype.onRightIconBg=function(t){this.isPullDown?this.hide():this.show()},i.prototype.getTitleLabe=function(){return this.titleLabel},i.prototype.setItemWidth=function(t){this.width=t,this.bg.width=t,this.titleLabel.width=t,this.Scroller.width=t,this.updateData("width",t),this._itemData.width=t},i.prototype.setItemHeight=function(t){this.updateData("height",t),this._itemData.height=t},i.prototype.setItemFontSize=function(t){void 0===t&&(t=25),this.updateData("fontSize",t),this._itemData.fontSize=t},i.prototype.setTitleHeight=function(t){this.bg.height=t,this.titleLabel.height=t,this.scrollY=t,this.updatePos()},i.prototype.setTitleBackground=function(t){this.bg.source=t},i.prototype.setTitleFontSize=function(t){this.titleLabel.size=t},i.prototype.setTitle=function(t){this.titleLabel.text=t},i.prototype.updatePos=function(){if(null!=this.Scroller&&null!=this.Scroller.parent){var t=this.$getConcatenatedMatrix(),e=t.transformPoint(0,this.scrollY);this.Scroller.x=e.x,this.Scroller.y=e.y}},i.prototype.show=function(){this.isPullDown=!0,this.stage.addChild(this.Scroller),this.updatePos()},i.prototype.hide=function(){this.isPullDown=!1,this.Scroller.parent&&this.stage.removeChild(this.Scroller)},i.prototype.setItemTextAlign=function(t){this.titleLabel.textAlign=t,this.updateData("textAlign",t),this._itemData.textAlign=t},i.prototype.$setWidth=function(t){var i=e.prototype.$setWidth.call(this,t);return this.Scroller&&(this.Scroller.width=t,this.bg.width=t,this.titleLabel.width=t),i},i.prototype.$setHeight=function(t){var i=e.prototype.$setHeight.call(this,t);return i},i.prototype.setMaxItem=function(t){if(this.maxItemCount=t,this.Scroller){var e=this._itemData.height;null==e&&(e=this.height),this.Scroller.height=this.maxItemCount*e}},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(t){if(this._data=t,this._itemData)for(var e in this._itemData){var i=this._itemData[e];this.updateData(e,i)}if(this.DataGroup){var r=new eui.ArrayCollection(this._data);this.DataGroup.dataProvider=r}},enumerable:!0,configurable:!0}),i.prototype.onItemClick=function(t){this.hide(),this.dispatchEvent(t)},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMouseDown,this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMouseDown,this)},i.prototype.onStageMouseDown=function(t){0==this.contains(t.target)&&0==this.Scroller.contains(t.target)&&this.hide()},i.onClick="ComboBoxOnClick",i}(eui.Component);t.ComboBox=e,__reflect(e.prototype,"gui.ComboBox")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(TClass);t.AnimInfo=e,__reflect(e.prototype,"gui.AnimInfo");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mInfoList={}},i.prototype.destory=function(){},i.prototype.insertInfo=function(t,i,r,n,o){TLog.Assert(""!=t&&null!=i&&null!=r&&null!=n&&null!=o);var a=e.newObj();return a.w=i,a.h=r,a.count=n,a.interval=o,this.mInfoList[t]=a,!0},i.prototype.getAnimInfo=function(t){return this.mInfoList[t]},i.prototype.getAnimSize=function(t){var e=this.getAnimInfo(t);return null==e?null:{w:e.w,h:e.h}},i.prototype.getAnimFrameNum=function(t){var e=this.getAnimInfo(t);if(null!=e)return e.count},i}(TClass);t.AnimSet=i,__reflect(i.prototype,"gui.AnimSet")}(gui||(gui={}));var gui;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},i.prototype.destory=function(){},i.prototype.init=function(t,e,i){this.fontName=t,this.fontSize=e,this.flag=i},i.prototype.setColor=function(t){this.color=t},i.prototype.setShadowColor=function(t){this.shadowColor=t},i.prototype.setShadowOffset=function(t){this.shadownOffset=t},i.prototype.setSpace=function(t,e){this.space_x=t,this.space_y=e},i.prototype.setStroke=function(t){this.stroke=t},i.prototype.isBold=function(){return 0!=(this.flag&t.FontFlag.BOLD)},i.prototype.isItalic=function(){return 0!=(this.flag&t.FontFlag.ITALIC)},i}(TClass);t.FontInfo=e,__reflect(e.prototype,"gui.FontInfo");var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mFontList={}},r.prototype.destory=function(){this.clearAllFont()},r.prototype.insertFont=function(t,i,r,n,o,a,s,h,l,u){var p=this.mFontList[t];return p?(p.init(i,r,a),p.setColor(n),p.setShadowColor(o),p.setSpace(s,h),p.setStroke(l),p.setShadowOffset(u),!1):(p=e.newObj(),p.init(i,r,a),p.setColor(n),p.setShadowColor(o),p.setSpace(s,h),p.setStroke(l),p.setShadowOffset(u),void(this.mFontList[t]=p))},r.prototype.getFont=function(t){var e=this.mFontList[t];return null==e?(TLog.Error("FontSet.getFont %s not exist",t),null):e},r.prototype.clearAllFont=function(){for(var t in this.mFontList){var e=this.mFontList[t];e.deleteObj()}this.mFontList=null},r.prototype.hasFlag=function(t,e){return 0!=(t&e)},r.prototype.updateTextField=function(e,i,r){null==r&&(r=!0);var n=this.getFont(e);if(null!=n){var o=n.flag;i.fontFamily=n.fontName,i.size=n.fontSize,r&&(i.textColor=n.color),i.lineSpacing=n.space_y,i.italic=this.hasFlag(o,t.FontFlag.ITALIC),i.bold=this.hasFlag(o,t.FontFlag.BOLD),this.hasFlag(o,t.FontFlag.STROKE)?(i.stroke=n.stroke,i.strokeColor=n.shadowColor):i.stroke=0;var a=egret.HorizontalAlign.LEFT,s=egret.VerticalAlign.TOP;this.hasFlag(o,t.Flag.H_CENTER)?a=egret.HorizontalAlign.CENTER:this.hasFlag(o,t.Flag.RIGHT)&&(a=egret.HorizontalAlign.RIGHT),this.hasFlag(o,t.Flag.V_CENTER)?s=egret.VerticalAlign.MIDDLE:this.hasFlag(o,t.Flag.BOTTOM)&&(s=egret.VerticalAlign.BOTTOM),a&&s&&(i.textAlign=a,i.verticalAlign=s)}},r}(TClass);t.FontSet=i,__reflect(i.prototype,"gui.FontSet")}(gui||(gui={}));var gui;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.subTexture=null,this.baseTexture=null},e.prototype.destory=function(){this.subTexture=null,this.baseTexture=null},e}(TClass);t.ImageInfo=e,__reflect(e.prototype,"gui.ImageInfo");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResMgr=core.ResManager.getInstance(),this.mTextureMgr=core.TextureManager.getInstance(),this.mTextureMgr.addEventListener(core.TextureEvent.TextureDisposeEvent,this.onTextureDispose,this),this.mInfoList={}},i.prototype.destory=function(){this.clearInfo(),this.mTextureMgr.removeEventListener(core.TextureEvent.TextureDisposeEvent,this.onTextureDispose,this)},i.prototype.loadImageSet=function(t,e){var i=this,r={onResItemLoad:function(r){i.onImageSetInfoLoad(t,r.getData()),e.onImageSetLoad(t)},onResItemError:function(i){e.onImageSetLoad(t)}};this.mResMgr.loadResAsyn(t,r,core.ResourceType.TYPE_JSON)},i.prototype.onImageSetInfoLoad=function(t,i){var r=i.file;t=t.split("\\").join("/");var n=t.match(/#.*|\?.*/),o="";n&&(o=n[0]);var a=t.lastIndexOf("/");t=-1!=a?t.substring(0,a+1)+r:r;var s=t+o,h=i.frames,l=e.createObj();for(var u in h){var p=h[u];l.x=p.x,l.y=p.y,l.w=p.w,l.h=p.h,l.offX=p.offX,l.offY=p.offY,l.sourceW=p.sourceW,l.sourceH=p.sourceH,this.insertInfo(u,s,l)}},i.prototype.insertInfo=function(t,i,r){if(""==t||""==i||null==r)return!1;if(null!=this.mInfoList[t])return!1;var n=e.newObj();return n.x=r.x,n.y=r.y,n.w=r.w,n.h=r.h,n.offX=r.offX,n.offY=r.offY,n.sourceW=r.sourceW,n.sourceH=r.sourceH,n.name=r.name,n.fileName=i,this.mInfoList[t]=n,!0},i.prototype.clearInfo=function(){for(var t in this.mInfoList){var e=this.mInfoList[t];e.deleteObj()}this.mInfoList={}},i.prototype.getImageInfo=function(t){if(null==t||""==t)return null;var e=this.mInfoList[t];if(null==e){var i=t.lastIndexOf(".");if(-1!=i){var r=t.substring(i+1);e=this.mInfoList[r]}}return e},i.prototype.createSubTexture=function(t,e,i,r,n,o,a,s,h){void 0===o&&(o=0),void 0===a&&(a=0),void 0==s&&(s=o+r),void 0==h&&(h=a+n);var l=new egret.Texture;return l._bitmapData=t._bitmapData,l.$initData(e,i,r,n,o,a,s,h,t._sourceWidth,t._sourceHeight),l},i.prototype.loadTextureAsyn=function(t,e){var i=this,r=i.getImageInfo(t);if(null!=r)if(null!=r.subTexture)e.onAsynTextureSucceed(t,r.subTexture);else{var n={onAsynTextureSucceed:function(n,o){r.baseTexture=o,r.subTexture=i.createSubTexture(o,r.x,r.y,r.w,r.h,r.offX,r.offY,r.sourceW,r.sourceH),e.onAsynTextureSucceed(t,r.subTexture)}};i.mTextureMgr.loadTextureAsyn(r.fileName,n)}else i.mTextureMgr.loadTextureAsyn(t,e)},i.prototype.onTextureDispose=function(t){var e=t.path;for(var i in this.mInfoList){var r=this.mInfoList[i];r.fileName==e&&(r.subTexture=null,r.baseTexture=null)}},i}(TClass);t.ImageSet=i,__reflect(i.prototype,"gui.ImageSet")}(gui||(gui={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.userData=t[0]},e.LOAD_MAP_FINISH="LOAD_MAP_FINISH",e}(core.EventArgs);t.MapEvent=e,__reflect(e.prototype,"map.MapEvent");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t.mFileName="",t.mResMgr=null,t.mMapData=null,t}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mResMgr=core.ResManager.getInstance(),this.mMapLayerList=[],this.mbLayersOrderChange=!1,this.m_pPathMgr=t.PathMgr.newObj(),this.m_pLogicMask=t.LogicMask.newObj(),this.m_pLogicBlock=this.m_pPathMgr.getLogicBlock(),this.m_loadingMapPathList=[],this.mStaticImageMap={},this.mAreaAnimMap={},this.mAreaParticleMap={}},r.prototype.destory=function(){this.m_pPathMgr&&(this.m_pPathMgr.deleteObj(),this.m_pPathMgr=null)},r.prototype.init=function(e){TLog.Assert(null==this.mTileMap,"initWithRootNode this.mTileMap == null"),this.mTileMap=new t.TileMap(e);var i=this.mTileMap.getCamera();i.setViewSize(e.stage.stageWidth,e.stage.stageHeight),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this),i.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.onMouseUp,this)},r.prototype.onMouseDown=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseDownEvent(t)},r.prototype.onMouseMove=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseMoveEvent(t)},r.prototype.onMouseUp=function(t){this.mInputCallback&&this.mInputCallback.onMapMouseUpEvent(t)},r.prototype.setInputCallback=function(t){this.mInputCallback=t},r.prototype.getTileMap=function(){return this.mTileMap},r.prototype.getCamera=function(){return this.mTileMap.getCamera()},r.prototype.onUpdate=function(){this.mbLayersOrderChange&&(this.mbLayersOrderChange=!1,this.mTileMap.sortLayers()),this.mTileMap.onUpdate()},r.prototype.loadMap=function(t,e){if(""==t)return!1;if(t.lastIndexOf("/")!=t.length-1&&(t+="/"),this.m_loadingMapPathList.push(t),this.m_loadingMapPathList.length>1)return!1;if(this.mFileName==t)return egret.callLater(this.onLoadMapFinish,this),!0;this.mFileName=t,this.mUserData=e;var i=this.mFileName.concat("index.xml"),r=this,n={onResItemLoad:function(e){r.onLoadMapXml(e.getData(),t)},onResItemError:function(t){}};return this.mResMgr.loadResAsyn(i,n,core.ResourceType.TYPE_TEXT),!0},r.prototype.onLoadMapXml=function(e,i){TLog.Assert(this.mFileName==i);var r=new t.MapData;this.mMapData=r;var n=TXML.parse(e);r.mapId=TXML.queryIntText(TXML.findChild(n,"id"),-1),r.mapName=TXML.queryText(TXML.findChild(n,"name")),r.colNum=TXML.queryIntText(TXML.findChild(n,"colNum"),-1),r.rowNum=TXML.queryIntText(TXML.findChild(n,"rowNum"),-1),r.tileWidth=TXML.queryIntText(TXML.findChild(n,"tileWidth"),-1),r.tileHeight=TXML.queryIntText(TXML.findChild(n,"tileHeight"),-1),r.layerNum=TXML.queryIntText(TXML.findChild(n,"layerNum"),-1);for(var o=this,a={onResItemLoad:function(t){for(var e=o.mMapData.layerDataList,i=e.length,r=!0,n=0;i>n;n++){var a=e[n];a.layerFileName==t.getKey()&&(a.layerStream=new BinaryStream(t.getData()),a.layerStream.setNetMode(!1),a.resItem=t,t.retain()),null==a.layerStream&&(r=!1)}r&&o.onLoadMapImp()},onResItemError:function(t){TLog.Error("LoadMapError:"+t)}},s=0;s<r.layerNum;s++){var h=TXML.queryIntText(TXML.findChild(n,"type"+s)),l=TXML.queryIntText(TXML.findChild(n,"id"+s)),u=this.mFileName.concat(h+"_"+l+".dat"),p=new t.MapLayerData(l,h,u);r.layerDataList.push(p),this.mResMgr.loadResAsyn(u,a,core.ResourceType.TYPE_BIN)}},r.prototype._loadMapMetaData=function(t){var e=(t.readByte(),t.readShort(),t.readString()),i=4294918945,r=t.readUInt();if(r!=i)return!1;for(var n=(t.readUInt(),t.readUInt(),t.readUInt()),o=t.readUInt(),a=(t.readUShort(),t.readByte(),t.readShort()),s=0;a>s;s++){t.readInt(),t.readByte()}var h=[];h.length=n*o;for(var s=0;n*o>s;s++)h[s]=t.readByte();return"block"==e?this.m_pPathMgr.RefreshLogicBlock(n,o,h):"mask"==e&&this.m_pLogicMask.ReloadMask(n,o,h),!0},r.prototype.onLoadMapImp=function(){var e=this,i=this.mTileMap,r=this.mMapData;i.setId(r.mapId),i.setName(r.mapName),i.setMapSize(r.colNum,r.rowNum,r.tileWidth,r.tileHeight);for(var n=0;n<this.mMapLayerList.length;n++){var o=this.mMapLayerList[n];i.removeLayer(o),o.deleteObj()}this.mMapLayerList.length=0;var a=i.getMapWidth(),s=i.getMapHeight(),h=t.LogicBlock.getCellX(a),l=t.LogicBlock.getCellX(s);this.m_pPathMgr.ResetLogicBlock(h,l),this.m_pLogicMask.ResetMask(h,l),r.layerDataList.forEach(function(r){var n=r.layerStream,o=n.readByte();n.position=0;var a=0,s=null;switch(o){case t.MapLayerType.TileLayerType:s=t.MapTileLayer.newObj(i),s.load(n),s.setZOrder(a),a++;break;case t.MapLayerType.MetaLayerType:e._loadMapMetaData(n);break;case t.MapLayerType.AreaLayerType:s=t.MapAreaElemLayer.newObj(i),s.load(n),s.setZOrder(a),a++}s&&(s.initEyeshot(i.getMapWidth(),i.getMapHeight(),t.EyeGridSize,t.EyeGridSize),i.addLayer(s),e.mMapLayerList.push(s))}),this.mbLayersOrderChange=!0,this.getCamera().setViewChanged(!0),i.updateCameraView(),this.mMapData.clear(),this.mMapData=null,this.onLoadMapFinish()},r.prototype.onLoadMapFinish=function(){var i=this.m_loadingMapPathList.indexOf(this.mFileName);if(-1!=i&&this.m_loadingMapPathList.splice(i,1),this.m_loadingMapPathList.length>0){var r=this.m_loadingMapPathList.pop();this.m_loadingMapPathList=[],this.loadMap(r)}else this.fireEvent(t.MapEvent.LOAD_MAP_FINISH,e.newObj(this.mUserData))},r.prototype.addSpriteLayer=function(t,e){e.setTag(t),e.setZOrder(t),this.mTileMap.addLayer(e),this.mbLayersOrderChange=!0},r.prototype.removeSpriteLayer=function(t){this.mTileMap.removeLayer(t)&&t.setTag(-1),this.mbLayersOrderChange=!0},r.prototype.getSpriteLayer=function(e){for(var i=this.mTileMap.mLayerList,r=i.length,n=0;r>n;n++){var o=i[n];if(o instanceof t.SpriteLayer){var a=o;if(a.getTag()==e)return a}}return null},r.prototype.enterMap=function(t,e){var i=this.getSpriteLayer(e);return i?i.addSprite(t):!1},r.prototype.leaveMap=function(t){var e=t.getLayer();return e?e.removeSprite(t):!1},r.prototype.changeMapLayer=function(t,e){var i=this.getSpriteLayer(e);TLog.Assert(null!=i);var r=t.getLayer();return null==i||null==r||i==r?!1:(r.removeSprite(t),void i.addSprite(t))},r.prototype.getPathMgr=function(){return this.m_pPathMgr},r.prototype.getLogicMask=function(){return this.m_pLogicMask},r.prototype.getLogicBlock=function(){return this.m_pLogicBlock},r.prototype.setStaticImage=function(t,e,i,r){this.mStaticImageMap[t]={path:e,width:e,height:r}},r.prototype.getStaticImagePath=function(t){var e=this.mStaticImageMap[t];return e?e.path:""},r.prototype.addAreaAnimConfig=function(t,e,i,r){0>=r&&(r=1),this.mAreaAnimMap[t]={path:e,delay:i,scale:r}},r.prototype.getAreaAnimConfig=function(t){return this.mAreaAnimMap[t]},r.prototype.addAreaParticleConfig=function(t,e){this.mAreaParticleMap[t]={path:e}},r.prototype.getAreaParticleConfig=function(t){return this.mAreaParticleMap[t]},r}(core.EventSet);t.MapManager=i,__reflect(i.prototype,"map.MapManager")}(map||(map={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.url=t[0],this.bSucceed=t[1]==egret.Event.COMPLETE,this.response=t[2],this.listen_list=t[3]},e.prototype.destory=function(){this.listen_list=null,this.response=null},e}(TClass);t.HttpResult=e,__reflect(e.prototype,"core.HttpResult");var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._dataFormat=i.FORMAT_TEXT,this._resultList=[],this._recycler=[],this.mRequestId2Url={},this.mUrl2ListernList={}},i.prototype.destory=function(){},i.prototype.send=function(t,e,i){var r=this.mUrl2ListernList[t];null==r&&(this.mUrl2ListernList[t]=r=[]);for(var n=r.length,o=0;n>o;o++){var a=r[o];if(a.callback==e&&a.userData==i)return void TLog.Debug("HttpClient send already exsit:%s",t)}if(r.push({callback:e,userData:i}),!(r.length>1)){var s=this.getRequest();s.open(t),s.send(),this.mRequestId2Url[s.hashCode]=t}},i.prototype.cancel=function(t){for(var e in this.mUrl2ListernList){var i=this.mUrl2ListernList[e];if(i)for(var r=0;r<i.length;r++){var n=i[r];n.callback==t&&(n.callback=null)}}},i.prototype.setDataFormat=function(t){this._dataFormat=t},i.prototype.getRequest=function(){var t=this._recycler.pop();return t||(t=new egret.HttpRequest,t.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},i.prototype.onLoadFinish=function(t){var i=t.target,r=this.mRequestId2Url[i.hashCode],n=this.mUrl2ListernList[r];delete this.mRequestId2Url[i.hashCode],delete this.mUrl2ListernList[r],TLog.Assert(n);t.type==egret.Event.COMPLETE;this._resultList.push(e.newObj(r,t.type,i.response,n)),this._recycler.push(i)},i.prototype.onUpdate=function(){if(this._resultList.length>0){var t=this._resultList;t.forEach(function(t){var e=t.url,i=t.response,r=t.bSucceed;t.listen_list.forEach(function(t){var n=t.callback;if(n){var o=t.userData;r?n.onHttpResponse(e,i,o):n.onHttpError(e,o)}}),t.deleteObj()}),this._resultList.length=0}},i.FORMAT_BINARY=egret.HttpResponseType.ARRAY_BUFFER,i.FORMAT_TEXT=egret.HttpResponseType.TEXT,i}(TClass);t.HttpClient=i,__reflect(i.prototype,"core.HttpClient")}(core||(core={}));var map;!function(t){function e(t){return Math.floor(t)}t.FLOOR=e,t.EyeGridSize=256;var i;!function(t){t[t.NullLayerType=0]="NullLayerType",t[t.TileLayerType=1]="TileLayerType",t[t.AdornmentLayerType=2]="AdornmentLayerType",t[t.MetaLayerType=3]="MetaLayerType",t[t.AreaLayerType=4]="AreaLayerType"}(i=t.MapLayerType||(t.MapLayerType={}));var r=function(){function t(t,e,i){this.layerFileName=i,this.layerId=t,this.layerType=e,this.layerStream=null,this.resItem=null}return t}();t.MapLayerData=r,__reflect(r.prototype,"map.MapLayerData");var n=function(){function t(){this.layerDataList=[]}return t.prototype.clear=function(){this.layerDataList.forEach(function(t){t.layerStream.clear(),t.resItem.release()}),this.layerDataList=null},t}();t.MapData=n,__reflect(n.prototype,"map.MapData")}(map||(map={}));var map;!function(t){function e(t){var e=t>>31;return t^=e,t-=e}function i(t){var e=t>>31,i=-t>>31;return e|-i}var r;!function(t){t[t.CellWidth=16]="CellWidth",t[t.CellHeight=16]="CellHeight",t[t.HalfCellWidth=8]="HalfCellWidth",t[t.HalfCellHeight=8]="HalfCellHeight"}(r||(r={}));var n=function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return __extends(o,n),o.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bufferSize=0,this.buffer=[],this.width=0,this.height=0},o.prototype.destory=function(){},o.getCellX=function(e){return t.FLOOR(e/r.CellWidth)},o.getCellY=function(e){return t.FLOOR(e/r.CellHeight)},o.getXFromCell=function(t){return t*r.CellWidth+r.HalfCellWidth},o.getYFromCell=function(t){return t*r.CellHeight+r.HalfCellHeight},o.prototype.InitAreaLimit=function(){if(0!=this.width&&0!=this.height){var t=this.width*this.height,e=0,i=0;this.buffer.length=t;for(var r=0;t>r;r++)0==e||0==i||e==this.width-1||i==this.height-1?this.buffer[r]=1:this.buffer[r]=0,e++,e>=this.width&&(e=0,i++)}},o.prototype.SetBlock=function(t,e,i){0>t||0>e||t>=this.width||e>=this.height||(this.buffer[t+e*this.width]=i)},o.prototype.ClearBlock=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=0},o.prototype.IsBlock=function(t){return null!=this.buffer&&this.IsValid(t)?0!=this.buffer[t.x+t.y*this.width]:!0},o.prototype.IsValid=function(t){return t.x<0||t.x>=this.width||t.y<0||t.y>=this.height?!1:!0},o.prototype.HaveBlock=function(t,e){var i={};return this.FirstBlock(t,e,i)},o.prototype.FirstBlock=function(t,r,n){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var o=r.x-t.x,a=r.y-t.y,s=i(o),h=i(a);if(o=2*e(o),a=2*e(a),n.x=t.x,n.y=t.y,o>=a){var l=-(o>>1)+(a>>1);for(n.x+=s;n.x!=r.x;n.x+=s){if(0!=l&&this.IsBlock(n))return!0;if(l+=a,l>0&&(n.y+=h,l-=o,this.IsBlock(n)))return!0}}else{var l=-(a>>1)+(o>>1);for(n.y+=h;n.y!=r.y;n.y+=h){if(0!=l&&this.IsBlock(n))return!0;if(l+=o,l>0&&(n.x+=s,l-=a,this.IsBlock(n)))return!0}}return!1},o.prototype.FirstNotBlock=function(t,r,n){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var o=r.x-t.x,a=r.y-t.y,s=i(o),h=i(a);if(o=2*e(o),a=2*e(a),n.x=t.x,n.y=t.y,o>=a){var l=-(o>>1)+(a>>1);for(n.x+=s;n.x!=r.x;n.x+=s){if(0!=l&&!this.IsBlock(n))return!0;if(l+=a,l>0&&(n.y+=h,l-=o,!this.IsBlock(n)))return!0}}else{var l=-(a>>1)+(o>>1);for(n.y+=h;n.y!=r.y;n.y+=h){if(0!=l&&!this.IsBlock(n))return!0;if(l+=o,l>0&&(n.x+=s,l-=a,!this.IsBlock(n)))return!0}}return!1},o.prototype.LastBlock=function(t,r,n){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;if(!this.IsBlock(t))return!1;n=t;var o=t,a=r.x-t.x,s=r.y-t.y,h=i(a),l=i(s);if(a=2*e(a),s=2*e(s),a>=s){var u=-(a>>1)+(s>>1);for(o.x+=h;o.x!=r.x;o.x+=h){if(0!=u){if(!this.IsBlock(o))return!0;n=o}if(u+=s,u>0){if(o.y+=l,u-=a,!this.IsBlock(o))return!0;n=o}}}else{var u=-(s>>1)+(a>>1);for(o.y+=l;o.y!=r.y;o.y+=l){if(0!=u){if(!this.IsBlock(o))return!0;n=o}if(u+=a,u>0){if(o.x+=h,u-=s,!this.IsBlock(o))return!0;n=o}}}return!1},o.prototype.LastNotBlock=function(t,r,n){if(null==this.buffer||t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||r.x<0||r.x>=this.width||r.y<0||r.y>=this.height)return!1;var o=t.x-r.x,a=t.y-r.y,s=i(o),h=i(a);if(o=2*e(o),a=2*e(a),n.x=r.x,n.y=r.y,o>=a){var l=-(o>>1)+(a>>1);for(n.x+=s;n.x!=r.x;n.x+=s){if(0!=l&&!this.IsBlock(n))return!0;if(l+=a,l>0&&(n.y+=h,l-=o,!this.IsBlock(n)))return!0}}else{var l=-(a>>1)+(o>>1);for(n.y+=h;n.y!=r.y;n.y+=h){if(0!=l&&!this.IsBlock(n))return!0;if(l+=o,l>0&&(n.x+=s,l-=a,!this.IsBlock(n)))return!0}}return!1},o.prototype.MaxBlock=function(t,e){},o}(TClass);t.LogicBlock=n,__reflect(n.prototype,"map.LogicBlock")}(map||(map={}));var map;!function(t){function e(t){var e=t>>31;return t^=e,t-=e}function i(t,e){var i=t-e>>31;return t&=i,e&=~i,t|e}var r=function(){function t(){this.clear()}return t.prototype.clear=function(){this.h=0,this.x=0,this.y=0,this.f=0,this.next=null,this.father=null,this.next=null},t}();__reflect(r.prototype,"TLink");var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.distanceBuffer=[],this.closeListBuffer=[],this.openListBuffer=[],this.openNodeList=null,this.blockBuffer=[],this.linkBuffer={}},n.prototype.destory=function(){},n.prototype.ReLoad=function(t){this.distanceBuffer.length=0,this.closeListBuffer.length=0,this.openListBuffer.length=0,this.width=t.width,this.height=t.height;var e=this.width*this.height;return this.distanceBuffer.length=e,this.closeListBuffer.length=e,this.openListBuffer.length=e,this.blockBuffer=t.buffer,!0},n.prototype.memset=function(t,e){for(var i=0;i<t.length;i++)t[i]=e},n.prototype.Find=function(t,e,i){if(t.y<=0||e.y<=0)return 0;if(t.x<0||t.x>=this.width||t.y<0||t.y>=this.height||e.x<0||e.x>=this.width||e.y<0||e.y>=this.height)return 0;this.memset(this.distanceBuffer,0),this.memset(this.closeListBuffer,!1),this.memset(this.openListBuffer,0),this.linkBuffer={};var r=t.x,n=t.y;this.endX=e.x,this.endY=e.y,this.openNodeList=null,this.iUsed=1,this.rootLink=null;var o=this.addOpenList(r,n);return o.h=0,o.father=null,o.f=this.judge(r,n),o.next=null,this.FindNext(i)},n.prototype.FindNext=function(t){for(var e=null,i=0;;){if(i>t)return 4294967295;if(e=this.getOpenLowestCostNode(),null==e)return 0;var r=e.x,o=e.y;if(r==this.endX&&o==this.endY)break;this.removeOpenList(r,o),this.addCloseList(r,o);var a=e.h+5;r+(o-1)*this.width;if(this.addNeighborNode(r,o-1,a,e),a+=2,this.addNeighborNode(r+1,o-1,a,e),this.addNeighborNode(r-1,o-1,a,e),a-=2,this.addNeighborNode(r-1,o,a,e),this.addNeighborNode(r+1,o,a,e),a+=2,this.addNeighborNode(r+1,o+1,a,e),this.addNeighborNode(r-1,o+1,a,e),a-=2,this.addNeighborNode(r,o+1,a,e),this.iUsed>=n.MAX_NODE-10)return 0;i++}this.rootLink=e;for(var s=e,h=0;s;)h++,s=s.father;return h},n.prototype.judge=function(t,r){var n=e(this.endX-t),o=e(this.endY-r);return 5*e(n-o)+7*i(n,o)},n.prototype.addNeighborNode=function(t,e,i,r){var n=t+e*this.width;if(!this.closeListBuffer[n]&&!this.blockBuffer[n])if(this.openListBuffer[n]){if(i<this.distanceBuffer[n]){var o=this.getOpenNode(t,e);o.father=r,o.h=i,o.f=i+this.judge(t,e),this.distanceBuffer[n]=i}}else{var a=this.addOpenList(t,e);a.father=r,a.h=i,a.f=i+this.judge(t,e),this.distanceBuffer[n]=i}},n.prototype.addCloseList=function(t,e){this.closeListBuffer[t+this.width*e]=!0},n.prototype.removeOpenList=function(t,e){var i=t+this.width*e,r=this.openListBuffer[i];if(0!=r){var n=this.linkBuffer[r];n.index=0,this.openListBuffer[i]=0}},n.prototype.addOpenList=function(t,e){var i=this.iUsed,n=this.linkBuffer[i];return null==n&&(n=new r,this.linkBuffer[i]=n),n.index=i,n.x=t,n.y=e,n.next=null,this.openListBuffer[t+this.width*e]=i,null==this.openNodeList?this.openNodeList=n:(n.next=this.openNodeList.next,this.openNodeList.next=n),this.iUsed++,n},n.prototype.getOpenNode=function(t,e){var i=t+this.width*e,r=this.openListBuffer[i];if(0==r)return null;var n=this.linkBuffer[r];return 0==n.index?null:n},n.prototype.getOpenLowestCostNode=function(){if(null==this.openNodeList)return null;for(var t=null,e=2147483647,i=this.openNodeList,r=null;i;)0!=i.index?(i.f<e&&(e=i.f,t=i),r=i,i=i.next):null==r?(this.openNodeList=i.next,i=this.openNodeList):(r.next=i.next,i=i.next);return t},n.prototype.GetPoint=function(t){if(null==this.rootLink)return!1;for(var e=this.rootLink,i=0;e;)i++,e=e.father;e=this.rootLink;var r;for(r=i-1;e;r--)t[r]={},t[r].x=e.x,t[r].y=e.y,e=e.father;return-1!=r?!1:!0},n.MAX_NODE=9e4,n}(TClass);t.LogicFinder=n,__reflect(n.prototype,"map.LogicFinder")
}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bufferSize=0,this.buffer=null,this.width=0,this.height=0,this.enable=!0},e.prototype.destory=function(){},e.prototype.ResetMask=function(t,e){this.buffer=null,this.width=t,this.height=e},e.prototype.ReloadMask=function(t,e,i){this.buffer=null,this.width=t,this.height=e,this.buffer=i},e.prototype.IsMask=function(t,e){return this.enable&&null!=this.buffer&&this.IsValid(t,e)?0!=this.buffer[t+e*this.width]:!1},e.prototype.IsValid=function(t,e){return 0>t||t>=this.width||0>e||e>=this.height?!1:!0},e.prototype.SetMaskEnable=function(t){this.enable=t},e}(TClass);t.LogicMask=e,__reflect(e.prototype,"map.LogicMask")}(map||(map={}));var map;!function(t){var e,i=1e3,r=0,n=0;!function(t){t[t.WLT_NORMAL=0]="WLT_NORMAL",t[t.WLT_START=1]="WLT_START",t[t.WLT_END=2]="WLT_END"}(e||(e={}));var o;!function(t){t[t.CP_NOTNEED=-1]="CP_NOTNEED",t[t.CP_FAIL=0]="CP_FAIL",t[t.CP_FINE=1]="CP_FINE",t[t.CP_FINDNEXT=2]="CP_FINDNEXT",t[t.CP_LOCKFIND=3]="CP_LOCKFIND"}(o||(o={}));var a=function(){function t(){}return t}();__reflect(a.prototype,"TWalkLine");var s=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return __extends(s,o),s.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.m_ptLastSend={},this.m_ptEnd={},this.m_pLine=null,this.m_bSended=!1,this.m_dwLastSendPosTime=0,this.m_ptLastSend.x=0,this.m_ptLastSend.y=0,this.m_iMidX=0,this.m_iMidY=0,this.m_bFindNext=!1,this.m_bSendPos=!1,this.m_iSpeed=12,this.m_iDropStep=0,this.m_iMaxStep=i,this.m_iDirNum=8,this.mFindPathState=0},s.prototype.destory=function(){},s.prototype.init=function(t,e){this.m_pBlock=t,this.m_pPathFinder=e},s.prototype.CreatePathLine=function(i,r,n,o,s){var h=r,l=i.length;this.m_iMaxLine=l-1,this.m_pLine=[],this.m_pLine.length=this.m_iMaxLine+1;for(var u=0;u<this.m_pLine.length;u++)this.m_pLine[u]=new a;this.firstUpdateTime=!0,this.timeOffset=0,this.m_pLine[0].iType|=e.WLT_START,this.m_pLine[0].uTimeStart=s,this.m_pLine[0].iDirStart=o,this.m_pLine[0].ptStart=r,this.m_pLine[this.m_iMaxLine-1].iType|=e.WLT_END;for(var u=0,p=1;p<i.length;p++){var m=i[p];m.x=t.LogicBlock.getXFromCell(m.x),m.y=t.LogicBlock.getYFromCell(m.y),0!=u&&(this.m_pLine[u].uTimeStart=this.m_pLine[u-1].uTimeEnd,this.m_pLine[u].iDirStart=this.m_pLine[u-1].iDir,this.m_pLine[u].ptStart=h),this.SetLine(m,this.m_iSpeed,this.m_pLine[u]),u++,h=m}i.length=0,this.m_ptEnd=h,this.m_iCurLine=0,this.m_iCurThousand=0},s.prototype.UpdateTime=function(t){this.m_iCurrentTime+=t},s.prototype.UpdatePos=function(t){return this._GetStateIsEnd(t,this.m_iCurrentTime)?(null!=this.m_pLine&&(t.dir=this.m_pLine[this.m_iMaxLine-1].iDir,t.x=this.m_ptEnd.x,t.y=this.m_ptEnd.y,this.m_pLine=null),!0):!1},s.prototype.Clear=function(){this.m_pLine=null,this.m_iMaxLine=0,this.firstUpdateTime=!1,this.timeOffset=0},s.prototype.SetSpeed=function(t){this.m_iSpeed=t},s.prototype.GetSpeed=function(){return this.m_iSpeed},s.prototype.SetLine=function(i,r,o){var a=i.x-o.ptStart.x,s=i.y-o.ptStart.y,h=Math.atan2(1.4142135623731*s,a),l=57.29577951307855*h,u=l;0>u&&(u+=360),o.iDir=u%360;var p=1600*r;o.dx=t.FLOOR(Math.cos(h)*p),o.dy=t.FLOOR(Math.sin(h)*p*.70710678118654);var m;if(m=0!=a?1e5*a/o.dx:0!=s?1e5*s/o.dy:1,o.iRotateSign=0,o.iDirStart!=o.iDir){var c=(o.iDir-o.iDirStart+360)%360;o.iRotateSign=1,c>360-c&&(o.iRotateSign=-1,c=360-c),o.iType&e.WLT_START&&(m+=c*n)}o.uTimeEnd=o.uTimeStart+m},s.prototype._GetStateIsEnd=function(i,o){if(null==this.m_pLine)return!0;var a=o;for(this.firstUpdateTime&&(this.timeOffset=a-this.m_pLine[0].uTimeStart,this.firstUpdateTime=!1),a-=this.timeOffset;this.m_iCurLine!=this.m_iMaxLine&&this.m_pLine[this.m_iCurLine].uTimeEnd<=a;)if(this.m_iCurThousand=0,this.m_iCurLine++,this.m_iCurLine==this.m_iMaxLine)return!0;var s=a-this.m_pLine[this.m_iCurLine].uTimeStart;if(0>s)return!0;var h=this.m_pLine[this.m_iCurLine].uTimeEnd-this.m_pLine[this.m_iCurLine].uTimeStart;h>0&&(this.m_iCurThousand=1e3*s/h);var l=this.m_pLine[this.m_iCurLine],u=((l.iDir-l.iDirStart)*l.iRotateSign+360)%360;if(i.x=l.ptStart.x,i.y=l.ptStart.y,l.iType&e.WLT_START){var p=u*n;if(!(s>=p)){var m=s/n;return 4==this.m_iDirNum&&(m=4294967294&m),i.dir=(l.iDirStart+m*l.iRotateSign+360)%360,!1}i.dir=l.iDir,s-=p}else{var p=u*r;if(s>=p)i.dir=l.iDir;else{var m=s/r;4==this.m_iDirNum&&(m=4294967294&m),i.dir=t.FLOOR(l.iDirStart+m*l.iRotateSign+360)%360}}i.x=i.x+l.dx*s/1e5,i.y=i.y+l.dy*s/1e5},s}(TClass);t.LogicPath=s,__reflect(s.prototype,"map.LogicPath")}(map||(map={}));var map;!function(t){var e;!function(t){t[t.eFindPathType_Succeed=1]="eFindPathType_Succeed",t[t.eFindPathType_FindNext=2]="eFindPathType_FindNext",t[t.eFindPathType_Fail=3]="eFindPathType_Fail",t[t.eFindPathType_Findind=4]="eFindPathType_Findind",t[t.eFindPathType_FindNotHandle=5]="eFindPathType_FindNotHandle"}(e=t.FindPathType||(t.FindPathType={}));var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.m_pPathFinder=t.LogicFinder.newObj(),this.m_pBlock=t.LogicBlock.newObj(),this.m_bBusy=!1},r.prototype.destory=function(){},r.prototype.createLogicPath=function(){var e=t.LogicPath.newObj();return e.init(this.m_pBlock,this.m_pPathFinder),e},r.prototype.releaseLogicPath=function(t){t&&(this.clearPath(t),t.deleteObj())},r.prototype.createPath=function(t,i,r,n,o,a){t.m_iStartX=i.x,t.m_iStartY=i.y,t.m_iEndX=r.x,t.m_iEndY=r.y,t.m_iMaxStep=o,t.m_bIgnoreBlock=a,t.m_iStartDir=n,t.m_iCurrentTime=0,this.m_pCurLogicPath==t&&(this.m_pCurLogicPath.Clear(),this.m_pCurLogicPath=null);var s={};if(t.mFindPathState=this.TryNoBlockPath(i,r,a,s),e.eFindPathType_Fail==t.mFindPathState)return e.eFindPathType_Fail;if(s.bNoBlock){var h=i,l=r,u=[];return u.push(s.ptTrueStart),u.push(s.ptTrueEnd),t.CreatePathLine(u,h,l,n,t.m_iCurrentTime),e.eFindPathType_Succeed}return this.CheckFindPathState(t)},r.prototype.updatePath=function(i,r){return i.mFindPathState==e.eFindPathType_Succeed?r.bStop=i.UpdatePos(r):i.mFindPathState!=e.eFindPathType_Fail&&this.CheckFindPathState(i),null!=r.x&&null!=r.y&&(r.x=t.FLOOR(r.x),r.y=t.FLOOR(r.y)),i.mFindPathState},r.prototype.clearPath=function(t){this.m_pCurLogicPath&&this.m_pCurLogicPath==t&&(t.Clear(),this.m_pCurLogicPath=null)},r.prototype.getLogicBlock=function(){return this.m_pBlock},r.prototype.TryNoBlockPath=function(i,r,n,o){var a={},s={};if(a.x=t.LogicBlock.getCellX(i.x),a.y=t.LogicBlock.getCellX(i.y),s.x=t.LogicBlock.getCellX(r.x),s.y=t.LogicBlock.getCellX(r.y),o.ptTrueStart=a,o.ptTrueEnd=s,o.bNoBlock=!1,n);else{if(!this.m_pBlock.IsValid(a))return e.eFindPathType_Fail;if(!this.m_pBlock.IsValid(s))return e.eFindPathType_Fail;if(this.m_pBlock.IsBlock(a)){var h={};this.m_pBlock.FirstNotBlock(a,s,h)&&(a.x=h.x,a.y=h.y)}if(this.m_pBlock.IsBlock(a))return e.eFindPathType_Fail;if(this.m_pBlock.IsBlock(s)){var l={};this.m_pBlock.LastNotBlock(a,s,l)&&(s.x=l.x,s.y=l.y)}if(this.m_pBlock.IsBlock(s))return e.eFindPathType_Fail}return a.x==s.x&&a.y==s.y?e.eFindPathType_Fail:((n||!this.m_pBlock.HaveBlock(a,s))&&(o.bNoBlock=!0),e.eFindPathType_Succeed)},r.prototype.CheckFindPathState=function(t){var i={},r={};i.x=t.m_iStartX,i.y=t.m_iStartY,r.x=t.m_iEndX,r.y=t.m_iEndY;var n=t.m_iMaxStep,o=t.m_bIgnoreBlock,a=t.m_iStartDir,s=!1,h=!1;if(0==this.m_bBusy?(TLog.Assert(null==this.m_pCurLogicPath),s=!0):this.m_pCurLogicPath!=t?t.mFindPathState=e.eFindPathType_FindNotHandle:t.mFindPathState==e.eFindPathType_FindNext&&(h=!0,s=!0),s){var l=!1,u=null,p=[],m=0;m=h?this.FindPathNext(n,p):this.FindPathPointList(i,r,n,o,p),m==e.eFindPathType_Succeed?(t.CreatePathLine(p,i,r,a,t.m_iCurrentTime),t.mFindPathState=e.eFindPathType_Succeed):m==e.eFindPathType_FindNext?(t.mFindPathState=e.eFindPathType_FindNext,u=t,l=!0):t.mFindPathState=e.eFindPathType_Fail,this.m_pCurLogicPath=u,this.m_bBusy=l}return t.mFindPathState},r.prototype.FindPathPointList=function(t,i,r,n,o){var a={};return e.eFindPathType_Fail==this.TryNoBlockPath(t,i,n,a)?e.eFindPathType_Fail:(o.length=0,a.bNoBlock?(o.push(a.ptTrueStart),o.push(a.ptTrueEnd),e.eFindPathType_Succeed):this.FindPath(a.ptTrueStart,a.ptTrueEnd,r,o))},r.prototype.FindPath=function(t,i,r,n){var o=this.m_pPathFinder.Find(t,i,r);return 0==o?e.eFindPathType_Fail:4294967295==o?e.eFindPathType_FindNext:0==this.GetPathPoint(o,n)?e.eFindPathType_Fail:e.eFindPathType_Succeed},r.prototype.FindPathNext=function(t,i){var r=this.m_pPathFinder.FindNext(t);return 0==r?e.eFindPathType_Fail:4294967295==r?e.eFindPathType_FindNext:0==this.GetPathPoint(r,i)?e.eFindPathType_Fail:e.eFindPathType_Succeed},r.prototype.GetPathPoint=function(t,e){var i=[];if(!this.m_pPathFinder.GetPoint(i))return!1;if(e.push(i[0]),this.m_pBlock.HaveBlock(i[0],i[t-1])){var r=void 0,n=void 0,o=void 0,a=void 0;for(r=0;t-1>r;){if(n=r+1,o=t-1,0==r||this.m_pBlock.HaveBlock(i[r],i[o])){for(;o>n;)a=n+o>>1,this.m_pBlock.HaveBlock(i[r],i[a])?o=a-1:n=a+1;this.m_pBlock.HaveBlock(i[r],i[o])&&o--}e.push(i[o]),r=o}}else e.push(i[t-1]);return!0},r.prototype.ResetLogicBlock=function(t,e){this.m_pBlock.width=t,this.m_pBlock.height=e,this.m_pBlock.InitAreaLimit(),this.m_pPathFinder.ReLoad(this.m_pBlock)},r.prototype.RefreshLogicBlock=function(t,e,i){var r=t*e;0!=r&&(this.m_pBlock.buffer.length=0,this.m_pBlock.width=t,this.m_pBlock.height=e,this.m_pBlock.buffer=i,this.m_pPathFinder.ReLoad(this.m_pBlock))},r}(TClass);t.PathMgr=i,__reflect(i.prototype,"map.PathMgr")}(map||(map={}));var egret;!function(t){var e;!function(e){function i(){var e=core.ErrorReport.getInstance(),i=t.sys.SystemTicker.prototype.update;t.sys.SystemTicker.prototype.update=function(){var t=e.isReportEnable();if(t)try{i.call(this)}catch(r){core.ErrorReport.getInstance().captureError(r)}else i.call(this)};var r=t.EventDispatcher.prototype.$notifyListener;t.EventDispatcher.prototype.$notifyListener=function(t,i){var n=!1,o=e.isReportEnable();if(o)try{r.call(this,t,i)}catch(a){core.ErrorReport.getInstance().captureError(a)}else r.call(this,t,i);return n};var n=t.Bitmap.prototype.$onAddToStage;t.Bitmap.prototype.$onAddToStage=function(t,e){var i=this.$Bitmap[1];i&&null==i.source&&this.$setBitmapData(null),n.call(this,t,e)},t.BitmapData.$removeDisplayObject=function(e,i){var r,n=t.BitmapData._displayList;if(r=i._bitmapData&&i._bitmapData.hashCode?i._bitmapData.hashCode:i.hashCode,r&&n[r]){var o=n[r],a=o.indexOf(e);a>=0&&o.splice(a,1)}}}e._init=i}(e=t.override||(t.override={}))}(egret||(egret={}));var map;!function(t){var e;!function(t){t[t.OPTIMIZE_UPDATE_ONSEE=1]="OPTIMIZE_UPDATE_ONSEE",t[t.OPTIMIZE_MOVEMENT_ONSEE=2]="OPTIMIZE_MOVEMENT_ONSEE",t[t.OPTIMIZE_HIDE_ONMAXACTOR=4]="OPTIMIZE_HIDE_ONMAXACTOR",t[t.OPTIMIZE_LOAD_SYN=8]="OPTIMIZE_LOAD_SYN"}(e=t.OptimizeFlag||(t.OptimizeFlag={}));var i;!function(t){t[t.MOVEMENT_PIXEL_CHANGED=1]="MOVEMENT_PIXEL_CHANGED",t[t.MOVEMENT_CELL_CHANGED=2]="MOVEMENT_CELL_CHANGED",t[t.MOVEMENT_DIR_CHANGED=4]="MOVEMENT_DIR_CHANGED",t[t.MOVEMENT_BEGIN_RUN=256]="MOVEMENT_BEGIN_RUN",t[t.MOVEMENT_STOPING=512]="MOVEMENT_STOPING",t[t.MOVEMENT_TRACE_PATH=1024]="MOVEMENT_TRACE_PATH",t[t.ANIM_NOTIFY=262144]="ANIM_NOTIFY"}(i=t.MoveReportFlag||(t.MoveReportFlag={}));var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actor=null,this.pathList=null,this.pathListMaxNum=0,this.pathListNum=0,this.walkOnPathIndex=0,this.walkOnPathThousand=0},e.prototype.destory=function(){},e.prototype.pixelChanged=function(){return 0!=(this.flag&i.MOVEMENT_PIXEL_CHANGED)},e.prototype.dirChanged=function(){return 0!=(this.flag&i.MOVEMENT_DIR_CHANGED)},e.prototype.cellChanged=function(){return 0!=(this.flag&i.MOVEMENT_CELL_CHANGED)},e.prototype.isStoping=function(){return 0!=(this.flag&i.MOVEMENT_STOPING)},e.prototype.beginRun=function(){return 0!=(this.flag&i.MOVEMENT_BEGIN_RUN)},e.MovementEvent="MovementEvent",e}(core.EventArgs);t.SpriteMovEvent=r,__reflect(r.prototype,"map.SpriteMovEvent")}(map||(map={}));var core;!function(t){var e;!function(t){t[t.Connect=0]="Connect",t[t.Close=1]="Close",t[t.Normal=2]="Normal"}(e=t.NetWorkResultState||(t.NetWorkResultState={}));var i;!function(t){t[t.MSG_NULL=0]="MSG_NULL",t[t.CMSG_PING=1]="CMSG_PING",t[t.SMSG_PONG=2]="SMSG_PONG",t[t.CMSG_REGION_NOTICE=9]="CMSG_REGION_NOTICE",t[t.CMSG_COMM=10]="CMSG_COMM",t[t.CMSG_LOGIN=11]="CMSG_LOGIN",t[t.SMSG_LOGIN=12]="SMSG_LOGIN",t[t.CMSG_LOGOUT=13]="CMSG_LOGOUT",t[t.SMSG_LOGOUT=14]="SMSG_LOGOUT",t[t.CMSG_LOGIN_USER=15]="CMSG_LOGIN_USER",t[t.SMSG_LOGIN_USER=16]="SMSG_LOGIN_USER"}(i||(i={}));var r;!function(t){t[t.C2L_CONNECT=17]="C2L_CONNECT",t[t.L2C_CONNECT=18]="L2C_CONNECT",t[t.C2L_STATE=22]="C2L_STATE",t[t.L2C_STATE=23]="L2C_STATE",t[t.C2L_VERSION=24]="C2L_VERSION",t[t.L2C_VERSION=25]="L2C_VERSION",t[t.C2L_VERVIFY_CODE=26]="C2L_VERVIFY_CODE",t[t.L2C_VERVIRY_CODE=27]="L2C_VERVIRY_CODE",t[t.C2L_ROLE_SELECT=28]="C2L_ROLE_SELECT",t[t.L2C_ROLE_SELECT=29]="L2C_ROLE_SELECT",t[t.C2L_ROLE_LIST=30]="C2L_ROLE_LIST",t[t.L2C_ROLE_LIST=31]="L2C_ROLE_LIST",t[t.C2L_ROLE_CREATE=32]="C2L_ROLE_CREATE",t[t.L2C_ROLE_CREATE=33]="L2C_ROLE_CREATE",t[t.C2L_ROLE_DELETE=34]="C2L_ROLE_DELETE",t[t.L2C_ROLE_DELETE=35]="L2C_ROLE_DELETE",t[t.L2C_QUEUE_UPDATE=36]="L2C_QUEUE_UPDATE",t[t.LOGIN_MSG_COUNT=37]="LOGIN_MSG_COUNT"}(r||(r={}));var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.state=0,this.code=0,this.buffer=null},e.prototype.destory=function(){this.buffer=null},e}(TClass);t.NetWorkResult=n,__reflect(n.prototype,"core.NetWorkResult");var o="`#$X1_+%,aBVx}@8",a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetConnectEvent=a,__reflect(a.prototype,"core.NetConnectEvent");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetCloseEvent=s,__reflect(s.prototype,"core.NetCloseEvent");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.EventArgs);t.NetRecvEvent=h,__reflect(h.prototype,"core.NetRecvEvent");var l=function(r){function l(){var t=null!==r&&r.apply(this,arguments)||this;return t.PACKET_HEADER_SIZE=4,t.SHORT_SIZE=2,t}return __extends(l,r),l.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mRecvBuffer=new BinaryStream,this.mRecvResultList=[],this.socket=this.createSocket(),this.mWriteBuffer=new BinaryStream,this.mWriteBuffer.setNetMode(!1),this.mConnecting=!1,this.mSocketError=!1,this.mClosing=!1,this.m_encryptKey=o,this.m_decryptKey=o,this.m_encrypt=!0,this.m_decrypt=!0,this.m_encryptSeed=25,this.m_decryptSeed=25,this.m_serialNumber=0,this.m_initSerialNumber=!1,this.m_sendSerialNumber=!1},l.prototype.destory=function(){this.destorySocket(),this.mRecvBuffer.clear(),this.mRecvBuffer=null,this.mWriteBuffer.clear(),this.mWriteBuffer=null},l.prototype.createSocket=function(){var t=new egret.WebSocket;return t.type=egret.WebSocket.TYPE_BINARY,t.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),t.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),t.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),t},l.prototype.destorySocket=function(){if(this.socket){var t=this.socket;t.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),t.removeEventListener(egret.ProgressEvent.CONNECT,this.onSocketOpen,this),t.removeEventListener(egret.ProgressEvent.CLOSE,this.onSocketClose,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),0==this.mClosing&&t.close(),this.socket=null}},l.prototype.connect=function(t,e){return this.isConnect()?void TLog.Error("connect has not been close:",t+":"+e):(this.destorySocket(),this.socket=this.createSocket(),this.socket.connectByUrl("ws://"+t+":"+e),this.mClosing=!1,this.mConnecting=!0,this.mSocketError=!1,!0)},l.prototype.disconnect=function(){return 0==this.isConnect()?!1:(this.mClosing=!0,this.mConnecting=!1,this.mSocketError=!1,this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.removeEventListener(egret.ProgressEvent.CONNECT,this.onSocketOpen,this),this.socket.removeEventListener(egret.ProgressEvent.CLOSE,this.onSocketClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.close(),!0)},l.prototype.isConnect=function(){return 1==this.mClosing?!1:this.socket.connected},l.prototype.beginPack=function(){return this.mWriteBuffer.clear(),this.mWriteBuffer},l.prototype.endPack=function(){if(0==this.isConnect())return void this.mWriteBuffer.clear();null==this.net_temp&&(this.net_temp=new Uint8Array(65536));var e=this.mWriteBuffer.length,r=this.mWriteBuffer.bytes,n=this.mWriteBuffer.dataView,o=n.getInt16(0,!0);if(o>=17&&27>=o||0==this.m_encrypt){var a=e,s=new BinaryStream;s.writeUnsignedShort(a),s.writeBytes(this.mWriteBuffer,0,e),this.sendBuffer(s),s.clear()}else{var h=new Uint8Array(r.buffer,2),l=e-2;if(this.m_sendSerialNumber){var u=0;this.m_initSerialNumber&&o!=i.CMSG_PING&&(u=this.m_serialNumber,++this.m_serialNumber,0==this.m_serialNumber&&(this.m_serialNumber=1));var p=new DataView(this.net_temp.buffer);p.setUint32(0,u,!0),this.net_temp.set(h,4),h=this.net_temp,l+=4}var m=null;if(l>0){var c=new Uint8Array(17);c[16]=0;for(var d=13,f=64,g=this.m_encryptSeed,y=0;16>y;++y)c[y]=g+33,g=g*d%f;m=t.xxteaEncrypt(h,l,c)}var v=new BinaryStream,a=m.length+2;if(v.writeUnsignedShort(a),v.writeUnsignedShort(o),m.length>0){var L=new BinaryStream(m.buffer);v.writeBytes(L)}this.sendBuffer(v),v.clear()}return this.mWriteBuffer.clear(),!0},l.prototype.sendBuffer=function(t){var e=t.dataView,i=e.getUint16(0,!0);e.setUint16(0,i,!1),this.socket.writeBytes(t)},l.prototype.setEncrypt=function(t,e){this.m_encrypt=t,this.m_decrypt=e},l.prototype.setSeed=function(t,e){this.m_encryptSeed=t,this.m_decryptSeed=e},l.prototype.setSendSerialNumber=function(t){this.m_sendSerialNumber=t},l.prototype.getLastErrorCode=function(){return this.mSocketError?-1:0},l.prototype.onSocketOpen=function(){var t=n.newObj();t.state=e.Connect,t.code=this.getLastErrorCode(),this.mRecvResultList.push(t),this.mRecvBuffer.clear(),this.mClosing=!1},l.prototype.onSocketClose=function(){var t=n.newObj();t.state=this.mConnecting?e.Connect:e.Close,t.code=this.mClosing?0:-1,this.mSocketError&&(t.code=-1),this.mRecvResultList.push(t),this.mClosing=!1},l.prototype.onSocketError=function(){this.mSocketError=!0,this.mClosing=!0},l.prototype.onReceiveMessage=function(t){var i=new BinaryStream;this.socket.readBytes(i),this.mRecvBuffer.writeBytes(i);for(var r=new DataView(this.mRecvBuffer.buffer),o=!1,a=this.mRecvBuffer.position;a>=this.PACKET_HEADER_SIZE;){var s=r.getInt16(0,o),h=s+this.SHORT_SIZE;if(h>a)break;var l=n.newObj();l.state=e.Normal,l.code=this.getLastErrorCode(),l.buffer=new BinaryStream,l.buffer.setNetMode(!1),l.buffer.writeBytes(this.mRecvBuffer,this.SHORT_SIZE,s),l.buffer.position=0,this.mRecvResultList.push(l);for(var u=0;a-h>u;u++)r.setUint8(u,r.getUint8(u+h));a-=h}this.mRecvBuffer.position=a},l.prototype.onUpdate=function(){var t=this;0!=this.mRecvResultList.length&&(this.mRecvResultList.forEach(function(i){switch(i.state){case e.Connect:var r=a.createObj();r.code=i.code,r.net=t,t.fireEvent(l.ConnectEvent,r);break;case e.Close:var n=s.createObj();n.code=i.code,n.net=t,t.fireEvent(l.CloseEvent,n);break;case e.Normal:t.fireNetMsg(i.buffer)}i.deleteObj()}),this.mRecvResultList.length=0)},l.prototype.fireNetMsg=function(e){var r=e.dataView,n=e.length;if(!(n>65536)){var o=r.getUint16(0,!0);if(2>=n||o>=17&&27>=o||0==this.m_decrypt){var a=h.createObj();a.msgLen=e.length,a.reader=e,a.net=this,this.fireEvent(l.RecvEvent,a)}else{var s=new Uint8Array(e.rawBuffer,2),u=null,p=new Uint8Array(17);p[16]=0;for(var m=13,c=64,d=this.m_decryptSeed,f=0;16>f;++f)p[f]=d+33,d=d*m%c;if(u=t.xxteaDecrypt(s,n-2,p)){var g=new BinaryStream(u.buffer),y=new BinaryStream;y.writeUShort(o),o!=i.SMSG_LOGIN&&o!=i.SMSG_LOGIN_USER||!this.m_sendSerialNumber?g.readBytes(y,2):(this.m_serialNumber=g.readUnsignedInt(),this.m_initSerialNumber=!0,g.readBytes(y,2)),y.position=0;var a=h.createObj();a.msgLen=y.length,a.reader=y,a.net=this,this.fireEvent(l.RecvEvent,a)}}}},l.ConnectEvent="NetConnectEvent",l.CloseEvent="NetCloseEvent",l.RecvEvent="NetRecvEvent",l}(t.EventSet);t.NetWork=l,__reflect(l.prototype,"core.NetWork")}(core||(core={}));var CrossJsonP=function(){function t(){}return t.sendLocal=function(e,i,r){t.mLocalCall[e]=[i,r];var n=document.createElement("script");n.src=e,n.addEventListener("load",function(){n.parentNode.removeChild(n)},!1),n.addEventListener("error",function(){n.parentNode.removeChild(n),t.mLocalCall[e][0].apply(t.mLocalCall[e][1],[e,null])},!1),document.body.appendChild(n)},t.localCallback=function(e,i){var r=RES.$getVirtualUrl(e);t.mLocalCall[r]?t.mLocalCall[r][0].apply(t.mLocalCall[r][1],[r,i]):(console.log(r),console.log(JSON.stringify(t.mLocalCall)),console.log("jsonp error:no call back of"+r))},t.mLocalCall={},t}();__reflect(CrossJsonP.prototype,"CrossJsonP");var core;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mUrls={},e}return __extends(e,t),e.prototype.loadFile=function(t,e,i){if(this.fileDic[t.name])return void e.call(i,t);var r=RES.$getVirtualUrl(t.url+".js");this.mUrls[r]={item:t,func:e,thisObject:i},CrossJsonP.sendLocal(r,this.onLoadOk,this)},e.prototype.onLoadError=function(t){var e=this.mUrls[t];delete this.mUrls[t];var i=e.item,r=e.func;i.loaded=!1,r.call(e.thisObject,i)},e.prototype.onLoadOk=function(t,e){if(null==e)return void this.onLoadError(t);var i=document.createElement("img");i.src=e;var r=this;i.onload=function(e){e.currentTarget.onload=null;var n=r.mUrls[t];delete r.mUrls[t];var o=n.item,a=n.func;o.loaded=!0;var s=new egret.Texture;s.bitmapData=new egret.BitmapData(i),r.analyzeData(o,s),a.call(n.thisObject,o)}},e}(RES.ImageAnalyzer);t.CrossJsonpImageAnalyzer=e,__reflect(e.prototype,"core.CrossJsonpImageAnalyzer")}(core||(core={}));var map;!function(t){var e=function(e){function i(i){var r=e.call(this)||this;return r.mId=-1,r.mName="",r.mTileColNum=0,r.mTileRowNum=0,r.mTileWidth=0,r.mTileHeight=0,r.mapW=0,r.mapH=0,r.mLayerList=[],r.mCamera=new t.Camera(r),i.addChild(r.mCamera),r}return __extends(i,e),i.prototype.destory=function(){this.removeAllLayer()},i.prototype.addLayer=function(t){return-1!=this.mLayerList.indexOf(t)?!1:(this.mLayerList.push(t),this.mCamera.addNodeToCamera(t.getDisplayNode()),!0)},i.prototype.removeLayer=function(t){var e=this.mLayerList.indexOf(t);return-1==e?!1:(this.mLayerList.splice(e,1),this.mCamera.removeNodeFromCamera(t.getDisplayNode()),!0)},i.prototype.removeAllLayer=function(){for(var t=0;t<this.mLayerList.length;t++){var e=this.mLayerList[t];this.mCamera.removeNodeFromCamera(e.getDisplayNode()),e.deleteObj()}this.mLayerList.length=0},i.prototype.sortLayers=function(){if(!(this.mLayerList.length<=1)){this.mLayerList.sort(function(t,e){return t.getZOrder()-e.getZOrder()});for(var t=0;t<this.mLayerList.length;t++){var e=this.mLayerList[t];this.mCamera.mContainer.setChildIndex(e.getDisplayNode(),t)}this.mCamera.onLayersChange()}},i.prototype.setId=function(t){this.mId=t},i.prototype.getId=function(){return this.mId},i.prototype.setName=function(t){this.mName=t},i.prototype.getName=function(){return this.mName},i.prototype.getCamera=function(){return this.mCamera},i.prototype.setMapSize=function(t,e,i,r){this.mTileColNum=t,this.mTileRowNum=e,this.mTileWidth=i,this.mTileHeight=r,this.mapW=t*i,this.mapH=e*r},i.prototype.getMapWidth=function(){return this.mapW},i.prototype.getMapHeight=function(){return this.mapH},i.prototype.getTileColNum=function(){return this.mTileColNum},i.prototype.getTileRowNum=function(){return this.mTileRowNum},i.prototype.getTileWidth=function(){return this.mTileWidth},i.prototype.getTileHeight=function(){return this.mTileHeight},i.prototype.onUpdate=function(){this.mCamera.onUpdate(),this.updateCameraView()},i.prototype.updateCameraView=function(){var t=this;this.mLayerList.forEach(function(e){e.onUpdate(t.mCamera)}),this.mCamera.setViewChanged(!1)},i}(TClass);t.TileMap=e,__reflect(e.prototype,"map.TileMap")}(map||(map={}));var map;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.name="camera",i.touchEnabled=!0,i.mContainer=new egret.DisplayObjectContainer,i.addChild(i.mContainer),i.mBScreenContainer=new egret.DisplayObjectContainer,i.mBScreenContainer.name="background",i.mContainer.addChild(i.mBScreenContainer),i.mFScreenContainer=new egret.DisplayObjectContainer,i.mFScreenContainer.name="foreground",i.mContainer.addChild(i.mFScreenContainer),i.mTileMap=t,i.mViewRect=new egret.Rectangle,i.mViewChanged=!0,i.mbAdjustView=!0,i.m_linkSprite=null,i.mTempPoint=new egret.Point,i.mFgColorLayer=new egret.Shape,i.mFgColorLayer.name="foreground_color",i.mBgColorLayer=new egret.Shape,i.mBgColorLayer.name="background_color",i.mBgImage=new egret.Bitmap,i.mFgImage=new egret.Bitmap,i.mScreenEffectList=[],i}return __extends(i,e),i.prototype.addNodeToCamera=function(t){this.mContainer.addChild(t)},i.prototype.removeNodeFromCamera=function(t){-1!=this.mContainer.getChildIndex(t)&&this.mContainer.removeChild(t)},i.prototype.isViewChanged=function(){return this.mViewChanged},i.prototype.setViewChanged=function(t){this.mViewChanged=t},i.prototype.setViewSize=function(t,e){(this.mViewRect.width!=t||this.mViewRect.height!=e)&&(this.mViewRect.width=t,this.mViewRect.height=e,this.anchorOffsetX=t/2,this.anchorOffsetY=e/2,this.x=t/2,this.y=e/2,this.adjustViewCenter())},i.prototype.getViewWidth=function(){return this.mViewRect.width},i.prototype.getViewHeight=function(){return this.mViewRect.height},i.prototype.setAdjustViewCenter=function(t){this.mbAdjustView=t},i.prototype.setViewCenter=function(t,e){TLog.Assert(null!=t&&null!=e&&0==isNaN(t)&&0==isNaN(e)),TLog.Assert(0!=this.mViewRect.width&&0!=this.mViewRect.height,"setViewCenter");var i=t-this.mViewRect.width/2,r=e-this.mViewRect.height/2;(i!=this.mViewRect.x||r!=this.mViewRect.y)&&(this.mViewRect.x=i,this.mViewRect.y=r,this.adjustViewCenter())},i.prototype.getViewCenterX=function(){return this.mViewRect.x+this.mViewRect.width/2},i.prototype.getViewCenterY=function(){return this.mViewRect.y+this.mViewRect.height/2},i.prototype.getViewBeginX=function(){return this.mViewRect.x},i.prototype.getViewBeginY=function(){return this.mViewRect.y},i.prototype.getViewRect=function(){return this.mViewRect},i.prototype.getAdjustCenter=function(t,e,i){var r=t,n=e;if(this.mbAdjustView){var o=this.mTileMap.getMapWidth(),a=this.mTileMap.getMapHeight(),s=this.mViewRect.width,h=s/2,l=this.mViewRect.height,u=l/2,p=o-h,m=a-u,c=h,d=u;s>=o&&(p=h,c=h),l>=a&&(m=u,d=u),t>p?r=p:c>t&&(r=c),e>m?n=m:d>e&&(n=d)}return i.setTo(r,n)},i.prototype.adjustViewCenter=function(){var t=this.mViewRect.width,e=t/2,i=this.mViewRect.height,r=i/2,n=this.mViewRect.x+e,o=this.mViewRect.y+r;this.getAdjustCenter(n,o,this.mTempPoint),this.mViewRect.x=this.mTempPoint.x-e,this.mViewRect.y=this.mTempPoint.y-r,this.width=t,this.height=i,this.mContainer.x=-this.mViewRect.x,this.mContainer.y=-this.mViewRect.y,this.mFgColorLayer.x=this.mViewRect.x,this.mFgColorLayer.y=this.mViewRect.y,this.mBgColorLayer.x=this.mViewRect.x,this.mBgColorLayer.y=this.mViewRect.y,this.mFScreenContainer.x=this.mViewRect.x,this.mFScreenContainer.y=this.mViewRect.y,this.mBScreenContainer.x=this.mViewRect.x,this.mBScreenContainer.y=this.mViewRect.y,this.mViewChanged=!0},i.prototype.setZoomScale=function(t){this.scaleX=this.scaleY=t},i.prototype.getZoomScale=function(){return this.scaleX},i.prototype.$hitTest=function(t,i){var r=e.prototype.$hitTest.call(this,t,i);if(null==r){if(!this.$visible||!this.touchEnabled)return null;var n=this.mContainer.$getInvertedConcatenatedMatrix(),o=n.a*t+n.c*i+n.tx,a=n.b*t+n.d*i+n.ty;this.mViewRect.contains(o,a)&&(r=this)}return r},i.prototype.stageXYToMapXY=function(t,e,i){var r=this.mContainer.$getInvertedConcatenatedMatrix();return r.transformPoint(t,e,i),i},i.prototype.mapXYToStageXY=function(t,e,i){var r=this.mContainer.$getConcatenatedMatrix();return r.transformPoint(t,e,i),i},i.prototype.linkMapSprite=function(t){this.unlinkMapSprite(),this.m_linkSprite=t,this.m_linkSprite.retain()},i.prototype.unlinkMapSprite=function(){this.m_linkSprite&&(this.m_linkSprite.release(),this.m_linkSprite=null)},i.prototype.updateLinkSprite=function(){if(null!=this.m_linkSprite){var t=this.m_linkSprite.getPositionX(),e=this.m_linkSprite.getPositionY();this.setViewCenter(t,e)}},i.prototype.onUpdate=function(){this.updateLinkSprite(),this.updateScreenEffect()},i.prototype.updateColor=function(t,e,i,r,n){var o=i<<16|r<<8|n;t.graphics.beginFill(o),t.graphics.drawRect(0,0,this.mViewRect.width,this.mViewRect.height),t.graphics.endFill(),t.alpha=e/255},i.prototype.setBgBlendColorEnable=function(t){t?(this.mContainer.addChild(this.mBgColorLayer),this.onLayersChange()):this.mBgColorLayer.parent&&this.mContainer.removeChild(this.mBgColorLayer)},i.prototype.setBgBlendColor=function(t,e,i,r){this.updateColor(this.mBgColorLayer,t,e,i,r)},i.prototype.setFgBlendColorEnable=function(t){t?(this.mContainer.addChild(this.mFgColorLayer),this.onLayersChange()):this.mFgColorLayer.parent&&this.mContainer.removeChild(this.mFgColorLayer)},i.prototype.setFgBlendColor=function(t,e,i,r){this.updateColor(this.mFgColorLayer,t,e,i,r)},i.prototype._setScreenImageImp=function(t,e,i){if(""==t||null==t)e.parent&&e.parent.removeChild(e);else{var r={onAsynTextureSucceed:function(t,i,r){e.texture=i}};i.addChildAt(e,0);var n=core.TextureManager.getInstance();n.loadTextureAsyn(t,r)}},i.prototype.setBgImage=function(t){return this._setScreenImageImp(t,this.mBgImage,this.mBScreenContainer),this.mBgImage},i.prototype.setFgImage=function(t){return this._setScreenImageImp(t,this.mFgImage,this.mFScreenContainer),this.mFgImage},i.prototype.onLayersChange=function(){for(var e=this.mContainer.$children,i=-1,r=0;r<e.length;r++){var n=e[r];if(n instanceof t.MapLayerDisplayerNode){i=r;break}}-1!=i?(this.mContainer.setChildIndex(this.mBScreenContainer,i+1),this.mBgColorLayer.parent&&this.mContainer.setChildIndex(this.mBgColorLayer,i+1)):(this.mContainer.setChildIndex(this.mBScreenContainer,0),this.mBgColorLayer.parent&&this.mContainer.setChildIndex(this.mBgColorLayer,0)),i=-1;for(var r=e.length-1;r>=0;r--){var n=e[r];if(n instanceof t.SpriteLayerDisplayerNode){i=r;break}}-1!=i&&(this.mContainer.setChildIndex(this.mFScreenContainer,i+1),this.mFgColorLayer.parent&&this.mContainer.setChildIndex(this.mFgColorLayer,i-1))},i.prototype.addScreenEffect=function(t,e){var r=this.mScreenEffectList.indexOf(t);return-1!=r?!1:(e==i.SCREEN_FOREGROUND?this.mFScreenContainer.addChild(t.getDisplayNode()):this.mBScreenContainer.addChild(t.getDisplayNode()),void this.mScreenEffectList.push(t))},i.prototype.removeScreenEffect=function(t){var e=this.mScreenEffectList.indexOf(t);if(-1==e)return!1;this.mScreenEffectList.splice(e,1);var i=t.getDisplayNode().parent;TLog.Assert(null!=i),i.removeChild(t.getDisplayNode())},i.prototype.updateScreenEffect=function(){if(0!=this.mScreenEffectList.length)for(var t=0,e=this.mScreenEffectList;t<e.length;t++){var i=e[t];i.retain(),i.onUpdate(null),i.release()}},i.SCREEN_BACKGROUND=0,i.SCREEN_FOREGROUND=1,i}(egret.DisplayObjectContainer);t.Camera=e,__reflect(e.prototype,"map.Camera")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.positionFromRect=function(t){this.x=t.left+t.width/2,this.y=t.top+t.height/2
},e}(egret.DisplayObjectContainer);t.MapAreaElemDisplayNode=e,__reflect(e.prototype,"map.MapAreaElemDisplayNode");var i=function(e){function i(){var i=e.call(this)||this;return i.mMapMgr=t.MapManager.getInstance(),i.textureRes=null,i.jsonRes=null,i.mResMgr=core.ResManager.getInstance(),i.mTextureMgr=core.TextureManager.getInstance(),i}return __extends(i,e),i.prototype.clear=function(){this.textureRes&&(this.textureRes.release(),this.textureRes=null),this.jsonRes&&(this.jsonRes.release(),this.jsonRes=null),this.mResMgr.cancelResAsyn(this),this.mTextureMgr.cancelTextureAsynAll(this)},i.prototype.loadTextureAndJson=function(t,e){this.mTextureMgr.loadTextureAsyn(t,this),this.mResMgr.loadResAsyn(e,this,core.ResourceType.TYPE_JSON)},i.prototype.onAsynTextureSucceed=function(t,e,i){this.textureRes=i,this.textureRes.retain(),this.checkLoadComplete()},i.prototype.onResItemLoad=function(t){this.jsonRes=t,this.jsonRes.retain(),this.checkLoadComplete()},i.prototype.onResItemError=function(t){},i.prototype.checkLoadComplete=function(){this.textureRes&&this.jsonRes&&this.onLoadComplete()},i.prototype.onLoadComplete=function(){},i}(e);t.MapAreaElemResNode=i,__reflect(i.prototype,"map.MapAreaElemResNode",["core.ResItemCallback","core.TextureCallback"]);var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastTimeStamp=-1,e.frames=null,e.index=0,e.delay=200,e.during=0,e.animScale=1,e}return __extends(e,t),e.prototype.initWithName=function(t){var e=this.mMapMgr.getAreaAnimConfig(t);if(null==e||!e.path)return void TLog.Error("MapAreaAnimNode %s not exist",t);this.index=-1,this.delay=e.delay||200,this.animScale=e.scale,this.during=this.delay;var i=e.path;"/"!=i.charAt(i.length-1)&&(i+="/");var r=i+t+".png",n=i+t+".json";this.loadTextureAndJson(r,n)},e.prototype.clear=function(){t.prototype.clear.call(this),egret.stopTick(this.update,this),this.mFramesTexture=null},e.prototype.positionFromRect=function(t){this.x=t.x,this.y=t.bottom-t.height},e.prototype.onLoadComplete=function(){var t=this.jsonRes.getData();TLog.Assert(t.frames);var e=Object.keys(t.frames);e.sort(function(t,e){return t.localeCompare(e)}),this.frames=[];for(var i=0,r=e;i<r.length;i++){var n=r[i];this.frames.push(t.frames[n])}TLog.Assert(this.frames.length>0),this.mBitmap=new egret.Bitmap,this.addChild(this.mBitmap),this.lastTimeStamp=egret.getTimer(),this.mFramesTexture={},this.scaleX=this.animScale,this.scaleY=this.animScale,egret.startTick(this.update,this)},e.prototype.update=function(t){if(null==this.mFramesTexture)return!1;var e=t-this.lastTimeStamp;if(this.lastTimeStamp=t,this.during+=e,this.during>=this.delay){if(this.during=0,this.index++,this.index>=this.frames.length&&(this.index=0),null==this.mFramesTexture[this.index]){var i=this.frames[this.index],r=this.textureRes.getData(),n=new egret.Texture;n._bitmapData=r._bitmapData,n.$initData(i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH,r._sourceWidth,r._sourceHeight),this.mFramesTexture[this.index]=n}this.mBitmap.texture=this.mFramesTexture[this.index]}return!1},e}(i);t.MapAreaAnimNode=r,__reflect(r.prototype,"map.MapAreaAnimNode");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initWithName=function(t){var e=this.mMapMgr.getAreaParticleConfig(t);if(null==e||!e.path)return void TLog.Error("MapAreaParticleNode %s not exist",t);var i=e.path;"/"!=i.charAt(i.length-1)&&(i+="/");var r=i+t+".png",n=i+t+".json";this.loadTextureAndJson(r,n)},e.prototype.clear=function(){t.prototype.clear.call(this),this.system&&(this.system.stop(!0),this.system=null)},e.prototype.onLoadComplete=function(){this.system=new particle.GravityParticleSystem(this.textureRes.getData(),this.jsonRes.getData()),this.addChild(this.system),this.system.start()},e}(i);t.MapAreaParticleNode=n,__reflect(n.prototype,"map.MapAreaParticleNode")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);t.MapLayerDisplayerNode=e,__reflect(e.prototype,"map.MapLayerDisplayerNode");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);t.SpriteLayerDisplayerNode=i,__reflect(i.prototype,"map.SpriteLayerDisplayerNode")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mRefCount=0,t}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mMapMgr=t.MapManager.getInstance()},i.prototype.destory=function(){this.clearNode(),this.mRefCount=0},i.prototype.initWithParam=function(t,e,i,r){this.mId=t,this.mName=e,this.mArea=i,this.mType=r},i.prototype.onElemFound=function(t){if(0==this.mRefCount){if(this.mRefCount++,null==this.mNode&&(this.mNode=this.createElemNode(this.mType,this.mName)),null==this.mNode)return void TLog.Error("MapAreaElem.onElemFound",this.mType,this.mName);t.getDisplayNode().addChild(this.mNode),this.mNode.positionFromRect(this.mArea)}},i.prototype.onElemLost=function(t){0!=this.mRefCount&&(this.mRefCount--,0==this.mRefCount&&this.clearNode())},i.prototype.clearNode=function(){this.mNode&&(this.mNode.parent&&this.mNode.parent.removeChild(this.mNode),this.mNode.clear(),this.mNode=null)},i.prototype.createElemNode=function(e,i){var r=null;return"frame_anim"==e?r=new t.MapAreaAnimNode:"outside_particle"==e&&(r=new t.MapAreaParticleNode),r&&r.initWithName(i),r},i}(TClass);t.MapAreaElem=e,__reflect(e.prototype,"map.MapAreaElem")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mAreaElemList=[],this.mGrid2ElemListMap={}},i.prototype.destory=function(){this.clearAllElems()},i.prototype.clearAllElems=function(){for(var t=0,e=this.mAreaElemList;t<e.length;t++){var i=e[t];i.destory()}this.mAreaElemList=null},i.prototype.load=function(i){e.prototype.load.call(this,i);for(var r=(i.readUInt(),i.readUInt()),n=0;r>n;++n)for(var o=i.readString(),a=i.readUInt(),s=0;a>s;++s){var h=i.readUInt(),l=i.readString(),u=new egret.Rectangle;u.left=i.readUInt(),u.top=i.readUInt(),u.right=i.readUInt(),u.bottom=i.readUInt();var p=t.MapAreaElem.newObj();p.initWithParam(h,l,u,o),this.mAreaElemList.push(p)}return!0},i.prototype.initEyeshot=function(t,i,r,n){e.prototype.initEyeshot.call(this,t,i,r,n),this.mGrid2ElemListMap={};for(var o=this.mLayerEyeshot.getGridWidth(),a=0,s=this.mAreaElemList;a<s.length;a++)for(var h=s[a],l=this.mLayerEyeshot.getGridByMapRect(h.mArea),u=l.left;u<=l.right;u++)for(var p=l.top;p<=l.bottom;p++){var m=u*o+p;null==this.mGrid2ElemListMap[m]&&(this.mGrid2ElemListMap[m]=[]),this.mGrid2ElemListMap[m].push(h)}},i.prototype.getMapAreaElem=function(t,e){var i=this.mLayerEyeshot.getGridWidth(),r=t*i+e;return this.mGrid2ElemListMap[r]},i.prototype.onEyeshotFound=function(t,e){var i=this.getMapAreaElem(t,e);if(i)for(var r=0,n=i;r<n.length;r++){var o=n[r];o.onElemFound(this)}},i.prototype.onEyeshotLost=function(t,e){var i=this.getMapAreaElem(t,e);if(i)for(var r=0,n=i;r<n.length;r++){var o=n[r];o.onElemLost(this)}},i}(t.MapLayerBase);t.MapAreaElemLayer=e,__reflect(e.prototype,"map.MapAreaElemLayer")}(map||(map={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResGroupMgr=t[0],this.mResItemMap={},this.mbLoaded=!1,this.mDelayTime=0,this.mDisposeTime=-1},i.prototype.destory=function(){this.unload(),this.mResItemMap=null},i.prototype.addResItemConfig=function(t,e){this.mResItemMap[t]={type:e,resItem:null}},i.prototype.setDisposeTime=function(t){this.mDisposeTime=t},i.prototype.load=function(){var e=this;if(1==this.mbLoaded)return void egret.callLater(this.mResGroupMgr._onGroupLoad,this.mResGroupMgr,this.name);if(null==this.mResCallback){var i=Object.keys(this.mResItemMap).length,r=0,n={onResItemLoad:function(t){var n=e.mResItemMap[t.getKey()];n&&(TLog.Assert(null==n.resItem),n.resItem=t,t.retain()),r++,r>=i&&e.onLoadComplete()},onResItemError:function(t){r++,r>=i&&e.onLoadComplete()}};this.mResCallback=n;var o=t.ResManager.getInstance();for(var a in this.mResItemMap){var s=this.mResItemMap[a];o.loadResAsyn(a,n,s.type)}}},i.prototype.unload=function(){if(0!=this.mbLoaded||null!=this.mResCallback){if(this.mbLoaded=!1,this.mResCallback){var e=t.ResManager.getInstance();e.cancelResAsyn(this.mResCallback),this.mResCallback=null}for(var i in this.mResItemMap){var r=this.mResItemMap[i];r.resItem&&(r.resItem.release(),r.resItem=null)}}},i.prototype.onLoadComplete=function(){TLog.Assert(null!=this.mResCallback),this.mDelayTime=0,this.mbLoaded=!0,this.mResCallback=null,this.mResGroupMgr._onGroupLoad(this.name)},i.prototype.onUpdate=function(){0!=this.mbLoaded&&-1!=this.mDisposeTime&&(this.mDelayTime+=t.TimeStamp.DelayTime,this.mDelayTime>this.mDisposeTime&&this.unload())},i}(TClass);t.ResGroup=e,__reflect(e.prototype,"core.ResGroup")}(core||(core={}));var map;!function(t){function e(t,e){return Math.floor((t-1)/e+1)}var i=function(){function i(){this.m_bForceRefresh=!1}return i.prototype.create=function(t,i,r,n,o){return this.m_pScrollSheetSink=t,this.m_nMapWidth=i,this.m_nMapHeight=r,0==this.m_nMapWidth||0==this.m_nMapHeight?!1:(this.m_nGridWidth=n,this.m_nGridHeight=o,0==this.m_nGridWidth||0==this.m_nGridHeight?!1:(this.m_nMapGridWidth=e(this.m_nMapWidth,this.m_nGridWidth),this.m_nMapGridHeight=e(this.m_nMapHeight,this.m_nGridHeight),this.m_rcViewport=new egret.Rectangle,this.m_rcViewportGrid=new egret.Rectangle,core.EgretUtil.Rectangle_setLTRB(this.m_rcViewportGrid,-1,-1,-1,-1),this.m_rcLastDirtyGrid=new egret.Rectangle,void this.m_rcLastDirtyGrid.copyFrom(this.m_rcViewportGrid)))},i.prototype.getGridWidth=function(){return this.m_nGridWidth},i.prototype.getGridHeight=function(){return this.m_nGridHeight},i.prototype.getGridXCount=function(){return this.m_nMapGridWidth},i.prototype.getGridYCount=function(){return this.m_nMapGridHeight},i.prototype.getGridRect=function(t,e){var i=new egret.Rectangle;core.EgretUtil.Rectangle_setLTRB(i,t*this.m_nGridWidth,e*this.m_nGridHeight,(t+1)*this.m_nGridWidth,(e+1)*this.m_nGridHeight);var r=new egret.Rectangle;return core.EgretUtil.Rectangle_setLTRB(r,0,0,this.m_nMapWidth-1,this.m_nMapHeight-1),i.intersection(r)},i.prototype.getGridByMapRect=function(e){if(0==this.m_nMapWidth||0==this.m_nMapHeight)return new egret.Rectangle;var i=new egret.Rectangle;core.EgretUtil.Rectangle_setLTRB(i,t.FLOOR(e.left/this.m_nGridWidth),t.FLOOR(e.top/this.m_nGridHeight),t.FLOOR(e.right/this.m_nGridWidth),t.FLOOR(e.bottom/this.m_nGridHeight));var r=new egret.Rectangle;return core.EgretUtil.Rectangle_setLTRB(r,0,0,this.m_nMapWidth-1,this.m_nMapHeight-1),i.intersection(r)},i.prototype.changeViewportSize=function(t,e,i){(this.m_rcViewport.width!=t||this.m_rcViewport.height!=e)&&(this.m_rcViewport.setTo(this.m_rcViewport.left,this.m_rcViewport.top,t,e),i&&this.scrollViewport(0,0))},i.prototype.moveViewportCenterTo=function(t,e){return this.moveViewportTo(t-this.m_rcViewport.width/2,e-this.m_rcViewport.height/2)},i.prototype.moveViewportTo=function(t,e){return 0==this.m_rcViewport.height||0==this.m_rcViewport.width?!1:this.scrollViewport(t-this.m_rcViewport.left,e-this.m_rcViewport.top)},i.prototype.scrollViewport=function(e,i){this.m_rcViewport.left+e<0&&(e=-this.m_rcViewport.left),this.m_rcViewport.right+e>this.m_nMapWidth&&(e=this.m_nMapWidth-this.m_rcViewport.right),this.m_rcViewport.top+i<0&&(i=-this.m_rcViewport.top),this.m_rcViewport.bottom+i>this.m_nMapHeight&&(i=this.m_nMapHeight-this.m_rcViewport.bottom),this.m_rcViewport.offset(e,i);var r=new egret.Rectangle,n=null,o=null;if(core.EgretUtil.Rectangle_setLTRB(r,t.FLOOR(this.m_rcViewport.left/this.m_nGridWidth),t.FLOOR(this.m_rcViewport.top/this.m_nGridHeight),t.FLOOR(this.m_rcViewport.right/this.m_nGridWidth),t.FLOOR(this.m_rcViewport.bottom/this.m_nGridHeight)),r.equals(this.m_rcViewportGrid))return!0;n=r.clone(),n.left-=1,n.top-=1,n.right+=1,n.bottom+=1;var a=new egret.Rectangle;a.setTo(0,0,this.m_nMapGridWidth-1,this.m_nMapGridHeight-1),o=n.intersection(a);var s=new egret.Point;if(0==this.m_bForceRefresh){for(var h=this.m_rcLastDirtyGrid.top;h>=0&&h<=this.m_rcLastDirtyGrid.bottom;h++)for(var l=this.m_rcLastDirtyGrid.left;l>=0&&l<=this.m_rcLastDirtyGrid.right;l++)s.setTo(l,h),o.contains(s.x,s.y)||this.m_pScrollSheetSink.onEyeshotLost(l,h);for(var h=o.top;h<=o.bottom;h++)for(var l=o.left;l<=o.right;l++)s.setTo(l,h),this.m_rcLastDirtyGrid.contains(s.x,s.y)||this.m_pScrollSheetSink.onEyeshotFound(l,h)}else{for(var h=this.m_rcLastDirtyGrid.top;h>=0&&h<=this.m_rcLastDirtyGrid.bottom;h++)for(var l=this.m_rcLastDirtyGrid.left;l>=0&&l<=this.m_rcLastDirtyGrid.right;l++)this.m_pScrollSheetSink.onEyeshotLost(l,h);for(var h=o.top;h<=o.bottom;h++)for(var l=o.left;l<=o.right;l++)this.m_pScrollSheetSink.onEyeshotFound(l,h)}return this.m_rcViewportGrid=r,this.m_rcLastDirtyGrid=o,!0},i}();t.MapLayerEyeShot=i,__reflect(i.prototype,"map.MapLayerEyeShot")}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mRefCount=0,t}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mCellX=e[0],this.mCellY=e[1],this.mImageId=0,this.mFlag=0,this.mMapMgr=t.MapManager.getInstance()},i.prototype.destory=function(){this.clearImage(),this.mImage=null,this.mRefCount=0},i.prototype.setImageId=function(t){this.mImageId=t},i.prototype.setFlag=function(t){this.mFlag=t},i.prototype.onTileFound=function(t){if(0==this.mRefCount){this.mRefCount++,null==this.mImage&&(this.mImage=new egret.Bitmap),t.getDisplayNode().addChild(this.mImage),this.mImage.x=this.mCellX*t.getCellW(),this.mImage.y=this.mCellY*t.getCellH();var e=this.mMapMgr.getStaticImagePath(this.mImageId);if(""!=e){var i=core.TextureManager.getInstance();i.loadTextureAsyn(e,this),this.mPath=e}}},i.prototype.onTileLost=function(t){0!=this.mRefCount&&(this.mRefCount--,0==this.mRefCount&&this.clearImage())},i.prototype.clearImage=function(){if(this.mImage&&this.mImage.parent&&(this.mImage.parent.removeChild(this.mImage),this.mImage.$setBitmapData(null)),this.mPath){var t=core.TextureManager.getInstance();t.cancelTextureAsyn(this.mPath,this),this.mPath=null}},i.prototype.onAsynTextureSucceed=function(t,e){this.mImage.texture=e},i}(TClass);t.MapTile=e,__reflect(e.prototype,"map.MapTile",["core.TextureCallback"])}(map||(map={}));var map;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.mTempViewInfo={},t}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTileList=[]},i.prototype.destory=function(){this.clearAllTiles()},i.prototype.clearAllTiles=function(){this.mTileList.forEach(function(t){t.deleteObj()}),this.mTileList=[]},i.prototype.load=function(t){e.prototype.load.call(this,t);var i=t.readUnsignedInt(),r=t.readUnsignedInt(),n=t.readUnsignedInt(),o=t.readUnsignedInt();this.setCellWHAndNum(i,r,n,o);for(var a=0;o>a;++a)for(var s=0;n>s;++s){for(var h=this.getMapTile(s,a),l=t.readShort(),u=0;l>u;u++){var p=t.readInt();h.setImageId(p)}var m=t.readInt();h.setFlag(m)}return!0},i.prototype.getMapTile=function(e,i){TLog.Assert(e<this.cellNumW||e>=0||i<this.cellNumW||i>=0,"getTile x:"+e+" y:"+i);var r=e+i*this.cellNumW,n=this.mTileList[r];return null==n&&(n=this.mTileList[r]=t.MapTile.newObj(e,i)),n},i.prototype.setCellWHAndNum=function(t,e,i,r){this.clearAllTiles(),this.cellSizeW=t,this.cellSizeH=e,this.cellNumW=i,this.cellNumH=r,this.mapSizeH=this.cellSizeH*this.cellNumH,this.mapSizeW=this.cellSizeW*this.cellNumW},i.prototype.getCellW=function(){return this.cellSizeW},i.prototype.getCellH=function(){return this.cellSizeH},i.prototype.onEyeshotFound=function(t,e){this.getVisibleCellInfo(t,e);for(var i=this.mTempViewInfo,r=0;r<i.xviewnum;r++)for(var n=0;n<i.yviewnum;n++){var o=i.xbegin+r,a=i.ybegin+n,s=this.getMapTile(o,a);s.onTileFound(this)}},i.prototype.onEyeshotLost=function(t,e){this.getVisibleCellInfo(t,e);for(var i=this.mTempViewInfo,r=0;r<i.xviewnum;r++)for(var n=0;n<i.yviewnum;n++){var o=i.xbegin+r,a=i.ybegin+n,s=this.getMapTile(o,a);s.onTileLost(this)}},i.prototype.getVisibleCellInfo=function(e,i){var r=this.mLayerEyeshot.getGridRect(e,i),n=this.mTempViewInfo={};n.xbegin=t.FLOOR(r.left/this.cellSizeW),n.ybegin=t.FLOOR(r.top/this.cellSizeH),n.xviewnum=t.FLOOR((r.width-1)/this.cellSizeW)+1,n.yviewnum=t.FLOOR((r.height-1)/this.cellSizeH)+1},i}(t.MapLayerBase);t.MapTileLayer=e,__reflect(e.prototype,"map.MapTileLayer")}(map||(map={}));var Application=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mLastTime=-1,e}return __extends(e,t),e.prototype.init=function(t,e){this.mRootNode=t,this.mStage=e,OverrideEgretInit(),OverrideEUIInit(),map.MapManager.getInstance().init(this.mRootNode),gui.GuiManager.getInstance().init(this.mRootNode,this.mStage),this.mRootNode.addEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this);var i=egret.getDefinitionByName("g_LaunchInit");TLog.Assert("function"==typeof i),i()},e.prototype.stop=function(){this.mRootNode.removeEventListener(egret.Event.ENTER_FRAME,this.onUpdate,this)},e.prototype.setFps=function(t){this.mStage.frameRate=t},e.prototype.setDebug=function(t){},e.prototype.getRootNode=function(){return this.mRootNode},e.prototype.getStageNode=function(){return this.mStage},e.prototype.isDeviceMobile=function(){return egret.MainContext.deviceType==egret.MainContext.DEVICE_MOBILE},e.prototype.isDeviceWeb=function(){return egret.MainContext.deviceType==egret.MainContext.DEVICE_PC},e.prototype.isRuntimeHtml5=function(){return egret.MainContext._runtimeType==egret.MainContext.RUNTIME_HTML5},e.prototype.isRuntimeNative=function(){return egret.MainContext._runtimeType==egret.MainContext.RUNTIME_NATIVE},e.prototype.onUpdate=function(){var t=core.getCpuTime();this.mLastTime<0&&(this.mLastTime=t),core.TimeStamp.DelayTime=t-this.mLastTime,core.TimeStamp.CurrentTime+=core.TimeStamp.DelayTime,core.TimeStamp.CurrentFrame+=1,this.mLastTime=t,core.NetSystem.getInstance().onUpdate(),map.MapManager.getInstance().onUpdate(),gui.GuiManager.getInstance().onUpdate(),map.LogicSpriteManager.getInstance().onUpdate(),core.TextureManager.getInstance().onUpdate(),core.ResGroupManager.getInstance().onUpdate(),core.AutoreleasePool.getInstance().clear()},e}(TClass);__reflect(Application.prototype,"Application");var UserSettingMode;!function(t){t[t.Common=0]="Common",t[t.Role=1]="Role"}(UserSettingMode||(UserSettingMode={}));var UserSetting=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mCommonName="",this.mRoleName="",this.mOperateType=-1},e.prototype.setOperationType=function(t){},e.prototype.setRoleName=function(t){this.mRoleName=t},e.prototype.setCommonSetting=function(t,e,i){this._setSetttingStorage(UserSettingMode.Common,t,e,i)},e.prototype.getCommonSetting=function(t,e,i){return this._getSettingStorage(UserSettingMode.Common,t,e,i)},e.prototype.setRoleSetting=function(t,e,i){this._setSetttingStorage(UserSettingMode.Role,t,e,i)},e.prototype.getRoleSetting=function(t,e,i){return this._getSettingStorage(UserSettingMode.Role,t,e,i)},e.prototype._setSetttingStorage=function(t,e,i,r){var n=this._getKeyName(t,i);egret.localStorage.setItem(n,r)},e.prototype._getSettingStorage=function(t,i,r,n){var o=this._getKeyName(t,r),a=egret.localStorage.getItem(o);return null==a?n:i==e.TYPE_NUMBER?Number(a).valueOf():i==e.TYPE_BOOLEAN?"false"==a||"0"==a?!1:!0:a},e.prototype._getKeyName=function(t,e){var i=e;return UserSettingMode.Role==t&&(""==this.mRoleName&&TLog.Error("UserSetting RoleName is empty. key:%s",i),i+=this.mRoleName),i},e.TYPE_STRING=0,e.TYPE_NUMBER=1,e.TYPE_BOOLEAN=2,e}(TClass);__reflect(UserSetting.prototype,"UserSetting");var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mResGroupList=[],this.mGroupCallbackMap={}},i.prototype.destory=function(){for(var t=0,e=this.mResGroupList;t<e.length;t++){var i=e[t];i.deleteObj()}this.mResGroupList=null},i.prototype.getGroup=function(e,i){for(var r=0,n=this.mResGroupList;r<n.length;r++){var o=n[r];if(o.name==e)return o}if(i=!!i,0==i)return null;var a=t.ResGroup.newObj(this);return a.name=e,this.mResGroupList.push(a),a},i.prototype.addGroupConfig=function(t,e,i){var r=this.getGroup(t,!0);r.addResItemConfig(e,i)},i.prototype.loadGroup=function(t,e){var i=this.getGroup(t);if(null!=i){if(e){var r=this.mGroupCallbackMap[t];if(null==r&&(r=this.mGroupCallbackMap[t]=[]),-1!=r.indexOf(e))return;r.push(e)}i.load()}},i.prototype.unLoadGroup=function(t){var e=this.getGroup(t);null!=e&&e.unload()},i.prototype.cancelGroup=function(t){delete this.mGroupCallbackMap[t]},i.prototype._onGroupLoad=function(t){var e=this.mGroupCallbackMap[t];e&&(e.forEach(function(e){e.onResGroupLoad(t)}),delete this.mGroupCallbackMap[t])},i.prototype.onUpdate=function(){for(var t=0,e=this.mResGroupList;t<e.length;t++){var i=e[t];i.onUpdate()}},i}(TClass);t.ResGroupManager=e,__reflect(e.prototype,"core.ResGroupManager")}(core||(core={}));var map;!function(t){var e;!function(t){t[t.TYPE_BONE_SPRITE=0]="TYPE_BONE_SPRITE",t[t.TYPE_FRMAE_SPRITE=1]="TYPE_FRMAE_SPRITE"}(e=t.SpriteType||(t.SpriteType={}));var i;!function(t){t[t.ANIM_NOTIFY=262144]="ANIM_NOTIFY"}(i=t.AnimReportFlag||(t.AnimReportFlag={}));var r;!function(t){t[t.eLoaded=0]="eLoaded",t[t.eUnLoaded=1]="eUnLoaded",t[t.eLoading=2]="eLoading",t[t.eUnLoading=3]="eUnLoading"}(r=t.ModelLoadState||(t.ModelLoadState={}));var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.AnimEvent="AnimEvent",e}(core.EventArgs);t.SpriteAnimEvent=n,__reflect(n.prototype,"map.SpriteAnimEvent");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destory=function(){},e.BoundSizeEvent="BoundSizeEvent",e}(core.EventArgs);t.SpriteEvent=o,__reflect(o.prototype,"map.SpriteEvent");var a;!function(t){t[t.eDisplayNode_UI=0]="eDisplayNode_UI",t[t.eDisplayNode_Shadow=1]="eDisplayNode_Shadow",t[t.eDisplayNode_Unknown=2]="eDisplayNode_Unknown"}(a=t.SpriteDisplayNodeType||(t.SpriteDisplayNodeType={}))}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mSpriteList=[],this.mRelaseSpriteList=[],this.mModelInfoMap={},this.mSkeletonResourceMap={},this.mTextureResourceMap={},this.mUnloadingResourceList=[],this.mDisposeTime=5e3},i.prototype.destory=function(){for(var t=0,e=this.mRelaseSpriteList;t<e.length;t++){var i=e[t];i.release()}this.mRelaseSpriteList.length=0,this.mSpriteList.forEach(function(t){t.deleteObj()}),this.mSpriteList.length=0,this.mUnloadingResourceList.length=0;for(var r in this.mSkeletonResourceMap){var n=this.mSkeletonResourceMap[r];n.deleteObj()}this.mSkeletonResourceMap={};for(var r in this.mTextureResourceMap){var o=this.mTextureResourceMap[r];o.deleteObj()}this.mSkeletonResourceMap={}},i.prototype.createSprite=function(e){var i=null;return e==t.SpriteType.TYPE_BONE_SPRITE?i=t.BoneSprite.createObj():e==t.SpriteType.TYPE_FRMAE_SPRITE&&(i=t.FrameSprite.createObj()),this.mSpriteList.push(i),i},i.prototype.removeSprite=function(t){var e=this.mSpriteList.indexOf(t);-1!=e&&this.mSpriteList.splice(e,1)},i.prototype.defineModelPath=function(t,e,i){if(t&&e){var r={};r.modelName=t,r.path=e,r.isbin=i,this.mModelInfoMap[t]=r}},i.prototype.getBoneSkeletonResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mSkeletonResourceMap[e];return null==r&&(r=t.BoneSpriteSkletonResource.newObj(e,i,this),this.mSkeletonResourceMap[e]=r),r},i.prototype.getBoneTextureResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mTextureResourceMap[e];return null==r&&(r=t.BoneSpriteTextureResource.newObj(e,i,this),this.mTextureResourceMap[e]=r),r},i.prototype.getFrameTextureResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mTextureResourceMap[e];return null==r&&(r=t.FrameSpriteTextureResource.newObj(e,i,this),this.mTextureResourceMap[e]=r),r},i.prototype.getFrameSpriteInfoResource=function(e){var i=this.mModelInfoMap[e];if(null==e||null==i)return null;var r=this.mSkeletonResourceMap[e];return null==r&&(r=t.FrameSpriteInfoResource.newObj(e,i,this),this.mSkeletonResourceMap[e]=r),r},i.prototype.addUnloadingResource=function(t){-1==this.mUnloadingResourceList.indexOf(t)&&(TLog.Assert(-1==t.mUnLoadBeginTime),t.mUnLoadBeginTime=core.TimeStamp.CurrentTime,this.mUnloadingResourceList.push(t))},i.prototype.removeUnloadingResource=function(t){var e=this.mUnloadingResourceList.indexOf(t);-1!=e&&this.mUnloadingResourceList.splice(e,1)},i.prototype.setAutoDisposeTime=function(t){TLog.Assert(t>=0),this.mDisposeTime=t},i.prototype.onUpdate=function(){var t=this;if(this.mUnloadingResourceList.length>0){for(var e=[],i=core.TimeStamp.CurrentTime-this.mDisposeTime,r=0,n=this.mUnloadingResourceList;r<n.length;r++){var o=n[r];o.mUnLoadBeginTime>0&&o.mUnLoadBeginTime<i&&e.push(o)}e.length>0&&e.forEach(function(e){t.removeUnloadingResource(e),e.unloadImp()})}},i}(core.EventSet);t.LogicSpriteManager=e,__reflect(e.prototype,"map.LogicSpriteManager")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mCacheHashCodeList=[]},e.prototype.destory=function(){},e.prototype.onRenderSpriteList=function(e){var i=this;t.prototype.onRenderSpriteList.call(this,e);var r=this.mRenderObjectList.length;if(0!=r){this.mRenderObjectList.sort(function(t,e){var i=t.getPositionY()-e.getPositionY();return 0==i&&(i=t.getPositionX()-e.getPositionX()),i});var n=!1;if(r!=this.mCacheHashCodeList.length)n=!0;else for(var o=0;r>o;o++){var a=this.mCacheHashCodeList[o],s=this.mRenderObjectList[o].hashCode;if(a!=s){n=!0;break}}if(n){this.mCacheHashCodeList.length=0;var h=0,l=this.getDisplayNode();this.mRenderObjectList.forEach(function(t){var e=t.getDisplayNode();e.parent==l&&l.setChildIndex(e,h),h++,i.mCacheHashCodeList.push(t.hashCode)})}}},e}(t.SpriteLayer);t.SortSpriteLayer=e,__reflect(e.prototype,"map.SortSpriteLayer")}(map||(map={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mKey=t[0],this.mPath=t[1],this.mData=t[2],this.mFromZip=!!t[3]},i.prototype.destory=function(){0==this.mFromZip&&t.ResManager.getInstance().destroyRes(this.mPath),this.mData=null,t.ResManager.getInstance().clearResPath(this.mPath)},i.prototype.getKey=function(){return this.mKey},i.prototype.getData=function(){return this.mData},i}(TClass);t.ResItem=e,__reflect(e.prototype,"core.ResItem")}(core||(core={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mSkletonResource=null,this.mTextureResource=null,this.dynamicSlotDataList=[]},e.prototype.destory=function(){this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource(),this.dynamicSlotDataList.forEach(function(t){t.returnToPool()}),this.dynamicSlotDataList=null},e.prototype._loadTextureResource=function(){if(null==this.mTextureResource){var t=this.getModelName();if(""!=t){if(this.mTextureResource=this.mSpriteMgr.getBoneTextureResource(t),null==this.mTextureResource)return void TLog.Error("_loadTextureResource:"+t);this.mTextureResource.load(),this._setFlags(32)}}},e.prototype._unLoadTextureResource=function(){this.mTextureResource&&(this.mTextureResource.unload(),this.mTextureResource=null),this._removeFlags(32),this.mArmatureDisplay&&this._updateSlotDisplay(!0)},e.prototype._loadSkeletonResource=function(){if(null==this.mSkletonResource){var t=this.getModelName();if(""!=t){if(this.mSkletonResource=this.mSpriteMgr.getBoneSkeletonResource(t),null==this.mSkletonResource)return void TLog.Error("_loadSkeletonResource:"+t);this.mSkletonResource.load()}}},e.prototype._unLoadSkeletonResource=function(){this.mSkletonResource&&(this.mSkletonResource.unload(),this.mSkletonResource=null)},e.prototype.onFrameEvent=function(t){var e=t.eventObject.name?t.eventObject.name:"";this._fireAnimEvent(e)},e.prototype.onAnimationEvent=function(t){t.type==dragonBones.EventObject.START?this._fireAnimEvent("begin"):t.type==dragonBones.EventObject.LOOP_COMPLETE?(this._fireAnimEvent("end"),this._fireAnimEvent("turn")):t.type==dragonBones.EventObject.COMPLETE&&this._fireAnimEvent("end")},e.prototype._createArmature=function(){TLog.Assert(null==this.mArmatureDisplay&&null!=this.mSkletonResource),this.mArmatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(this.getModelName()),TLog.Assert(null!=this.mArmatureDisplay,"buildArmatureDisplay failded %s",this.getModelName()),this.mRootNode.addChildAt(this.mArmatureDisplay,0),this.mArmatureDisplay.addEventListener(dragonBones.EventObject.START,this.onAnimationEvent,this),this.mArmatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onAnimationEvent,this),this.mArmatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this.onFrameEvent,this),this.mArmatureDisplay.disableBatch(),this._updateAlpha(),this._updateScale(),this._updateRotate()},e.prototype._clearArmature=function(){this.mArmatureDisplay&&(this.mRootNode.removeChild(this.mArmatureDisplay),this.mArmatureDisplay.dispose(),this.mArmatureDisplay=null)},e.prototype._updateAnimation=function(){if(this._hasFlags(2)){this._removeFlags(2),this._removeFlags(8);var t=this.mLogicInfo[1];""==t||null==t?this.mArmatureDisplay.animation.play(null,this.getLoopCount()):this.mArmatureDisplay.animation.play(t,this.getLoopCount()),this.mArmatureDisplay.animation.timeScale=this.getAnimSpeed()}if(this._hasFlags(4)&&(this._removeFlags(4),this.mArmatureDisplay.animation.timeScale=this.getAnimSpeed()),this._hasFlags(16)){this._removeFlags(16);var e=this.isPause();e?this.mArmatureDisplay.animation.stop():this.mArmatureDisplay.animation.play()}},e.prototype._getTextureData=function(t){var e=this.getModelName(),i=dragonBones.EgretFactory.factory.getTextureAtlasData(e);if(i)for(var r=0,n=i.length;n>r;++r){var o=i[r].getTexture(t);if(o)return TLog.Assert(null!=o.parent),o}return null},e.prototype._updateSlotDisplay=function(t){t=!!t;for(var e=this.mArmatureDisplay.armature.getSlots(),i=0;i<e.length;i++){for(var r=e[i],n=r._displayDatas,o=0,a=n.length;a>o;++o){var s=n[o];s instanceof dragonBones.ImageDisplayData&&(s.texture=this._getTextureData(s.path))}var h=r;h._textureData=null,h._displayData=null,h._updateDisplayData()}this.mArmatureDisplay.armature.invalidUpdate(null,!0),this.mArmatureDisplay.armature.advanceTime(0)},e.prototype._updateTexture=function(){this.mTextureResource&&this.mTextureResource.isLoaded()&&this._hasFlags(32)&&(this._removeFlags(32),this._updateSlotDisplay())},e.prototype._updateBound=function(){if(0!=this.mBoundModelChanged&&null!=this.mTextureResource&&0!=this.mTextureResource.isLoaded()){this.mBoundModelChanged=!1;
var t=!1,e=this.mArmatureDisplay.animation;""!=this.mBoundActionId&&this.mBoundActionId!=e.lastAnimationName&&e.hasAnimation(this.mBoundActionId)&&(e.play(this.mBoundActionId),this.mArmatureDisplay.armature.advanceTime(0),t=!0);var i=this.getDisplayNode();this.mArmatureDisplay.getTransformedBounds(i,this.mBoundRect),this._fireBoundEvent(),t&&(this._setFlags(2),this._updateAnimation())}},e.prototype._updatePartSkin=function(t,e){var i=dragonBones.EgretFactory.factory,r=this.mArmatureDisplay.armature,n=r.getSlot(t);if(null==n)return void TLog.Error("changePartSkin slot:%s not exist!",t);var o=this.getModelName(),a=i.getDragonBonesData(o),s=e.split("/");2!=s.length&&TLog.Error("changePartSkin replaceSkinPath paths:%s error!",e);var h=s[0],l=s[1],u=a.getArmature(h);return null==u||null==u.defaultSkin.getDisplays(l)?void TLog.Error("changePartSkin no skinSlot exsit path:%s",e):void i.replaceSlotDisplayList(o,h,l,n)},e.prototype._updateSkin=function(){var t=this;if(this._hasFlags(64)){this._removeFlags(64);do{var e=this.getSkinName();if(""==e)break;var i=dragonBones.EgretFactory.factory,r=this.mArmatureDisplay.armature,n=this.getModelName(),o=i.getDragonBonesData(n),a=o.getArmature(e);if(null==a)return void TLog.Error("_updateSkin no skin exsit... path:%s",e);i.changeSkin(r,a.defaultSkin)}while(!1)}this.mPartSkinInfoList.length>0&&(this.mPartSkinInfoList.forEach(function(e){t._updatePartSkin(e.slotName,e.replaceSkinPath)}),this.mPartSkinInfoList.length=0)},e.prototype._createDynamicSlotData=function(t,e){for(var i=0,r=this.dynamicSlotDataList;i<r.length;i++){var n=r[i];if(n.name==t)return n}var o=dragonBones.DragonBones.webAssembly?new Module.SlotData:dragonBones.BaseObject.borrowObject(dragonBones.SlotData);return o.displayIndex=0,o.zOrder=0,o.name=t,o.parent=e,o.color=dragonBones.DragonBones.webAssembly?Module.SlotData.DEFAULT_COLOR:dragonBones.SlotData.DEFAULT_COLOR,this.dynamicSlotDataList.push(o),o},e.prototype._addChidNode=function(t,i,r,n){TLog.Assert(i instanceof e);var o=!0;do if(""!=t&&null!=t){var a=this.mArmatureDisplay.armature,s=a.armatureData.getBone(t);if(null==s){TLog.Error("_addChidNode %s does not have boneData:%s",this.getModelName(),t);break}var h=t+"_background";r>0&&(h=t+"_foreground");var l=a.getSlot(h);if(null==l){var u=this._createDynamicSlotData(h,s);l=dragonBones.BaseObject.borrowObject(dragonBones.EgretSlot),l.init(u,[],new egret.Bitmap,new egret.Mesh),l._setDisplayList([]),l._setZorder(r),a.addSlot(l,t)}if(null==l)break;if(null==l.display&&(l.display=new egret.DisplayObjectContainer,this.mArmatureDisplay.armature.invalidUpdate(t,!0),this.mArmatureDisplay.armature.advanceTime(0)),!(l.display instanceof egret.DisplayObjectContainer)){TLog.Error("slot:%s is not DisplayObjectContainer",h);break}var p=l.display;p.addChild(i.getDisplayNode()),o=!1}while(!1);o&&(i.setPersScale(this.getPersScale()),this.mRootNode.addChildAt(i.getDisplayNode(),r)),this.mChildSpriteList.push(i),i.retain()},e.prototype.onCameraFound=function(){t.prototype.onCameraFound.call(this),this._loadTextureResource(),this.mArmatureDisplay&&(this.mArmatureDisplay.armature.clock=dragonBones.EgretFactory.clock)},e.prototype.onCameraLost=function(){t.prototype.onCameraLost.call(this),this._unLoadTextureResource(),this.mArmatureDisplay&&0==this.mbUpdateAnimAlways&&(this.mArmatureDisplay.armature.clock=null)},e.prototype.onMoveDirChange=function(t){var e=[0,1,6,7],i=-1!=e.indexOf(t);if(null==this.mArmatureDisplay)return!1;var r=0;return i?this.m_bMirror&&r++:(r++,this.m_bMirror&&r++),this.m_bFlipX&&r++,this.mFlipXFlag=r%2==1?-1:1,this.mFlipYFlag=this.m_bFlipY?-1:1,this._updateScale(),!0},e.prototype._updateAlpha=function(){this.mArmatureDisplay&&(this.mArmatureDisplay.alpha=this.mAlpha/255*(this.mMaskAlpha/255))},e.prototype._updateScale=function(){if(this.mArmatureDisplay){var t=this.mPersScale*this.mScale;this.mArmatureDisplay.scaleX=t*this.mFlipXFlag,this.mArmatureDisplay.scaleY=t*this.mFlipYFlag}},e.prototype._updateRotate=function(){this.mArmatureDisplay&&(this.mArmatureDisplay.rotation=this.mRotate)},e.prototype._updateModel=function(){if(this._hasFlags(1)&&(this._removeFlags(1),this.mBoundModelChanged=!0,this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource(),this._loadSkeletonResource(),this.isClip()||this._loadTextureResource()),null!=this.mSkletonResource&&0!=this.mSkletonResource.isLoaded()&&(null==this.mArmatureDisplay&&(this._createArmature(),this.setDirChange()),this._updateAnimation(),this._updateTexture(),this._updateBound(),this._updateSkin(),1==this.isEnterMap()&&this._updateMask(),this.mArmatureDisplay)){var t=this.mChildAddInfoList.length;if(t>0){for(var e=0;t>e;e++){var i=this.mChildAddInfoList[e];this._addChidNode(i.slot,i.sprite,i.order,i.bTransform),i.sprite.release()}this.mChildAddInfoList.length=0}}},e.prototype.hasActionId=function(t){if(null==this.mArmatureDisplay)return!1;var e=this.mArmatureDisplay.armature;return-1!=e.animation.animationNames.indexOf(t)},e}(t.LogicSprite);t.BoneSprite=e,__reflect(e.prototype,"map.BoneSprite")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dragonBonesData=null;var i=t[1],r=i.path;this.modelJsonPath=r.concat("/"+i.modelName+"_ske.json"),this.texturePath=r.concat("/"+i.modelName+"_tex.png"),this.textureJsonPath=r.concat("/"+i.modelName+"_tex.json"),i.isbin&&(this.modelJsonPath=r.concat("/"+i.modelName+"_ske.dbbin"))},e.prototype.destory=function(){},e.prototype._loadImp=function(){var t=core.ResManager.getInstance();-1!=this.modelJsonPath.lastIndexOf(".dbbin")?t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_BIN):t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_JSON)},e.prototype._unloadImp=function(){var t=dragonBones.EgretFactory.factory;this.dragonBonesData&&(t.removeDragonBonesData(this.dragonBonesData.name),this.dragonBonesData=null)},e.prototype._cancelLoadImp=function(){var t=core.ResManager.getInstance();t.cancelResAsyn(this)},e.prototype.onResItemLoad=function(t){if(t.getKey()==this.modelJsonPath){var e=dragonBones.EgretFactory.factory;this.dragonBonesData=e.parseDragonBonesData(t.getData()),this.notifyLoadComplete()}},e.prototype.onResItemError=function(t){},e}(t.SpriteResourceBase);t.BoneSpriteSkletonResource=e,__reflect(e.prototype,"map.BoneSpriteSkletonResource",["core.ResItemCallback"]);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.textureJsonRes=null,this.textureRes=null,this.textureAtlasData=null;var i=t[1],r=i.path;this.modelJsonPath=r.concat("/"+i.modelName+"_ske.json"),this.texturePath=r.concat("/"+i.modelName+"_tex.png"),this.textureJsonPath=r.concat("/"+i.modelName+"_tex.json"),i.isbin&&(this.modelJsonPath=r.concat("/"+i.modelName+"_ske.dbbin"))},e.prototype.destory=function(){this.textureJsonRes&&(this.textureJsonRes.release(),this.textureJsonRes=null),this.textureRes&&(this.textureRes.release(),this.textureRes=null)},e.prototype._loadImp=function(){var t=core.ResManager.getInstance();if(t.loadResAsyn(this.textureJsonPath,this,core.ResourceType.TYPE_JSON),null==this.textureRes){var e=core.TextureManager.getInstance();e.loadTextureAsyn(this.texturePath,this)}},e.prototype._unloadImp=function(){var t=dragonBones.EgretFactory.factory;if(this.textureAtlasData){t.removeTextureAtlasData(this.textureAtlasData.name),this.textureAtlasData=null;var e=this.mModelName,i=t.getDragonBonesData(e);if(i){var r=i.armatures;for(var n in r){var o=r[n];if(o)for(var a in o.skins){var s=o.skins[a];for(var h in s.displays)for(var l=s.displays[h],u=0,p=l;u<p.length;u++){var m=p[u];m instanceof dragonBones.ImageDisplayData&&(m.texture=null)}}}}}this.textureRes&&(this.textureRes.release(),this.textureRes=null)},e.prototype._cancelLoadImp=function(){var t=core.ResManager.getInstance();t.cancelResAsyn(this);var e=core.TextureManager.getInstance();e.cancelTextureAsyn(this.texturePath,this)},e.prototype.onResItemLoad=function(t){t.getKey()==this.textureJsonPath&&(this.textureJsonRes=t),t.retain(),this._updateRes()},e.prototype.onResItemError=function(t){},e.prototype.onAsynTextureSucceed=function(t,e,i){TLog.Assert(null==this.textureRes),t==this.texturePath&&(this.textureRes=i,this.textureRes.retain(),this._updateRes())},e.prototype._updateRes=function(){if(this.textureJsonRes&&this.textureRes){var t=dragonBones.EgretFactory.factory;this.textureAtlasData=t.parseTextureAtlasData(this.textureJsonRes.getData(),this.textureRes.getData()),this.notifyLoadComplete(),this.textureJsonRes.release(),this.textureJsonRes=null}},e}(t.SpriteResourceBase);t.BoneSpriteTextureResource=i,__reflect(i.prototype,"map.BoneSpriteTextureResource",["core.ResItemCallback","core.TextureCallback"])}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.mSpriteInfoResource=null,this.mTextureResource=null,this.mSpriteAnimation=t.FrameSpriteAnim.newObj(this),this.mSpriteDisplay=new t.FrameSpriteDisplay,this.mbSpriteDisplayLoaded=!1,this.mRootNode.addChildAt(this.mSpriteDisplay,0),this.mTransfromProxy=null},i.prototype.destory=function(){this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource()},i.prototype.getSpriteTexture=function(){return this.mTextureResource},i.prototype.getSpriteDisplay=function(){return this.mSpriteDisplay},i.prototype.setTransfromProxy=function(t){this.mTransfromProxy=t},i.prototype.getTransformProxy=function(){return this.mTransfromProxy},i.prototype.joinBodyPartsTo=function(t){var e=t.getSpriteDisplay();this.mSpriteDisplay.joinBodyPartDisplayTo(e),this.mJoinPartsTarget=t},i.prototype.restoreBodyParts=function(){this.mSpriteDisplay.restoreBodyPartDisplay(),this.mJoinPartsTarget=null},i.prototype.onAnimationEvent=function(t){""!=t&&this._fireAnimEvent(t)},i.prototype.onAnimationIndexChange=function(t,e){this.mSpriteDisplay.setFrameIndex(t,e)},i.prototype.getSpriteInfo=function(){return null==this.mSpriteInfoResource?null:this.mSpriteInfoResource.getSpriteInfo()},i.prototype._clearArmature=function(){this.mbSpriteDisplayLoaded=!1,this.mSpriteDisplay.clearBodyPartDisplay(),this.mSpriteAnimation.unloadAnim()},i.prototype._createArmature=function(){TLog.Assert(0==this.mbSpriteDisplayLoaded&&null!=this.mSpriteInfoResource),this.mbSpriteDisplayLoaded=!0,this.mSpriteDisplay.loadModelInfo(this,this.getSpriteInfo()),this.mSpriteAnimation.loadModelAnim(this.getSpriteInfo()),this.mJoinPartsTarget&&this.joinBodyPartsTo(this.mJoinPartsTarget)},i.prototype._loadTextureResource=function(){if(null==this.mTextureResource){var t=this.getModelName();if(""!=t){if(this.mTextureResource=this.mSpriteMgr.getFrameTextureResource(t),null==this.mTextureResource)return void TLog.Error("_loadTextureResource:"+t);this.mTextureResource.load(),this._setFlags(32)}}},i.prototype._unLoadTextureResource=function(){this.mTextureResource&&(this.mTextureResource.unload(),this.mTextureResource=null),this._removeFlags(32)},i.prototype._loadSkeletonResource=function(){if(null==this.mSpriteInfoResource){var t=this.getModelName();if(""!=t){if(this.mSpriteInfoResource=this.mSpriteMgr.getFrameSpriteInfoResource(t),null==this.mSpriteInfoResource)return void TLog.Error("_loadSkeletonResource:"+t);this.mSpriteInfoResource.load()}}},i.prototype._unLoadSkeletonResource=function(){this.mSpriteInfoResource&&(this.mSpriteInfoResource.unload(),this.mSpriteInfoResource=null)},i.prototype._updateAnimation=function(){if(this._hasFlags(2)){this._removeFlags(2),this._removeFlags(8);var t=this.mLogicInfo[1];if(""==t||null==t){var e=this.mSpriteAnimation.getAnimationInfoByIndex(0);this.mSpriteAnimation.changeAction(e.name,0==this.getLoopCount())}else"idle"==t&&0==this.hasActionId("idle")&&(t="combat_idle"),this.mSpriteAnimation.changeAction(t,0==this.getLoopCount());this.mSpriteAnimation.setAnimSpeed(this.getAnimSpeed()),this._updateDirChange(!0)}if(this._hasFlags(4)&&(this._removeFlags(4),this.mSpriteAnimation.setAnimSpeed(this.getAnimSpeed())),this._hasFlags(16)){this._removeFlags(16);var i=this.isPause();i?this.mSpriteAnimation.setPause(!0):this.mSpriteAnimation.setPause(!1)}null==this.mJoinPartsTarget&&this.mSpriteAnimation.onUpdate()},i.prototype._updateTexture=function(){this.mTextureResource&&this.mTextureResource.isLoaded()&&this._hasFlags(32)&&(this._removeFlags(32),this.mSpriteDisplay.updateDisplay())},i.prototype._updateBound=function(){if(0!=this.mBoundModelChanged&&null!=this.mTextureResource&&0!=this.mTextureResource.isLoaded()){var t=this.mSpriteAnimation;if(0!=this.mTextureResource.isAnimTextureLoaded(t.getActionId())){this.mBoundModelChanged=!1,this.mSpriteDisplay.updateDisplay();var e=this.getDisplayNode();this.mSpriteDisplay.getTransformedBounds(e,this.mBoundRect),this._fireBoundEvent()}}},i.prototype._addChidNode=function(e,r,n,o){if(TLog.Assert(r instanceof i),o)if(0==n)r.joinBodyPartsTo(this);else{var a=new t.FramSpriteBodyPartDisplayProxy;a.initWithParam(r),a.setOrder(n),this.mSpriteDisplay.addBodyPartDisplay(a),this.mSpriteDisplay.updateDisplay(),r.setTransfromProxy(a)}else{var s=this.mRootNode.numChildren;0>n&&(s=0),r.setPersScale(this.getPersScale()),this.mRootNode.addChildAt(r.getDisplayNode(),s)}this.mChildSpriteList.push(r),r.retain()},i.prototype._removeChildNode=function(t){var i=t.getTransformProxy();null!=i&&this.mSpriteDisplay.removeBodyPartDisplay(i),t.restoreBodyParts(),e.prototype._removeChildNode.call(this,t)},i.prototype._updateDirChange=function(t){if(t=!!t,(null==this.mTransfromProxy||0!=t)&&null==this.mJoinPartsTarget){var e=this.getDir();null!=this.mParentSprite&&(e=this.mParentSprite.getDir());var i=this.mSpriteAnimation.getCurAnimationInfo();if(!(null==i||i.dirs.length<=0)){for(var r=i.dirs[0],n=Math.abs(e-r),o=1;o<i.dirs.length;o++){var a=i.dirs[o],s=Math.abs(a-e);n>s&&(r=a,n=s)}this.mSpriteDisplay.setDirIndex(r)}}},i.prototype.onCameraFound=function(){e.prototype.onCameraFound.call(this),this._loadTextureResource()},i.prototype.onCameraLost=function(){e.prototype.onCameraLost.call(this),this._unLoadTextureResource()},i.prototype.onMoveDirChange=function(t){return this._updateDirChange(),!0},i.prototype.changePartSkin=function(t,e){this.mSpriteDisplay.setPartShow(t,e)},i.prototype.changeSkin=function(t){},i.prototype.getSkinName=function(){return TLog.Assert(!1,"not support"),""},i.prototype.setPositionOffset=function(t,e){this.mSpriteDisplay.x=t,this.mSpriteDisplay.y=e},i.prototype._updateAlpha=function(){this.mSpriteDisplay.alpha=this.mAlpha/255*(this.mMaskAlpha/255)},i.prototype._updateScale=function(){var t=this.mPersScale*this.mScale;this.mSpriteDisplay.scaleX=t*this.mFlipXFlag,this.mSpriteDisplay.scaleY=t*this.mFlipYFlag},i.prototype._updateRotate=function(){this.mSpriteDisplay.rotation=this.mRotate},i.prototype._updateModel=function(){if(this._hasFlags(1)&&(this._removeFlags(1),this.mBoundModelChanged=!0,this._clearArmature(),this._unLoadSkeletonResource(),this._unLoadTextureResource(),this._loadSkeletonResource(),this.isClip()||this._loadTextureResource()),null!=this.mSpriteInfoResource&&0!=this.mSpriteInfoResource.isLoaded()){0==this.mbSpriteDisplayLoaded&&(this._createArmature(),this.setDirChange()),this._updateAnimation(),this._updateTexture(),this._updateBound(),1==this.isEnterMap()&&this._updateMask();var t=this.mChildAddInfoList.length;if(t>0){for(var e=0;t>e;e++){var i=this.mChildAddInfoList[e];this._addChidNode(i.slot,i.sprite,i.order,i.bTransform),i.sprite.release()}this.mChildAddInfoList.length=0}}},i.prototype.hasActionId=function(t){return null!=this.mSpriteAnimation.getAnimationInfo(t)},i.prototype.getAnimation=function(){return this.mSpriteAnimation},i}(t.LogicSprite);t.FrameSprite=e,__reflect(e.prototype,"map.FrameSprite",["map.FrameSpriteAnimListener"])}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mListener=t[0],this.mLoop=!0,this.mAnimSpeed=1,this.mFrameIndex=-1,this.mbPause=!1,this.mCurIntervalTime=0,this.mAnimChanged=!1,this.mCurAnimInfo=null,this.mSpriteInfo=null,this.mActionId=""},e.prototype.destory=function(){},e.prototype.loadModelAnim=function(t){this.mSpriteInfo=t,""!=this.mActionId&&this.changeAction(this.mActionId,this.mLoop)},e.prototype.unloadAnim=function(){this.mSpriteInfo=null,this.mCurAnimInfo=null},e.prototype.changeAction=function(t,e){if(this.mActionId=t,this.mLoop=e,null!=this.mSpriteInfo){var i=this.mSpriteInfo;this.mCurAnimInfo=i.getFrameAnimInfo(t),null==this.mCurAnimInfo&&TLog.Error("model:%s body:%s changeAction %s not exist",i.name,t),this.mAnimChanged=!1,this.mFrameIndex=-1,this.setPause(!1)}},e.prototype.getActionId=function(){return this.mActionId},e.prototype.setAnimSpeed=function(t){this.mAnimSpeed=t},e.prototype.setPause=function(t){this.mbPause=t},e.prototype.getAnimationInfoByIndex=function(t){return null==this.mSpriteInfo?null:this.mSpriteInfo.mAnimationList[t]},e.prototype.getAnimationInfo=function(t){return null!=this.mSpriteInfo?this.mSpriteInfo.getFrameAnimInfo(t):void 0},e.prototype.getCurAnimationInfo=function(){return this.mCurAnimInfo},e.prototype.onUpdate=function(){if(!this.mbPause&&null!=this.mCurAnimInfo){var t=core.TimeStamp.DelayTime*this.mAnimSpeed;for(this.mCurIntervalTime+=t,-1==this.mFrameIndex&&(this.mFrameIndex=-1,this.mCurIntervalTime=this.mCurAnimInfo.timeInterval,this.mAnimChanged=!0,this.mListener.onAnimationEvent("begin"));this.mCurIntervalTime>=this.mCurAnimInfo.timeInterval;){this.mCurIntervalTime-=this.mCurAnimInfo.timeInterval;var e=!1;this.mFrameIndex++,this.mFrameIndex>=this.mCurAnimInfo.frameCount&&(e=!0,this.mFrameIndex=0),this.mAnimChanged=!0,this.mCurAnimInfo.eventFrameIndex==this.mFrameIndex&&""!=this.mCurAnimInfo.eventName&&this.mListener.onAnimationEvent(this.mCurAnimInfo.eventName),e&&(this.mListener.onAnimationEvent("end"),0==this.mLoop?this.mbPause=!0:this.mListener.onAnimationEvent("turn"))}this.mAnimChanged&&this.mListener.onAnimationIndexChange(this.mCurAnimInfo.name,this.mFrameIndex)}},e}(TClass);t.FrameSpriteAnim=e,__reflect(e.prototype,"map.FrameSpriteAnim")}(map||(map={}));var map;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.mActionId="",e.mDirIndex=-1,e.mFrameIndex=-1,e.mPartShowName="",e.mOrder=0,e}return __extends(e,t),e.prototype.setDispalyParent=function(t,e){return void 0===e&&(e=0),this.parent!=t?void(null==t?this.parent&&this.parent.removeChild(this):t.addChildAt(this,e)):void t.setChildIndex(this,e)},e.prototype.setDirIndex=function(t){this.mDirIndex=t,this.updateDislay()},e.prototype.setFrameIndex=function(t,e){this.mActionId=t,this.mFrameIndex=e,this.updateDislay()},e.prototype.setPartShow=function(t){this.mPartShowName=t,this.updateDislay()},e.prototype.setVisible=function(t){this.visible=t},e.prototype.setOrder=function(t){this.mOrder=t},e.prototype.getOrder=function(){return this.mOrder},e.prototype.updateDislay=function(){},e}(egret.DisplayObjectContainer);t.FramSpriteBodyPartDisplayBase=e,__reflect(e.prototype,"map.FramSpriteBodyPartDisplayBase");var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initWithParam=function(t,e){this.mLogicSprite=t,this.mBodyPartInfo=e,this.mPartName=e.name,this.mOrder=this.mBodyPartInfo.defaultOrder,this.mBitmap=new egret.Bitmap,this.mBitmap.anchorOffsetX=e.offx,this.mBitmap.anchorOffsetY=e.offy,this.addChild(this.mBitmap)},e.prototype.setDirIndex=function(e){t.prototype.setDirIndex.call(this,e);var i=this.mBodyPartInfo.dirsOrder[e];null!=i&&this.setOrder(i)},e.prototype.updateDislay=function(){if(!(""==this.mActionId||this.mDirIndex<0||this.mFrameIndex<0)){var t=this.mLogicSprite.getSpriteTexture();if(null!=t){t.requestLoadAnimTexture(this.mActionId);var e=null;e=""==this.mPartShowName?String.format("%s_%d_%s_%02d",this.mActionId,this.mDirIndex,this.mBodyPartInfo.name,this.mFrameIndex):String.format("%s_%d_%s_%s_%02d",this.mActionId,this.mDirIndex,this.mBodyPartInfo.name,this.mPartShowName,this.mFrameIndex);var i=t.getTexture(e);this.mBitmap.texture=i}}},e.prototype.$measureChildBounds=function(e){t.prototype.$measureContentBounds.call(this,e),this.mBitmap.texture?e.setTo(0,0,this.mBitmap.texture.$getScaleBitmapWidth(),this.mBitmap.texture.$getScaleBitmapHeight()):e.setTo(0,0,0,0)},e}(e);t.FramSpriteBodyPartDisplayBitmap=i,__reflect(i.prototype,"map.FramSpriteBodyPartDisplayBitmap");var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initWithParam=function(t){this.mLogicSprite=t,this.mSpriteDisplay=t.getSpriteDisplay(),this.mSpriteAnim=t.getAnimation(),this.addChild(this.mLogicSprite.getDisplayNode())},e.prototype.setDirIndex=function(e){var r=this.mSpriteAnim.getCurAnimationInfo();if(null!=r){if(0==r.isDirectionExsit(e)){if(-1!=this.mDirIndex||0==r.dirs.length)return;e=r.dirs[0]}t.prototype.setDirIndex.call(this,e);var n=this.mSpriteDisplay.mBodyPartDisplayList;if(n.length>0){var o=n[0];if(o instanceof i){var a=o.mBodyPartInfo.dirsOrder[e];null!=a&&this.setOrder(a)}}}},e.prototype.setFrameIndex=function(t,e){},e.prototype.updateDislay=function(){this.mDirIndex<0||this.mSpriteDisplay.setDirIndex(this.mDirIndex)},e}(e);t.FramSpriteBodyPartDisplayProxy=r,__reflect(r.prototype,"map.FramSpriteBodyPartDisplayProxy");var n=function(t){function e(){var e=t.call(this)||this;return e.mBodyPartDisplayList=[],e.mRestoreBodyPartDisplayList=[],e.mRestoreSpriteDisplay=null,e.mActionId="",e.mDirIndex=-1,e.mFrameIndex=-1,e}return __extends(e,t),e.prototype.loadModelInfo=function(t,e){TLog.Assert(null!=e),this.mRestoreBodyPartDisplayList=[],this.mRestoreSpriteDisplay=null,this.mLogicSprite=t;for(var r=e.mBodyPartInfoList,n=0,o=r;n<o.length;n++){var a=o[n],s=new i;s.initWithParam(t,a),this.addChild(s),this.mBodyPartDisplayList.push(s)}this.updateDisplay()},e.prototype.setDirIndex=function(t){for(var e=!1,i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var n=r[i],o=n.getOrder();n.setDirIndex(t),o!=n.getOrder()&&(e=!0)}e&&this.updateDisplay(),this.mDirIndex=t},e.prototype.setFrameIndex=function(t,e){for(var i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var n=r[i];n.setFrameIndex(t,e)}this.mActionId=t,this.mFrameIndex=e},e.prototype.setPartShow=function(t,e){if(""!=t)for(var i=0,r=this.mBodyPartDisplayList;i<r.length;i++){var n=r[i];n.mPartName==t&&n.setPartShow(e)}},e.prototype.restoreBodyPartDisplay=function(){if(null!=this.mRestoreSpriteDisplay){for(var t=0;t<this.mRestoreBodyPartDisplayList.length;t++){var e=this.mRestoreBodyPartDisplayList[t];this.mRestoreSpriteDisplay.removeBodyPartDisplay(e),this.addBodyPartDisplay(e)}this.mRestoreSpriteDisplay.updateDisplay(),this.updateDisplay(),this.mRestoreSpriteDisplay=null}},e.prototype.joinBodyPartDisplayTo=function(t){if(null==this.mRestoreSpriteDisplay&&0!=this.mBodyPartDisplayList.length){for(var e=0;e<this.mBodyPartDisplayList.length;e++){var i=this.mBodyPartDisplayList[e];this.removeChild(i),t.addBodyPartDisplay(i),this.mRestoreBodyPartDisplayList.push(i)}this.mBodyPartDisplayList.length=0,this.mRestoreSpriteDisplay=t,t.updateDisplay()}},e.prototype.addBodyPartDisplay=function(t){return JsUtil.arrayPush(this.mBodyPartDisplayList,t)?(this.addChild(t),t.setDirIndex(this.mDirIndex),t.setFrameIndex(this.mActionId,this.mDirIndex),!0):!1},e.prototype.removeBodyPartDisplay=function(t){return JsUtil.arrayRemoveVal(this.mBodyPartDisplayList,t)?(this.removeChild(t),!0):!1},e.prototype.clearBodyPartDisplay=function(){for(var t=0;t<this.mBodyPartDisplayList.length;t++){var e=this.mBodyPartDisplayList[t];this.removeChild(e)}this.mBodyPartDisplayList.length=0},e.prototype.updateDisplay=function(){if(null==this.mRestoreSpriteDisplay){this.mBodyPartDisplayList.sort(function(t,e){return t.getOrder()-e.getOrder()});for(var t=0;t<this.mBodyPartDisplayList.length;t++){var e=this.mBodyPartDisplayList[t];e.setDispalyParent(this,t),e.updateDislay()}}else for(var t=0;t<this.mRestoreBodyPartDisplayList.length;t++){var i=this.mRestoreBodyPartDisplayList[t];i.updateDislay()}},e}(egret.DisplayObjectContainer);t.FrameSpriteDisplay=n,__reflect(n.prototype,"map.FrameSpriteDisplay")}(map||(map={}));var map;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name=t[0],this.frameCount=0,this.timeInterval=0,this.eventName="",this.eventFrameIndex=-1,this.dirs=[]},e.prototype.isDirectionExsit=function(t){return-1!=this.dirs.indexOf(t)},e}(TClass);t.FrameSpriteAnimInfo=e,__reflect(e.prototype,"map.FrameSpriteAnimInfo");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name=t[0],this.partShowList=[],this.defaultOrder=0,this.defaultShow="",this.dirsOrder={},this.offx=0,this.offy=0},e.prototype.destory=function(){},e}(TClass);t.FrameSpriteBodyPartInfo=i,__reflect(i.prototype,"map.FrameSpriteBodyPartInfo");var r=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.name="",this.mBodyPartInfoList=[],this.mAnimationList=[]},r.prototype.destory=function(){},r.prototype.loadWithJson=function(t){this.name=t.name;for(var e=t.bodyparts,i=0,r=e;i<r.length;i++){var n=r[i],o=this.addBodyPart(n.name,n.order);if(o.offx=n.offx,o.offy=n.offy,n.dirsOrder)for(var a in n.dirsOrder){var s=JsUtil.toNumber(a,-1);-1!=s&&(o.dirsOrder[s]=n.dirsOrder[s])}if(n.shows)for(var h=0,l=n.shows;h<l.length;h++){var u=l[h];this.addBodyPartShow(n.name,u)}}for(var p=t.anims,m=0,c=p;m<c.length;m++){var d=c[m];this.addAnimation(d.name,d.dirs,d.interval,d.frameCount,d.eventName,d.eventIndex)}},r.prototype.addBodyPart=function(t,e){var r=this.getBodyPartInfo(t);return null==r&&(r=i.newObj(t)),r.defaultOrder=e,this.mBodyPartInfoList.push(r),this.mBodyPartInfoList.sort(function(t,e){return t.defaultOrder-e.defaultOrder}),r},r.prototype.addBodyPartShow=function(t,e){if(""!=e){var i=this.getBodyPartInfo(t);if(null==i)return void TLog.Error("addBodyPartShow %s not exsit",t);i.partShowList.push(e),""==i.defaultShow&&(i.defaultShow=e)}},r.prototype.getBodyPartInfo=function(t){for(var e=0;e<this.mBodyPartInfoList.length;e++){var i=this.mBodyPartInfoList[e];if(i.name==t)return i}return null},r.prototype.addAnimation=function(t,i,r,n,o,a){void 0===o&&(o=""),void 0===a&&(a=-1);var s=this.getFrameAnimInfo(t);return null!=s?void TLog.Error("addAnimation anim:%s exsit",t):(s=e.newObj(t),s.dirs=i.concat(),s.frameCount=n,s.timeInterval=r,s.eventName=o,s.eventFrameIndex=a,this.mAnimationList.push(s),s)},r.prototype.getFrameAnimInfo=function(t){for(var e=this.mAnimationList,i=0,r=e;i<r.length;i++){var n=r[i];if(n.name==t)return n}return null},r}(TClass);t.FrameSpriteInfo=r,__reflect(r.prototype,"map.FrameSpriteInfo")}(map||(map={}));var map;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[1];this.mBasePath=i.path,this.modelJsonPath=this.mBasePath.concat("/"+i.modelName+"_ske.json"),this.mFrameSpriteInfo=null},i.prototype.destory=function(){},i.prototype.getSpriteInfo=function(){return this.mFrameSpriteInfo},i.prototype._loadImp=function(){var t=core.ResManager.getInstance();t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_JSON)},i.prototype._unloadImp=function(){this.mFrameSpriteInfo&&(this.mFrameSpriteInfo.deleteObj(),this.mFrameSpriteInfo=null)},i.prototype._cancelLoadImp=function(){var t=core.ResManager.getInstance();t.cancelResAsyn(this)},i.prototype.onResItemLoad=function(e){if(e.getKey()==this.modelJsonPath){var i=e.getData(),r=t.FrameSpriteInfo.newObj();r.loadWithJson(i),this.mFrameSpriteInfo=r,this.notifyLoadComplete()}},i.prototype.onResItemError=function(t){},i}(t.SpriteResourceBase);t.FrameSpriteInfoResource=e,__reflect(e.prototype,"map.FrameSpriteInfoResource",["core.ResItemCallback"]);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTextureResMap={},this.mTextureAtlasMap={};var i=t[1];this.mBasePath=i.path,this.modelJsonPath=this.mBasePath.concat("/"+i.modelName+"_ske.json")},e.prototype.destory=function(){},e.prototype.getTexture=function(t){return this.mTextureAtlasMap[t]},e.prototype.isAnimTextureLoaded=function(t){var e=this.mModelName+"_"+t,i=this.mTextureResMap[e];return null==i&&(e=this.mModelName,i=this.mTextureResMap[e]),null!=i&&null!=i.textureRes},e.prototype.requestLoadAnimTexture=function(t){var e=this.mModelName+"_"+t,i=this.mTextureResMap[e];if(null==i&&(e=this.mModelName,i=this.mTextureResMap[e]),null!=i&&null==i.textureRes&&1!=i.bloading){var r=this._getTextureJsonPath(e),n=core.ResManager.getInstance();n.loadResAsyn(r,this,core.ResourceType.TYPE_JSON);var o=this._getTexturePath(e),a=core.TextureManager.getInstance();a.loadTextureAsyn(o,this),i.bloading=!0}},e.prototype._loadImp=function(){var t=core.ResManager.getInstance();t.loadResAsyn(this.modelJsonPath,this,core.ResourceType.TYPE_JSON)},e.prototype._unloadImp=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.textureRes&&e.textureRes.release(),e.jsonRes&&e.jsonRes.release()}this.mTextureResMap={},this.mTextureAtlasMap={}},e.prototype._cancelLoadImp=function(){var t=core.TextureManager.getInstance();for(var e in this.mTextureResMap){this.mTextureResMap[e];t.cancelTextureAsyn(this._getTexturePath(e),this)}var i=core.ResManager.getInstance();i.cancelResAsyn(this)},e.prototype.onResItemLoad=function(t){if(t.getKey()==this.modelJsonPath){var e=t.getData(),i=[];if(null!=e.textures)for(var r=0,n=e.textures;r<n.length;r++){var o=n[r];i.push(o)}for(var a=0,s=i;a<s.length;a++){var h=s[a],l=h.lastIndexOf("."),u=h.substring(0,l);this.mTextureResMap[u]={textureRes:null,jsonRes:null,bloading:!1}}this.notifyLoadComplete()}else{for(var p in this.mTextureResMap){var m=this.mTextureResMap[p],c=this._getTextureJsonPath(p);c==t.getKey()&&(t.retain(),m.jsonRes=t)}this._checkLoadComplete()}},e.prototype.onResItemError=function(t){},e.prototype.onAsynTextureSucceed=function(t,e,i){for(var r in this.mTextureResMap){var n=this.mTextureResMap[r],o=this._getTexturePath(r);o==t&&(i.retain(),n.textureRes=i)}this._checkLoadComplete()},e.prototype._getTexturePath=function(t){return this.mBasePath.concat("/",t+".png")},e.prototype._getTextureJsonPath=function(t){return this.mBasePath.concat("/",t+".json")},e.prototype._checkLoadComplete=function(){for(var t in this.mTextureResMap){var e=this.mTextureResMap[t];e.bloading&&null!=e.textureRes&&null!=e.jsonRes&&(this._createTextureAtlas(e),e.bloading=!1,e.jsonRes.release(),e.jsonRes=null)}},e.prototype._createTextureAtlas=function(t){TLog.Assert(null!=t.textureRes&&null!=t.jsonRes);var e=t.textureRes.getData(),i=t.jsonRes.getData();for(var r in i.frames){var n=i.frames[r],o=new egret.Texture;o._bitmapData=e._bitmapData,o.$initData(n.x,n.y,n.w,n.h,n.offX,n.offY,n.sourceW,n.sourceH,e._sourceWidth,e._sourceHeight),this.mTextureAtlasMap[r]=o}},e}(t.SpriteResourceBase);t.FrameSpriteTextureResource=i,__reflect(i.prototype,"map.FrameSpriteTextureResource",["core.ResItemCallback","core.TextureCallback"])}(map||(map={}));var core;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.code=t[0],this.params=t[1]},e.prototype.destory=function(){},e}(t.EventArgs);t.SdkResultEvent=e,__reflect(e.prototype,"core.SdkResultEvent");var i=function(i){function r(){var t=null!==i&&i.apply(this,arguments)||this;return t.mInterGameSdk=null,t.mSupportInvite=!1,t.mAttentionStatus=r.NOT_SUPPORT_ATTENTION,t}return __extends(r,i),r.staticInit=function(t,e){r.sCmdLine=t,r.sMainClass=e},r.prototype.initSdk=function(e){this.mConfig=new t.ConfigFile,this.mConfig.initWithJson(e),this._loginSuccessAppead="&qdKey="+this.getStringConfigDef("QD_Key",""),this._loginSuccessAppead=this._loginSuccessAppead+"&code1="+this.getStringConfigDef("QD_Code1",""),this._loginSuccessAppead=this._loginSuccessAppead+"&code2="+this.getStringConfigDef("QD_Code2",""),this._loginSuccessAppead=this._loginSuccessAppead+"&gameKey="+this.getStringConfigDef("GameKey",""),this._loginSuccessAppead=this._loginSuccessAppead+"&gameName="+this.getStringConfigDef("GameName",""),this.initCmdLine();var i=egret.getDefinitionByName(r.sMainClass);i&&(this.mInterGameSdk=i.newObj(this)),null!=this.mInterGameSdk&&this.mInterGameSdk.initSdk()},r.prototype.initCmdLine=function(){if(TLog.Debug("sCmdLine",r.sCmdLine),this.mCmdListValueList={},TLog.Debug("GameSdk.sCmdLine",r.sCmdLine),null!=r.sCmdLine&&r.sCmdLine.length>1){var e=r.sCmdLine.indexOf("?");if(-1!=e){var i=r.sCmdLine.substr(0,e);if(r.sCmdLine.length>e+1){var n=e+1,o=r.sCmdLine.substr(n,r.sCmdLine.length-n);this.mCmdListValueList=t.GameSdkUtil.splitHttpParams(o)}this.mCmdListValueList.url=i}else this.mCmdListValueList.url=r.sCmdLine}for(var a in this.mCmdListValueList){var s=this.mCmdListValueList[a];TLog.Debug("cmd:",a,s)}},r.prototype.getFromCmdLine=function(t){return this.mCmdListValueList[t]},r.prototype.getStringConfigDef=function(t,e){return this.mConfig.getString(t,e)},r.prototype.getBoolConfigDef=function(t,e){return this.mConfig.getBoolean(t,e)},r.prototype.reportRoleCreate=function(t,e,i,r){return null==this.mInterGameSdk?!1:this.mInterGameSdk.reportRoleCreate(t,e,i,r,1)},r.prototype.reportRoleLogin=function(t,e,i,r,n){return null==this.mInterGameSdk?!1:this.mInterGameSdk.reportRoleLogin(t,e,i,r,n)},r.prototype.canInvite=function(){return this.mSupportInvite},r.prototype.setSupportInvite=function(t){TLog.Debug("GameSdk:setSupportInvite",t),this.mSupportInvite=t,this.fireEvent(r.SHARE_STATUS_CHANGE,e.newObj(0))},r.prototype.setAttentionStatus=function(t){TLog.Debug("GameSdk:setAttentionStatus",t),this.mAttentionStatus=t,this.fireEvent(r.ATTENTION_STATUS_CHANGE,e.newObj(0))},r.prototype.getAttentionStatus=function(){return this.mAttentionStatus},r.prototype.canShowAttention=function(){return this.mAttentionStatus==r.NOT_ATTENTION},r.prototype.onLoginReturn=function(t,i){0==t&&(i+=this._loginSuccessAppead),this.fireEvent(r.LoginEvent,e.newObj(t,i))},r.prototype.onInviteReturn=function(t){TLog.Debug("GameSdk:onInviteReturn",t),t&&this.fireEvent(r.SHARE_RETURN,e.newObj(0))},r.prototype.onPayReturn=function(t,i){this.fireEvent(r.PAY_SDK_EVENT,e.newObj(t,i))},r.prototype.callLogin=function(t){return null==this.mInterGameSdk?!1:this.mInterGameSdk.login(t)},r.prototype.callPay=function(t){return null==this.mInterGameSdk?(this.onPayReturn(-1,"not suport"),!1):this.mInterGameSdk.pay(t)},r.prototype.callShowShare=function(t){return null!=this.mInterGameSdk?this.mInterGameSdk.showShare(t):void 0},r.prototype.callShowAttention=function(t){return null!=this.mInterGameSdk?this.mInterGameSdk.showAttention(t):void 0},r.SHARE_STATUS_CHANGE="SHARE_STATUS_CHANGE",r.SHARE_RETURN="SHARE_RETURN",r.ATTENTION_STATUS_CHANGE="ATTENTION_STATUS_CHANGE",r.PAY_SDK_EVENT="PAY_SDK_EVENT",r.LoginEvent="LoginEvent",r.NOT_SUPPORT_ATTENTION=-1,r.NOT_ATTENTION=0,r.AREADY_ATTENTION=1,r.sCmdLine=null,r.sMainClass=null,r}(t.EventSet);t.GameSdk=i,__reflect(i.prototype,"core.GameSdk")}(core||(core={}));var core;!function(t){var e=function(){function t(){}return t.splitHttpParams=function(t){if(!t)return{};for(var e={},i=t.split("&"),r=0;r<i.length;++r){var n=i[r],o=n.search("=");if(-1!=o&&n.length>o+1){var a=n.substr(0,o),s=o+1,h=n.substr(s,n.length-s);e[a]=h}}return e},t.httpParamsToString=function(t){if(null==t)return"";var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")},t.getOSTime=function(){var t=new Date;return Math.floor(t.getTime()/1e3)},t.toNumber=function(t,e){return null==t?e:"number"==typeof t?t:JsUtil.toNumber(t,e)},t}();t.GameSdkUtil=e,__reflect(e.prototype,"core.GameSdkUtil")}(core||(core={}));var core;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initObj=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.mTcpListLock=0,this.mTcpList=[],this.mHttpListLock=0,this.mHttpList=[]},i.prototype.destory=function(){this.clearAll()},i.prototype.createNetWork=function(){var e=this.mTcpList;this.mTcpListLock>0&&(e=this.mTcpList=this.mTcpList.concat());var i=t.NetWork.newObj();return e.push(i),i},i.prototype.removeNetWork=function(t){var e=this.mTcpList.indexOf(t);if(-1==e)return!1;var i=this.mTcpList;return this.mTcpListLock>0&&(i=this.mTcpList=this.mTcpList.concat()),t.deleteObj(),i.splice(e,1),!0},i.prototype.createHttpClient=function(){var e=this.mHttpList;this.mHttpListLock>0&&(e=this.mHttpList=this.mHttpList.concat());var i=t.HttpClient.newObj();return e.push(i),i},i.prototype.removeHttpClient=function(t){var e=this.mHttpList.indexOf(t);if(-1==e)return!1;var i=this.mHttpList;this.mHttpListLock>0&&(i=this.mHttpList=this.mHttpList.concat()),t.deleteObj(),i.splice(e,1)},i.prototype.onUpdate=function(){var t=this.mTcpList,e=this.mHttpList;this.mTcpListLock++,t.forEach(function(t){t.onUpdate()}),this.mTcpListLock--,this.mHttpListLock++,e.forEach(function(t){t.onUpdate()}),this.mHttpListLock--},i.prototype.clearAll=function(){this.mTcpList.forEach(function(t){t.deleteObj()}),this.mTcpList=null,this.mHttpList.forEach(function(t){t.onUpdate()}),this.mHttpList=null},i}(TClass);t.NetSystem=e,__reflect(e.prototype,"core.NetSystem")}(core||(core={}));